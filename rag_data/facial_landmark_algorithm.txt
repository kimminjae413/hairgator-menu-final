[RAG 데이터베이스용] 얼굴 랜드마크 기반 헤어스타일 추천 알고리즘 v1.0
(Facial Landmark Based Hairstyle Recommendation Algorithm)

Hairgator의 헤어스타일을 정밀하게 매칭하기 위한 얼굴 분석 알고리즘입니다.
MediaPipe Face Mesh (468 랜드마크) 또는 Dlib (68 랜드마크)를 사용하여
얼굴의 특징을 5가지 핵심 차원(Dimension)으로 정량화하고,
이를 Hairgator의 카테고리 시스템에 매핑합니다.

================================================================================
제1부. 알고리즘 아키텍처 (Algorithm Architecture)
================================================================================

전체 프로세스:
이미지 입력 → 랜드마크 추출 → 특징 파라미터 계산 → 스코어링 → 매칭 및 필터링

--------------------------------------------------------------------------------
1.1 프로세스 흐름도
--------------------------------------------------------------------------------

[사용자 사진 입력]
       ↓
[랜드마크 추출 - MediaPipe/Dlib]
       ↓
[특징 파라미터 계산]
   ├── 상안부 비율
   ├── 중/하안부 밸런스
   ├── 가로세로 비율 & 턱 각도
   └── 여백(미간/관자) 분석
       ↓
[매칭 스코어링 - Scoring]
       ↓
[Hairgator DB 필터링]
       ↓
[Top 3 추천 스타일 도출]

================================================================================
제2부. 단계별 상세 로직 (Step-by-Step Logic)
================================================================================

--------------------------------------------------------------------------------
2.1 Step 1: 랜드마크 추출 (Feature Extraction)
--------------------------------------------------------------------------------

Python의 MediaPipe Face Mesh 사용을 권장합니다.
Dlib(68개)보다 훨씬 조밀한 468개 포인트를 제공하여
이마 높이 추정과 헤어라인 분석에 유리합니다.

[주요 좌표 정의 (Key Coordinates)]

| 부위 | MediaPipe 포인트 | 설명 |
|------|------------------|------|
| 헤어라인 중심 (Trichion) | pt_10 | 헤어라인이 가려진 경우, 눈썹 위 1/3 지점에서 추정치 사용 |
| 미간 (Glabella) | pt_9 | 양 눈썹 사이 중심점 |
| 코끝 (Pronasale) | pt_1 | 코의 가장 앞쪽 돌출점 |
| 턱끝 (Menton) | pt_152 | 턱의 가장 아래 중심점 |
| 광대 좌측 (Zygoma Left) | pt_234 | 좌측 광대뼈 가장 넓은 지점 |
| 광대 우측 (Zygoma Right) | pt_454 | 우측 광대뼈 가장 넓은 지점 |
| 턱각 좌측 (Gonion Left) | pt_58 | 좌측 턱각 (아래턱 모서리) |
| 턱각 우측 (Gonion Right) | pt_288 | 우측 턱각 (아래턱 모서리) |

--------------------------------------------------------------------------------
2.2 Step 2: 파라미터 계산 공식 (Quantified Formulas)
--------------------------------------------------------------------------------

측정된 좌표 (x, y)를 사용하여 유클리드 거리(Euclidean Distance)를 구하고,
이를 비율(Ratio)로 변환합니다.
절대 길이(cm)는 카메라 거리에 따라 달라지므로 비율 값만 사용합니다.

[1. 수직 비율 (Vertical Ratio) - 상안부/중안부/하안부]

계산 공식:
- Total_Height = Distance(헤어라인, 턱끝)
- Upper_Ratio = Distance(헤어라인, 미간) / Total_Height
- Middle_Ratio = Distance(미간, 코끝) / Total_Height
- Lower_Ratio = Distance(코끝, 턱끝) / Total_Height

판정 기준:
- Upper_Ratio > 0.36: 상안부 긺 (High Forehead) → 이마가 넓음
- Lower_Ratio > Middle_Ratio * 1.15: 긴 얼굴형 (Long Face) → 하안부가 길음

이상적인 황금 비율:
- 상안부 : 중안부 : 하안부 = 1 : 1 : 1 (각각 33.3%)
- 실제로는 약간의 편차가 자연스러움

[2. 가로폭 비율 (Horizontal Ratio) - 얼굴 너비/턱 너비]

계산 공식:
- Face_Width = Distance(좌 광대, 우 광대)
- Jaw_Width = Distance(좌 턱각, 우 턱각)
- Cheekbone_Prominence = Face_Width / Jaw_Width

판정 기준:
- Cheekbone_Prominence > 1.45: 역삼각형/하트형 (Heart/Inverted Triangle)
  → 광대가 넓고 턱이 좁음
- Cheekbone_Prominence < 1.15: 사각턱 (Square)
  → 광대와 턱 너비가 비슷함
- 1.15 ~ 1.45: 계란형/타원형 (Oval)
  → 이상적인 비율

[3. 여백 및 집중도 (Spacing & Density) - 미간/관자놀이]

계산 공식:
- Eye_Width = Distance(눈 앞머리, 눈 꼬리)
- Inter_Canthal = Distance(좌 눈 앞머리, 우 눈 앞머리)
- Temple_Space = Distance(눈 꼬리, 얼굴 외곽선)

판정 기준:
- Inter_Canthal > Eye_Width * 1.2: 미간 넓음 (Wide Set Eyes)
- Temple_Space > Eye_Width: 관자놀이 여백 넓음 (Wide Temples)

================================================================================
제3부. Hairgator 매칭 테이블 (Matching Logic)
================================================================================

계산된 파라미터(Condition)를 Hairgator의 카테고리(Filter)로 변환합니다.

--------------------------------------------------------------------------------
3.1 상안부 긺 (이마 넓음) - Upper_Ratio > 0.36
--------------------------------------------------------------------------------

[추천 카테고리]
- Sub Category: EB (Eye Brow), E (Eye), FH (Fore Head)
- 이유: 앞머리로 넓은 이마를 자연스럽게 커버

[회피 카테고리]
- Sub Category: N (None) - 앞머리 없음
- Main Category (남자): PB (Pushed Back) - 뒤로 넘김
- 이유: 이마가 완전히 노출되어 얼굴이 더 길어 보임

[스코어링]
- 이마 가리는 스타일: +30점
- 이마 까는 스타일: -50점

--------------------------------------------------------------------------------
3.2 긴 얼굴형 - Lower_Ratio > Middle_Ratio * 1.15
--------------------------------------------------------------------------------

[추천 카테고리]
- Main Category (여자): C LENGTH, D LENGTH, E LENGTH (어깨~쇄골 기장)
- 펌 타입: 사이드 볼륨 있는 스타일
- 이유: 세로 길이를 가로 볼륨으로 상쇄

[회피 카테고리]
- Main Category (여자): A LENGTH, B LENGTH (너무 긴 생머리)
- Main Category (여자): G LENGTH, H LENGTH (너무 짧은 숏컷)
- 이유: 세로로 더 길어 보이거나 얼굴이 더 강조됨

[스코어링]
- 어깨~쇄골 기장: +40점
- 정수리 볼륨: -20점
- 사이드 볼륨: +30점

--------------------------------------------------------------------------------
3.3 사각턱 - Cheekbone_Prominence < 1.15
--------------------------------------------------------------------------------

[추천 카테고리]
- Main Category (여자): A~D LENGTH (턱 아래로 내려오는 기장)
- Main Category (남자): PB (Pushed Back), SP (Side Part)
- 스타일: S컬 웨이브, 레이어드
- 이유: 부드러운 곡선이 각진 인상을 완화

[회피 카테고리]
- Main Category (여자): F LENGTH, G LENGTH (턱선 칼단발)
- 이유: 턱선이 강조되어 더 각져 보임

[스코어링]
- 턱 아래 기장: +30점
- S컬 웨이브: +20점
- 턱선 직선 커트: -40점

--------------------------------------------------------------------------------
3.4 광대 돌출 (역삼각형/하트형) - Cheekbone_Prominence > 1.45
--------------------------------------------------------------------------------

[추천 카테고리]
- Sub Category: CB (Cheekbone) - 광대뼈 높이 앞머리/사이드뱅
- Main Category (여자): F LENGTH (보브컷)
- 이유: 애교머리/사이드뱅으로 광대 자연스럽게 커버

[회피 카테고리]
- Sub Category: FH (Fore Head) - 애매한 기장의 앞머리
- Main Category (여자): A LENGTH (긴 생머리)
- 이유: 관자놀이가 드러나 광대가 더 강조됨

[스코어링]
- 사이드뱅/애교머리: +50점
- 관자놀이 노출: -30점

--------------------------------------------------------------------------------
3.5 목 짧음
--------------------------------------------------------------------------------

[추천 카테고리]
- Main Category (여자): G LENGTH, H LENGTH (숏컷, 리프컷)
- 이유: 목선이 드러나 시각적으로 목이 길어 보임

[회피 카테고리]
- Main Category (여자): E LENGTH, F LENGTH (어깨에 닿는 기장)
- 이유: 어깨선에서 끊겨 목이 더 짧아 보임

[스코어링]
- 숏/리프컷: +40점
- 어깨 닿는 기장: -30점

================================================================================
제4부. 얼굴형별 종합 추천 가이드
================================================================================

--------------------------------------------------------------------------------
4.1 계란형 (Oval) - 이상적인 비율
--------------------------------------------------------------------------------

특징:
- 상안부 : 중안부 : 하안부 ≈ 1 : 1 : 1
- 광대 너비 > 이마 너비 > 턱 너비
- Cheekbone_Prominence ≈ 1.25~1.35

추천:
- 거의 모든 스타일이 어울림
- 다양한 실험 가능

--------------------------------------------------------------------------------
4.2 둥근형 (Round)
--------------------------------------------------------------------------------

특징:
- 얼굴 가로 너비와 세로 길이가 비슷
- 광대가 가장 넓음
- 턱선이 둥글고 부드러움

추천:
- Main (여자): C~E LENGTH (쇄골~어깨 기장)
- Main (남자): SP (Side Part), FU (Fringe Up)
- Sub: CB (Cheekbone) - 긴 사이드뱅으로 가로폭 줄이기
- 볼륨: 정수리 볼륨으로 세로 길이 늘리기

회피:
- 턱선 단발 (가로폭 강조)
- 풍성한 사이드 볼륨 (얼굴 더 넓어 보임)

--------------------------------------------------------------------------------
4.3 긴 얼굴형 (Long/Oblong)
--------------------------------------------------------------------------------

특징:
- 세로 길이가 가로 너비보다 현저히 김
- Lower_Ratio > 0.38
- 이마, 광대, 턱 너비가 비슷

추천:
- Main (여자): D~F LENGTH (어깨선 기장)
- Sub: EB, E (눈썹~눈 높이 앞머리)
- 사이드 볼륨 있는 펌
- 가로로 퍼지는 웨이브

회피:
- A, B LENGTH (세로로 더 길어 보임)
- 정수리 볼륨 (세로 길이 강조)
- N (앞머리 없음)

--------------------------------------------------------------------------------
4.4 사각형 (Square)
--------------------------------------------------------------------------------

특징:
- 이마, 광대, 턱 너비가 비슷
- Cheekbone_Prominence < 1.15
- 턱선이 각짐

추천:
- Main (여자): A~D LENGTH (턱선 아래로 내려오는 기장)
- Main (남자): SF (Side Fringe) - 부드러운 앞머리
- 부드러운 S컬 웨이브
- 레이어드 스타일

회피:
- F, G LENGTH (턱선 단발)
- 직선적인 커트라인
- 뒤로 넘기는 스타일 (PB)

--------------------------------------------------------------------------------
4.5 하트형/역삼각형 (Heart/Inverted Triangle)
--------------------------------------------------------------------------------

특징:
- 이마/광대가 넓고 턱이 좁음
- Cheekbone_Prominence > 1.45
- 뾰족한 턱

추천:
- Main (여자): E~G LENGTH (턱선~어깨 사이)
- Sub: CB (Cheekbone) - 애교머리/사이드뱅
- 턱선 레벨에 볼륨 추가
- 보브컷 계열

회피:
- 정수리 볼륨 (머리가 더 커 보임)
- 짧은 앞머리 (이마 강조)
- 턱선 아래 볼륨 없는 롱헤어

--------------------------------------------------------------------------------
4.6 다이아몬드형 (Diamond)
--------------------------------------------------------------------------------

특징:
- 광대가 가장 넓음
- 이마와 턱이 좁음
- 얼굴이 날카로운 인상

추천:
- Sub: FH, EB (앞머리로 좁은 이마 커버)
- 사이드뱅으로 광대 커버
- 턱선 레벨에 볼륨

회피:
- 뒤로 넘기는 스타일
- 관자놀이가 드러나는 스타일

================================================================================
제5부. 스코어링 시스템 구현
================================================================================

--------------------------------------------------------------------------------
5.1 점수 계산 로직
--------------------------------------------------------------------------------

기본 점수: 0점
각 조건에 따라 가감

[가산 조건]
+50점: 핵심 보정 효과 (예: 광대 돌출 + 사이드뱅)
+40점: 주요 매칭 (예: 긴 얼굴형 + 어깨 기장)
+30점: 보조 매칭 (예: 넓은 이마 + 앞머리)
+20점: 추가 효과 (예: 사각턱 + S컬 웨이브)

[감산 조건]
-50점: 핵심 역효과 (예: 넓은 이마 + 앞머리 없음)
-40점: 주요 부조화 (예: 사각턱 + 턱선 단발)
-30점: 보조 부조화 (예: 광대 돌출 + 관자놀이 노출)
-20점: 경미한 부조화

[추천 임계값]
- 50점 이상: 추천 목록에 포함
- 30~49점: 조건부 추천 (다른 조건 충족 시)
- 30점 미만: 추천에서 제외

--------------------------------------------------------------------------------
5.2 최종 추천 출력
--------------------------------------------------------------------------------

Top 3~5 스타일 출력 시 포함 정보:
1. 스타일 ID (예: FAL0001)
2. 스타일 이름
3. 매칭 점수
4. 추천 이유 (어떤 조건에 매칭되었는지)

================================================================================
제6부. 시스템 고도화를 위한 태깅 권장사항
================================================================================

이 알고리즘이 헤어스타일 데이터베이스와 원활하게 작동하려면,
DB의 각 스타일에 '형태적 속성(Morphological Attributes)' 태그 추가를 권장합니다.

--------------------------------------------------------------------------------
6.1 현재 태그 구조
--------------------------------------------------------------------------------

- mainCategory: A LENGTH, B LENGTH, ... 또는 SF, SP, FU, ...
- subCategory: N, FH, EB, E, CB
- type: cut 또는 perm

--------------------------------------------------------------------------------
6.2 추가 권장 태그
--------------------------------------------------------------------------------

| 태그명 | 타입 | 설명 | 용도 |
|--------|------|------|------|
| side_volume | Boolean | 옆 볼륨이 있는가? | 긴 얼굴형 매칭용 |
| jaw_coverage | Boolean | 턱선을 감싸는가? | 사각턱 매칭용 |
| neck_exposure | Boolean | 목이 드러나는가? | 목 짧은 체형 매칭용 |
| forehead_coverage | Boolean | 이마를 가리는가? | 넓은 이마 매칭용 |
| cheek_coverage | Boolean | 광대를 가리는가? | 광대 돌출 매칭용 |
| top_volume | Boolean | 정수리 볼륨이 있는가? | 둥근 얼굴형 매칭용 |

이 태그들이 추가되면, 단순 매칭이 아닌
'논리적 설득력'을 갖춘 전문가 수준의 추천 시스템이 완성됩니다.

================================================================================
[HairGator RAG 활용 예시]
================================================================================

질문: "이마가 넓은데 어떤 앞머리가 어울려요?"
답변: 상안부 비율이 0.36 이상인 경우 EB(눈썹 라인) 또는 E(눈 높이) 앞머리를
추천드립니다. FH(이마 중간) 기장도 좋습니다. N(앞머리 없음)이나 PB(뒤로 넘김)
스타일은 이마가 더 넓어 보일 수 있어 피하시는 것이 좋습니다.

질문: "얼굴이 긴 편인데 어떤 기장이 좋을까요?"
답변: 긴 얼굴형에는 C~E LENGTH(쇄골~어깨 기장)를 추천드립니다.
사이드 볼륨이 있는 펌을 곁들이면 가로 볼륨이 세로 길이를 상쇄해
균형 잡힌 인상을 줄 수 있습니다. A, B LENGTH 같은 긴 생머리나
정수리 볼륨은 얼굴이 더 길어 보일 수 있어 피하세요.

질문: "사각턱인데 단발 해도 될까요?"
답변: 사각턱(Cheekbone_Prominence < 1.15)이시라면 턱선 단발(F, G LENGTH)보다는
턱 아래로 내려오는 A~D LENGTH가 더 어울립니다. 꼭 단발을 원하신다면
S컬 웨이브나 레이어드 스타일로 부드러운 곡선을 추가하시면
각진 인상을 완화할 수 있습니다.

질문: "광대가 튀어나왔는데 어떻게 커버해요?"
답변: Cheekbone_Prominence > 1.45인 역삼각형/하트형 얼굴에는
CB(광대뼈 높이) 앞머리인 애교머리나 긴 사이드뱅이 효과적입니다.
F LENGTH 보브컷 계열도 광대를 자연스럽게 감싸줍니다.
관자놀이가 드러나는 스타일이나 긴 생머리(A LENGTH)는
오히려 광대가 더 강조될 수 있습니다.

================================================================================
참고 문헌 및 기술 스택
================================================================================

[랜드마크 추출 기술]
- MediaPipe Face Mesh: 468개 3D 랜드마크 (Google)
- Dlib: 68개 2D 랜드마크
- OpenCV: 이미지 처리

[얼굴 비율 분석 이론]
- 황금비(Golden Ratio): 1:1.618
- 삼등분 법칙(Rule of Thirds): 상안부:중안부:하안부 = 1:1:1
- 캔터스 간 거리(Intercanthal Distance) 분석

[헤어스타일 매칭 원리]
- 시각적 균형(Visual Balance): 얼굴의 약점을 보완하는 스타일 선택
- 비율 보정(Proportion Correction): 길이/너비 비율 조정
- 윤곽 보정(Contour Correction): 얼굴 윤곽의 각진/둥근 부분 보완

================================================================================
마지막 업데이트: 2025-12-26
버전: Hairgator Algorithm v1.0
================================================================================
