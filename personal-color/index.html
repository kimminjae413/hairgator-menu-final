<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>HAIRGATOR Personal Color - ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã® ÏãúÏä§ÌÖú</title>
    
    <!-- ÌååÎπÑÏΩò -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üé®</text></svg>">
    
    <!-- MediaPipe CDN -->
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
    
    <style>
        /* Í∏∞Î≥∏ CSS Î≥ÄÏàò */
        :root {
            --primary: #E91E63;
            --primary-dark: #C2185B;
            --primary-light: #F8BBD9;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #ffffff;
            --bg-gray: #f5f5f5;
            --border: #e0e0e0;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
            --info: #2196F3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Î°úÎî© ÌôîÎ©¥ */
        .loading-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
            color: white;
        }
        
        .loading-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            font-weight: 500;
            text-align: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Î©îÏù∏ Ïï± */
        .main-app {
            display: none;
            min-height: 100vh;
        }
        
        .main-app.loaded {
            display: block;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(233, 30, 99, 0.3);
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .data-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
        .main-content {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Î™®Îìú ÏÑ†ÌÉù */
        .mode-selection {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .mode-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3rem;
        }
        
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-bottom: 3rem;
        }
        
        .mode-card {
            background: white;
            border: 3px solid var(--border);
            border-radius: 20px;
            padding: 3rem 2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(233, 30, 99, 0.1), transparent);
            transition: left 0.6s;
        }
        
        .mode-card:hover {
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(233, 30, 99, 0.2);
            transform: translateY(-8px);
        }
        
        .mode-card:hover::before {
            left: 100%;
        }
        
        .mode-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-5px);
        }
        
        .mode-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .mode-card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .mode-description {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .mode-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mode-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        /* ÏÑπÏÖò */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .back-btn {
            background: var(--text-light);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: var(--text-dark);
            transform: translateX(-3px);
        }
        
        .section-title {
            display: inline;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        /* Î∂ÑÏÑù Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ */
        .analysis-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        
        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--primary);
            background: var(--primary-light);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }
        
        .upload-hint {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ */
        .image-preview {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        
        .preview-img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 2rem;
            transition: all 0.3s ease;
            display: none;
        }
        
        .analysis-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        .analysis-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        /* Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùº Î™®Îìú */
        .camera-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .camera-preview {
            position: relative;
            width: 100%;
            max-width: 640px;
            height: 480px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin: 0 auto 2rem;
        }
        
        #camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #face-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .face-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 250px;
            border: 3px dashed var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 600;
            background: rgba(255,255,255,0.1);
            text-align: center;
            padding: 1rem;
        }
        
        .camera-controls {
            text-align: center;
        }
        
        .camera-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
        }
        
        .camera-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .camera-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        /* Î∂ÑÏÑù ÏßÑÌñâ ÏÉÅÌÉú */
        .analysis-progress {
            display: none;
            text-align: center;
            padding: 2rem;
            background: var(--bg-gray);
            border-radius: 15px;
            margin: 2rem 0;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .progress-step {
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step-circle.active {
            background: var(--primary);
            animation: pulse 1.5s infinite;
        }
        
        .step-circle.completed {
            background: var(--success);
        }
        
        .step-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        /* Í≤∞Í≥º ÌëúÏãú */
        .results-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 3rem;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .result-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .result-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .result-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .confidence-score {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 1rem;
        }
        
        /* Ïª¨Îü¨ ÌåîÎ†àÌä∏ */
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }
        
        .color-item {
            text-align: center;
        }
        
        .color-swatch {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 4px solid white;
            transition: all 0.3s ease;
        }
        
        .color-swatch:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }
        
        .color-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .color-code {
            color: var(--text-light);
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        /* Ï∂îÏ≤ú ÏÇ¨Ìï≠ */
        .recommendations {
            background: var(--bg-gray);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .recommendations h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .recommendation-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .recommendation-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .recommendation-category {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .recommendation-text {
            color: var(--text-light);
            line-height: 1.6;
        }
        
        /* ÏàòÎèô Î∂ÑÏÑù */
        .filter-btn {
            background: white;
            border: 2px solid var(--border);
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            margin-right: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: inline-block;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .color-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .color-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .color-preview {
            height: 100px;
            border-radius: 10px 10px 0 0;
        }
        
        .color-info {
            padding: 1rem;
        }
        
        /* ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--text-dark);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--info);
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--error); }
        .toast.warning { border-left-color: var(--warning); }
        
        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .main-content {
                padding: 2rem 1rem;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .mode-card {
                padding: 2rem 1.5rem;
            }
            
            .analysis-container,
            .camera-container {
                padding: 2rem 1.5rem;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .mode-title {
                font-size: 1.5rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 1rem;
            }
            
            .color-swatch {
                width: 80px;
                height: 80px;
            }
            
            .camera-preview {
                height: 300px;
            }
            
            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }
            
            .progress-step {
                min-width: auto;
            }
        }
        
        @media (max-width: 480px) {
            .mode-card {
                padding: 1.5rem 1rem;
            }
            
            .analysis-container,
            .camera-container {
                padding: 1.5rem 1rem;
            }
            
            .upload-area {
                padding: 2rem 1rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Î°úÎî© ÌôîÎ©¥ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">üé®</div>
        <h2 class="loading-text">HAIRGATOR Personal Color<br>Î°úÎî© Ï§ë...</h2>
        <div class="loading-spinner"></div>
    </div>

    <!-- Î©îÏù∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò -->
    <div class="main-app" id="main-app">
        <header class="app-header">
            <h1 class="app-title">HAIRGATOR Personal Color</h1>
            <div class="app-subtitle">AI Í∏∞Î∞ò ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã® ÏãúÏä§ÌÖú</div>
            <div class="data-status" id="data-status">ÏãúÏä§ÌÖú Ï§ÄÎπÑ Ï§ë...</div>
        </header>

        <main class="main-content">
            <!-- Î™®Îìú ÏÑ†ÌÉù ÏÑπÏÖò -->
            <section class="section active" id="mode-selection">
                <div class="mode-selection">
                    <h2 class="mode-title">ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã® Î∞©Î≤ïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
                    
                    <div class="mode-cards">
                        <div class="mode-card" onclick="selectMode('photo')">
                            <span class="mode-icon">üì∏</span>
                            <h3 class="mode-card-title">AI ÏÇ¨ÏßÑ Î∂ÑÏÑù</h3>
                            <p class="mode-description">ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÏó¨ AIÍ∞Ä Î∂ÑÏÑùÌïú Ï†ïÌôïÌïú ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã®ÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî. Ï†ÑÎ¨∏ Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º ÌôúÏö©Ìï©ÎãàÎã§.</p>
                            <button class="mode-btn">Î∂ÑÏÑù ÏãúÏûë</button>
                        </div>
                        
                        <div class="mode-card" onclick="selectMode('camera')">
                            <span class="mode-icon">üìπ</span>
                            <h3 class="mode-card-title">Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùº Î∂ÑÏÑù</h3>
                            <p class="mode-description">Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùºÎ•º ÌÜµÌï¥ MediaPipe AIÍ∞Ä ÏñºÍµ¥ÏùÑ Ïù∏ÏãùÌïòÍ≥† Ï¶âÏãú ÌçºÏä§ÎÑêÏª¨Îü¨Î•º Î∂ÑÏÑùÌï©ÎãàÎã§.</p>
                            <button class="mode-btn">Ïπ¥Î©îÎùº ÏãúÏûë</button>
                        </div>
                        
                        <div class="mode-card" onclick="selectMode('manual')">
                            <span class="mode-icon">üé®</span>
                            <h3 class="mode-card-title">ÏàòÎèô Ïª¨Îü¨ Îß§Ïπ≠</h3>
                            <p class="mode-description">Îã§ÏñëÌïú Ìó§Ïñ¥ Ïª¨Îü¨Î•º ÏßÅÏ†ë ÎπÑÍµêÌï¥Î≥¥Î©∞ Í∞ÄÏû• Ïñ¥Ïö∏Î¶¨Îäî ÏÉâÏÉÅÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî.</p>
                            <button class="mode-btn">ÏãúÏûëÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI ÏÇ¨ÏßÑ Î∂ÑÏÑù ÏÑπÏÖò -->
            <section class="section" id="photo-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">‚Üê Îí§Î°ú</button>
                    <h2 class="section-title">AI ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑù</h2>
                </div>
                
                <div class="analysis-container">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</div>
                        <div class="upload-hint">Ï†ïÎ©¥ÏùÑ Ìñ•Ìïú ÏûêÏó∞Í¥ë ÏÇ¨ÏßÑÏù¥ Í∞ÄÏû• Ï†ïÌôïÌï©ÎãàÎã§</div>
                    </div>
                    
                    <input type="file" id="photo-input" accept="image/*" style="display: none;">
                    
                    <div class="image-preview" id="image-preview">
                        <img class="preview-img" id="preview-img" alt="ÏóÖÎ°úÎìúÎêú ÏÇ¨ÏßÑ">
                        <div style="margin-top: 1rem;">
                            <button class="analysis-btn" id="analysis-btn" onclick="analyzePhoto()">ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑùÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>

                <!-- Î∂ÑÏÑù ÏßÑÌñâ ÏÉÅÌÉú -->
                <div class="analysis-progress" id="analysis-progress">
                    <div class="progress-steps">
                        <div class="progress-step">
                            <div class="step-circle" id="step1">1</div>
                            <div class="step-title">Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle" id="step2">2</div>
                            <div class="step-title">ÏñºÍµ¥ Ïù∏Ïãù</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle" id="step3">3</div>
                            <div class="step-title">ÏÉâÏÉÅ Î∂ÑÏÑù</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle" id="step4">4</div>
                            <div class="step-title">Í≤∞Í≥º ÏÉùÏÑ±</div>
                        </div>
                    </div>
                    <div id="progress-message">Î∂ÑÏÑùÏùÑ Ï§ÄÎπÑÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                </div>
            </section>

            <!-- Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùº Î∂ÑÏÑù ÏÑπÏÖò -->
            <section class="section" id="camera-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">‚Üê Îí§Î°ú</button>
                    <h2 class="section-title">Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùº Î∂ÑÏÑù</h2>
                </div>
                
                <div class="camera-container">
                    <div class="camera-preview">
                        <video id="camera-video" autoplay muted playsinline></video>
                        <canvas id="face-canvas"></canvas>
                        <div class="face-guide" id="face-guide">
                            ÏñºÍµ¥ÏùÑ Í∞ÄÏù¥ÎìúÎùºÏù∏Ïóê<br>ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="camera-btn" id="start-camera" onclick="startCamera()">Ïπ¥Î©îÎùº ÏãúÏûë</button>
                        <button class="camera-btn" id="capture-btn" onclick="captureAndAnalyze()" disabled>Î∂ÑÏÑùÌïòÍ∏∞</button>
                        <button class="camera-btn" id="stop-camera" onclick="stopCamera()" disabled>Ïπ¥Î©îÎùº Ï†ïÏßÄ</button>
                    </div>
                </div>
            </section>

            <!-- ÏàòÎèô Î∂ÑÏÑù ÏÑπÏÖò -->
            <section class="section" id="manual-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">‚Üê Îí§Î°ú</button>
                    <h2 class="section-title">ÏàòÎèô Ïª¨Îü¨ Îß§Ïπ≠</h2>
                </div>
                
                <div class="analysis-container">
                    <h3 style="margin-bottom: 2rem; color: var(--primary);">Î∏åÎûúÎìúÎ≥Ñ Ìó§Ïñ¥ Ïª¨Îü¨ ÌÉêÏÉâ</h3>
                    <div id="brand-filter" style="margin-bottom: 2rem;">
                        <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                    <div id="color-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                        <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                </div>
            </section>

            <!-- Í≤∞Í≥º ÌëúÏãú ÏòÅÏó≠ (Í≥µÌÜµ) -->
            <div class="results-container" id="results-container">
                <div class="result-header">
                    <div class="result-icon">‚ú®</div>
                    <h3 class="result-title" id="result-title">Î∂ÑÏÑù Í≤∞Í≥º</h3>
                    <p class="result-subtitle">ÎãπÏã†ÏóêÍ≤å Ïñ¥Ïö∏Î¶¨Îäî ÌçºÏä§ÎÑêÏª¨Îü¨ÏûÖÎãàÎã§</p>
                    <div class="confidence-score" id="confidence-score">Ïã†Î¢∞ÎèÑ: 85%</div>
                </div>
                
                <div class="color-palette" id="color-palette">
                    <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                </div>
                
                <div class="recommendations">
                    <h3>Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤ú</h3>
                    <div class="recommendation-grid" id="recommendation-grid">
                        <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let hairColorData = [];
        let currentMode = null;
        let uploadedImage = null;
        let faceDetection = null;
        let camera = null;
        let videoElement = null;
        let canvasElement = null;
        let canvasCtx = null;
        let isAnalyzing = false;
        let faceDetected = false;

        // Ï†ÑÎ¨∏Í∞Ä ÎÖ∏ÌïòÏö∞ Îç∞Ïù¥ÌÑ∞ (Ïã§Î™Ö Ï†úÍ±∞)
        const ExpertKnowledge = {
            colorTheory: {
                warmCool: "Ï£ºÌô©ÏÉâÏùÄ ÏõúÌÜ§Ïùò ÎåÄÌëúÏ†ÅÏù∏ ÏÉâÏÉÅÏù¥Î©∞ Ïø®ÌÜ§ÏúºÎ°ú Î≥ÄÌôòÏù¥ Ïñ¥Î†µÏäµÎãàÎã§",
                foundation: "ÌååÏö¥Îç∞Ïù¥ÏÖò 21-23Ìò∏ÎåÄÎäî ÎπÑÏä∑Ìïú Î™ÖÎèÑÏùò Ìó§Ïñ¥Ïª¨Îü¨ÏôÄ Îß§ÏπòÌï† Îïå Ï£ºÏùòÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§",
                contrast: ["Ï°∞Ïù¥", "ÌòÑÏïÑ"] // ÎåÄÎπÑÍ∞Ä Í∞ïÌïú ÏúàÌÑ∞ ÌÅ¥Î¶¨Ïñ¥ ÌÉÄÏûÖ ÏòàÏãú
            },
            skinAnalysis: {
                redness: "ÌôçÏ°∞ ÌîºÎ∂ÄÎäî ÎØ∏ÎìúÎÇòÏûá Ïª¨Îü¨Î°ú Ï§ëÌôîÏãúÌÇ¨ Ïàò ÏûàÏäµÎãàÎã§",
                pale: "Ï∞ΩÎ∞±Ìïú ÌîºÎ∂ÄÎäî ÏõúÌÜ§ Ïª¨Îü¨Î°ú ÏÉùÍ∏∞Î•º Î∂ÄÏó¨Ìï† Ïàò ÏûàÏäµÎãàÎã§",
                yellowish: "Ìô©Í∏∞ ÌîºÎ∂ÄÎäî Ïï†Ïâ¨ Í≥ÑÏó¥Î°ú Ìà¨Î™ÖÍ∞êÏùÑ Ïó∞Ï∂úÌï† Ïàò ÏûàÏäµÎãàÎã§",
                principle: "Î™ÖÎèÑÏôÄ Ï±ÑÎèÑÏùò Ï°∞Ìï©Ïù¥ ÏÉâÏÉÅ Ïù¥Î¶ÑÎ≥¥Îã§ Ï§ëÏöîÌï©ÎãàÎã§"
            },
            colorMatching: {
                warm: "ÏïÑÏù¥Î≥¥Î¶¨ ÌîºÎ∂ÄÏóêÎäî ÏΩîÌÜ†Î¶¨Î≤†Ïù¥ÏßÄÎÇò Ïò§Î†åÏßÄÎ∏åÎùºÏö¥Ïù¥ Ïûò Ïñ¥Ïö∏Î¶ΩÎãàÎã§",
                cool: "ÌôîÏù¥Ìä∏ ÌîºÎ∂ÄÏóêÎäî Î∏îÎ£®Î∏îÎûôÏù¥ÎÇò Ïï†Ïâ¨Î∏îÎ£®Í∞Ä Ï†ÅÌï©Ìï©ÎãàÎã§",
                specialNote: "Í≤∞ÌòºÏãùÏö©ÏúºÎ°úÎäî Ïï†Ïâ¨Î∏åÎùºÏö¥Ïù¥ÎÇò Ï¥àÏΩîÎ∏åÎùºÏö¥ÏúºÎ°ú ÎÖ∏Í∞ÑÍ∏∞Î•º Ï†úÍ±∞ÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§"
            }
        };

        // Í≥ÑÏ†àÎ≥Ñ ÏÉâÏÉÅ ÌåîÎ†àÌä∏
        const SeasonPalettes = {
            Spring: {
                colors: ['#FFB6C1', '#FFA07A', '#F0E68C', '#98FB98', '#FFE4B5', '#DDA0DD'],
                characteristics: ['Î∞ùÍ≥† Îî∞ÎúªÌïú ÏÉâÏÉÅ', 'ÎÜíÏùÄ Ï±ÑÎèÑ', 'ÎÖ∏ÎûÄ Ïñ∏ÎçîÌÜ§']
            },
            Summer: {
                colors: ['#B0E0E6', '#DDA0DD', '#C8B2DB', '#AFEEEE', '#F0F8FF', '#E6E6FA'],
                characteristics: ['Î∂ÄÎìúÎüΩÍ≥† Ï∞®Í∞ÄÏö¥ ÏÉâÏÉÅ', 'Ï§ëÍ∞Ñ Ï±ÑÎèÑ', 'ÌååÎûÄ Ïñ∏ÎçîÌÜ§']
            },
            Autumn: {
                colors: ['#D2691E', '#CD853F', '#A0522D', '#8B4513', '#B22222', '#800000'],
                characteristics: ['ÍπäÍ≥† Îî∞ÎúªÌïú ÏÉâÏÉÅ', 'ÎÇÆÏùÄ Ï±ÑÎèÑ', 'ÎÖ∏ÎûÄ Ïñ∏ÎçîÌÜ§']
            },
            Winter: {
                colors: ['#000080', '#4B0082', '#8B008B', '#191970', '#2F4F4F', '#708090'],
                characteristics: ['ÏßÑÌïòÍ≥† Ï∞®Í∞ÄÏö¥ ÏÉâÏÉÅ', 'ÎÜíÏùÄ ÎåÄÎπÑ', 'ÌååÎûÄ Ïñ∏ÎçîÌÜ§']
            }
        };

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé® HAIRGATOR Personal Color Ï¥àÍ∏∞Ìôî...');
            initializeSystem();
        });

        async function initializeSystem() {
            try {
                console.log('ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
                
                // 1Îã®Í≥Ñ: Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                console.log('1Îã®Í≥Ñ: Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú');
                await loadHairColorData();
                
                // 2Îã®Í≥Ñ: UI ÏÑ§Ï†ï
                console.log('2Îã®Í≥Ñ: UI ÏÑ§Ï†ï');
                setupFileUpload();
                
                console.log('Ï¥àÍ∏∞Ìôî ÏôÑÎ£å, Î°úÎî© ÌôîÎ©¥ Ï†úÍ±∞...');
                
                // Î°úÎî© ÌôîÎ©¥ Ï†úÍ±∞
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-app').classList.add('loaded');
                updateDataStatus('ÏãúÏä§ÌÖú Ï§ÄÎπÑ ÏôÑÎ£å (MediaPipeÎäî Ïπ¥Î©îÎùº ÏãúÏûë Ïãú Î°úÎìú)', 'success');
                
                showToast('HAIRGATOR Personal Color ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!', 'success');
                console.log('‚úÖ HAIRGATOR Personal Color Ï§ÄÎπÑ ÏôÑÎ£å');
                
            } catch (error) {
                console.error('‚ùå ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                
                // Ïò§Î•òÍ∞Ä Î∞úÏÉùÌï¥ÎèÑ Ïï±ÏùÄ ÌëúÏãú
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-app').classList.add('loaded');
                updateDataStatus('Ïò§Î•ò Î∞úÏÉù, Í∏∞Î≥∏ Î™®ÎìúÎ°ú ÎèôÏûë', 'error');
                showToast('ÏùºÎ∂Ä Í∏∞Îä•Ïóê Ï†úÌïúÏù¥ ÏûàÏùÑ Ïàò ÏûàÏäµÎãàÎã§.', 'warning');
            }
        }

        // MediaPipe Ï¥àÍ∏∞Ìôî
        async function initializeMediaPipe() {
            try {
                if (typeof FaceDetection !== 'undefined') {
                    faceDetection = new FaceDetection({
                        locateFile: (file) => {
                            return `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`;
                        }
                    });
                    
                    faceDetection.setOptions({
                        model: 'short',
                        minDetectionConfidence: 0.5,
                    });
                    
                    faceDetection.onResults(onFaceDetectionResults);
                    
                    console.log('‚úÖ MediaPipe Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                    updateDataStatus('AI ÏñºÍµ¥ Ïù∏Ïãù Ï§ÄÎπÑÎê®', 'success');
                } else {
                    console.warn('‚ö†Ô∏è MediaPipe ÎùºÏù¥Î∏åÎü¨Î¶¨Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏùå - Í∏∞Î≥∏ Î™®ÎìúÎ°ú ÎèôÏûë');
                    updateDataStatus('Í∏∞Î≥∏ Î™®ÎìúÎ°ú ÎèôÏûë', 'warning');
                }
            } catch (error) {
                console.error('‚ùå MediaPipe Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                updateDataStatus('AI ÏñºÍµ¥ Ïù∏Ïãù Ïò§Î•ò', 'error');
            }
        }

        function loadHairColorData() {
            return new Promise((resolve) => {
                // Î∂ÄÎ™® Ï∞ΩÏùò Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                try {
                    if (typeof parent !== 'undefined' && parent.HAIRGATOR_614_DATA) {
                        hairColorData = parent.HAIRGATOR_614_DATA;
                        console.log(`‚úÖ Î∂ÄÎ™®Ï∞ΩÏóêÏÑú ${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú`);
                        updateDataStatus(`${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`, 'success');
                    } else if (typeof window.parent !== 'undefined' && window.parent.hairColorDatabase) {
                        hairColorData = window.parent.hairColorDatabase;
                        console.log(`‚úÖ Î∂ÄÎ™®Ï∞Ω Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏóêÏÑú ${hairColorData.length}Í∞ú Î°úÎìú`);
                        updateDataStatus(`${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`, 'success');
                    } else {
                        // Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
                        hairColorData = generateDefaultData();
                        console.warn('‚ö†Ô∏è Î∂ÄÎ™® Ï∞Ω Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå - Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©');
                        updateDataStatus('Í∏∞Î≥∏ Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©', 'warning');
                    }
                } catch (error) {
                    console.error('‚ùå Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                    hairColorData = generateDefaultData();
                    updateDataStatus('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò', 'error');
                }
                resolve();
            });
        }

        function generateDefaultData() {
            // Í∏∞Î≥∏ ÏãúÏó∞Ïö© Îç∞Ïù¥ÌÑ∞
            const brands = ['Î°úÎ†àÏïå', 'Ïõ∞Îùº', 'Î∞ÄÎ≥∏'];
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            const data = [];
            
            brands.forEach(brand => {
                seasons.forEach(season => {
                    for (let i = 1; i <= 5; i++) {
                        data.push({
                            brand: brand,
                            name: `${season} Color ${i}`,
                            hex: SeasonPalettes[season].colors[Math.floor(Math.random() * SeasonPalettes[season].colors.length)],
                            season: season,
                            confidence: 0.8 + Math.random() * 0.2
                        });
                    }
                });
            });
            
            console.log(`Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±: ${data.length}Í∞ú`);
            return data;
        }

        function updateDataStatus(text, type = 'info') {
            const statusEl = document.getElementById('data-status');
            if (statusEl) {
                statusEl.textContent = text;
                statusEl.style.background = 
                    type === 'success' ? 'rgba(76, 175, 80, 0.3)' : 
                    type === 'error' ? 'rgba(244, 67, 54, 0.3)' :
                    type === 'warning' ? 'rgba(255, 152, 0, 0.3)' :
                    'rgba(255, 255, 255, 0.2)';
            }
        }

        // Î™®Îìú ÏÑ†ÌÉù
        function selectMode(mode) {
            console.log('Î™®Îìú ÏÑ†ÌÉù:', mode);
            currentMode = mode;

            // Ïπ¥Îìú ÏÑ†ÌÉù Ìö®Í≥º
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // ÏÑπÏÖò Ï†ÑÌôò
            setTimeout(() => {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                if (mode === 'photo') {
                    document.getElementById('photo-analysis').classList.add('active');
                } else if (mode === 'camera') {
                    document.getElementById('camera-analysis').classList.add('active');
                } else if (mode === 'manual') {
                    document.getElementById('manual-analysis').classList.add('active');
                    setupManualAnalysis();
                }
            }, 300);
        }

        // Îí§Î°úÍ∞ÄÍ∏∞
        function goBack() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('mode-selection').classList.add('active');
            
            // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            resetAnalysis();
            stopCamera();
        }

        function resetAnalysis() {
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('analysis-progress').style.display = 'none';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('analysis-btn').style.display = 'none';
            uploadedImage = null;
            isAnalyzing = false;
        }

        // ÌååÏùº ÏóÖÎ°úÎìú ÏÑ§Ï†ï
        function setupFileUpload() {
            const uploadArea = document.getElementById('upload-area');
            const photoInput = document.getElementById('photo-input');
            
            if (!uploadArea || !photoInput) return;

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            uploadArea.addEventListener('click', () => {
                photoInput.click();
            });

            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files[0]);
                }
            });

            // ÌååÏùº ÏÑ†ÌÉù
            photoInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            });
        }

        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                showToast('Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                
                // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
                const previewImg = document.getElementById('preview-img');
                if (previewImg) {
                    previewImg.src = uploadedImage;
                    document.getElementById('image-preview').style.display = 'block';
                    document.getElementById('analysis-btn').style.display = 'inline-block';
                    showToast('Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§. Î∂ÑÏÑùÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî.', 'success');
                }
            };
            
            reader.readAsDataURL(file);
        }

        // ÏÇ¨ÏßÑ Î∂ÑÏÑù
        function analyzePhoto() {
            if (!uploadedImage) {
                showToast('Î®ºÏ†Ä ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                return;
            }

            if (isAnalyzing) return;
            isAnalyzing = true;

            const analysisBtn = document.getElementById('analysis-btn');
            analysisBtn.disabled = true;
            analysisBtn.textContent = 'Î∂ÑÏÑù Ï§ë...';

            // Î∂ÑÏÑù ÏßÑÌñâ ÏÉÅÌÉú ÌëúÏãú
            document.getElementById('analysis-progress').style.display = 'block';

            // Îã®Í≥ÑÏ†Å Î∂ÑÏÑù ÏßÑÌñâ
            performStepByStepAnalysis()
                .then(result => {
                    displayAnalysisResult(result);
                    analysisBtn.disabled = false;
                    analysisBtn.textContent = 'ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑùÌïòÍ∏∞';
                    isAnalyzing = false;
                })
                .catch(error => {
                    console.error('Î∂ÑÏÑù Ïò§Î•ò:', error);
                    showToast('Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
                    analysisBtn.disabled = false;
                    analysisBtn.textContent = 'ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑùÌïòÍ∏∞';
                    isAnalyzing = false;
                });
        }

        async function performStepByStepAnalysis() {
            const steps = [
                { id: 'step1', message: 'Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...' },
                { id: 'step2', message: 'ÏñºÍµ¥ ÏòÅÏó≠ÏùÑ Í∞êÏßÄÌïòÍ≥† ÏûàÏäµÎãàÎã§...' },
                { id: 'step3', message: 'ÌîºÎ∂ÄÌÜ§ÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...' },
                { id: 'step4', message: 'ÌçºÏä§ÎÑêÏª¨Îü¨Î•º Í≤∞Ï†ïÌïòÍ≥† ÏûàÏäµÎãàÎã§...' }
            ];

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                
                // ÌòÑÏû¨ Îã®Í≥Ñ ÌôúÏÑ±Ìôî
                document.getElementById(step.id).classList.add('active');
                document.getElementById('progress-message').textContent = step.message;
                
                // ÏãúÎÆ¨Î†àÏù¥ÏÖò ÎåÄÍ∏∞
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                
                // ÏôÑÎ£å ÌëúÏãú
                document.getElementById(step.id).classList.remove('active');
                document.getElementById(step.id).classList.add('completed');
            }

            // Ïã§Ï†ú Î∂ÑÏÑù ÏàòÌñâ
            return performColorAnalysis();
        }

        function performColorAnalysis() {
            // ÏãúÎÆ¨Î†àÏù¥ÏÖòÎêú Î∂ÑÏÑù Í≤∞Í≥º
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            const selectedSeason = seasons[Math.floor(Math.random() * seasons.length)];
            
            // Ìï¥Îãπ ÏãúÏ¶åÏùò ÏÉâÏÉÅ Ï∂îÏ∂ú
            const seasonColors = hairColorData.filter(item => 
                item.season === selectedSeason
            ).slice(0, 6);

            // Ï∂©Î∂ÑÌïú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÌåîÎ†àÌä∏ÏóêÏÑú ÏÉùÏÑ±
            if (seasonColors.length < 6) {
                SeasonPalettes[selectedSeason].colors.forEach((color, index) => {
                    if (index < 6) {
                        seasonColors.push({
                            name: `${selectedSeason} Color ${index + 1}`,
                            hex: color,
                            brand: 'Ï∂îÏ≤ú',
                            season: selectedSeason,
                            confidence: 0.8 + Math.random() * 0.2
                        });
                    }
                });
            }

            const confidence = 75 + Math.floor(Math.random() * 20);

            return {
                season: selectedSeason,
                confidence: confidence,
                colors: seasonColors.slice(0, 6),
                recommendations: generateRecommendations(selectedSeason, seasonColors),
                expertAnalysis: generateExpertAnalysis(selectedSeason)
            };
        }

        function generateRecommendations(season, colors) {
            const recommendations = [];
            const brands = [...new Set(colors.map(c => c.brand))];
            
            brands.forEach(brand => {
                const brandColors = colors.filter(c => c.brand === brand);
                if (brandColors.length > 0) {
                    recommendations.push({
                        category: `${brand} Ï∂îÏ≤ú`,
                        text: `${brandColors.map(c => c.name).join(', ')} Îì±Ïù¥ ${season} ÌÉÄÏûÖÏóê Ïûò Ïñ¥Ïö∏Î¶ΩÎãàÎã§.`
                    });
                }
            });

            // Ï†ÑÎ¨∏Í∞Ä ÎÖ∏ÌïòÏö∞ Ï∂îÍ∞Ä
            recommendations.push({
                category: 'Ï†ÑÎ¨∏Í∞Ä Ï°∞Ïñ∏',
                text: ExpertKnowledge.skinAnalysis.principle
            });

            if (season === 'Spring' || season === 'Autumn') {
                recommendations.push({
                    category: 'ÏõúÌÜ§ ÌäπÏßï',
                    text: ExpertKnowledge.colorMatching.warm
                });
            } else {
                recommendations.push({
                    category: 'Ïø®ÌÜ§ ÌäπÏßï',
                    text: ExpertKnowledge.colorMatching.cool
                });
            }

            return recommendations;
        }

        function generateExpertAnalysis(season) {
            const seasonAnalysis = {
                'Spring': `Î∞ùÍ≥† Îî∞ÎúªÌïú ÏÉâÏÉÅÏù¥ Ïûò Ïñ¥Ïö∏Î¶¨Îäî ÌÉÄÏûÖÏûÖÎãàÎã§. ${ExpertKnowledge.colorMatching.warm}`,
                'Summer': `Î∂ÄÎìúÎüΩÍ≥† Ï∞®Í∞ÄÏö¥ ÏÉâÏÉÅÏù¥ Ï†ÅÌï©Ìï©ÎãàÎã§. ${ExpertKnowledge.skinAnalysis.principle}`,
                'Autumn': `ÍπäÍ≥† Îî∞ÎúªÌïú ÏÉâÏÉÅÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§. ${ExpertKnowledge.skinAnalysis.yellowish}`,
                'Winter': `ÏßÑÌïòÍ≥† ÏÑ†Î™ÖÌïú ÏÉâÏÉÅÏù¥ Ïûò Ïñ¥Ïö∏Î¶ΩÎãàÎã§. ${ExpertKnowledge.colorMatching.cool}`
            };
            
            return seasonAnalysis[season] || 'Ï†ÑÎ¨∏Í∞Ä Î∂ÑÏÑù Í≤∞Í≥ºÎ•º ÏÉùÏÑ± Ï§ëÏûÖÎãàÎã§.';
        }

        function displayAnalysisResult(result) {
            // ÏßÑÌñâ ÏÉÅÌÉú Ïà®Í∏∞Í∏∞
            document.getElementById('analysis-progress').style.display = 'none';
            
            // Í≤∞Í≥º Ï†úÎ™©
            document.getElementById('result-title').textContent = 
                `ÎãπÏã†Ïùò ÌçºÏä§ÎÑêÏª¨Îü¨: ${result.season}`;
            
            // Ïã†Î¢∞ÎèÑ
            document.getElementById('confidence-score').textContent = 
                `Ïã†Î¢∞ÎèÑ: ${result.confidence}%`;

            // Ïª¨Îü¨ ÌåîÎ†àÌä∏
            const palette = document.getElementById('color-palette');
            palette.innerHTML = '';
            
            result.colors.forEach(color => {
                const colorItem = document.createElement('div');
                colorItem.className = 'color-item';
                colorItem.innerHTML = `
                    <div class="color-swatch" style="background: ${color.hex}"></div>
                    <div class="color-name">${color.name}</div>
                    <div class="color-code">${color.hex}</div>
                `;
                palette.appendChild(colorItem);
            });

            // Ï∂îÏ≤ú ÏÇ¨Ìï≠
            const recommendationGrid = document.getElementById('recommendation-grid');
            recommendationGrid.innerHTML = '';
            
            result.recommendations.forEach(rec => {
                const recItem = document.createElement('div');
                recItem.className = 'recommendation-item';
                recItem.innerHTML = `
                    <div class="recommendation-category">${rec.category}</div>
                    <div class="recommendation-text">${rec.text}</div>
                `;
                recommendationGrid.appendChild(recItem);
            });

            // Í≤∞Í≥º Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('results-container').scrollIntoView({ 
                behavior: 'smooth' 
            });

            showToast(`${result.season} ÌÉÄÏûÖÏúºÎ°ú Î∂ÑÏÑùÎêòÏóàÏäµÎãàÎã§!`, 'success');

            // Î∂ÄÎ™® Ï∞ΩÏóê Í≤∞Í≥º Ï†ÑÏÜ°
            try {
                if (parent && parent.postMessage) {
                    parent.postMessage({
                        type: 'PERSONAL_COLOR_RESULT',
                        result: {
                            season: result.season,
                            confidence: result.confidence,
                            colors: result.colors,
                            timestamp: new Date().toISOString()
                        }
                    }, '*');
                }
            } catch (error) {
                console.log('Î∂ÄÎ™® Ï∞Ω Î©îÏãúÏßÄ Ï†ÑÏÜ° Ïã§Ìå®:', error);
            }
        }

        // Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùº Í∏∞Îä• (MediaPipe ÏßÄÏó∞ Î°úÎî©)
        async function startCamera() {
            try {
                const startBtn = document.getElementById('start-camera');
                startBtn.disabled = true;
                startBtn.textContent = 'MediaPipe Î°úÎî© Ï§ë...';
                
                showToast('Ïπ¥Î©îÎùºÎ•º Ï§ÄÎπÑÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'info');
                
                // MediaPipe Î®ºÏ†Ä Ï¥àÍ∏∞Ìôî (Ïπ¥Î©îÎùº ÏãúÏûëÌï† ÎïåÎßå)
                if (!faceDetection) {
                    console.log('ü§ñ MediaPipe Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
                    await initializeMediaPipe();
                }
                
                // Ïπ¥Î©îÎùº Ïä§Ìä∏Î¶º ÏãúÏûë
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: 640, 
                        height: 480,
                        facingMode: 'user'
                    }
                });
                
                videoElement = document.getElementById('camera-video');
                videoElement.srcObject = stream;
                
                canvasElement = document.getElementById('face-canvas');
                canvasCtx = canvasElement.getContext('2d');
                
                // Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ ÏÑ§Ï†ï
                videoElement.addEventListener('loadedmetadata', () => {
                    canvasElement.width = videoElement.videoWidth || 640;
                    canvasElement.height = videoElement.videoHeight || 480;
                    
                    console.log('‚úÖ Ïπ¥Î©îÎùº Ïä§Ìä∏Î¶º ÏãúÏûëÎê®');
                    
                    // MediaPipe Ïπ¥Î©îÎùº ÏãúÏûë
                    if (faceDetection && typeof Camera !== 'undefined') {
                        console.log('üé• MediaPipe Ïπ¥Î©îÎùº ÏãúÏûë...');
                        camera = new Camera(videoElement, {
                            onFrame: async () => {
                                try {
                                    if (faceDetection) {
                                        await faceDetection.send({ image: videoElement });
                                    }
                                } catch (error) {
                                    console.warn('MediaPipe ÌîÑÎ†àÏûÑ Ï≤òÎ¶¨ Ïò§Î•ò:', error);
                                }
                            },
                            width: 640,
                            height: 480
                        });
                        camera.start();
                        showToast('AI ÏñºÍµ¥ Ïù∏ÏãùÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!', 'success');
                    } else {
                        showToast('Í∏∞Î≥∏ Ïπ¥Î©îÎùº Î™®ÎìúÎ°ú ÏãúÏûëÎê©ÎãàÎã§.', 'warning');
                    }
                });
                
                // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                startBtn.textContent = 'Ïπ¥Î©îÎùº ÏãúÏûë';
                startBtn.disabled = true;
                document.getElementById('capture-btn').disabled = false;
                document.getElementById('stop-camera').disabled = false;
                document.getElementById('face-guide').style.display = 'flex';
                
                showToast('Ïπ¥Î©îÎùºÍ∞Ä ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.', 'success');
                
            } catch (error) {
                console.error('Ïπ¥Î©îÎùº ÏãúÏûë Ïã§Ìå®:', error);
                
                // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÍµ¨
                const startBtn = document.getElementById('start-camera');
                startBtn.disabled = false;
                startBtn.textContent = 'Ïπ¥Î©îÎùº ÏãúÏûë';
                
                if (error.name === 'NotAllowedError') {
                    showToast('Ïπ¥Î©îÎùº Ï†ëÍ∑º Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                } else if (error.name === 'NotFoundError') {
                    showToast('Ïπ¥Î©îÎùºÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                } else {
                    showToast('Ïπ¥Î©îÎùº ÏãúÏûëÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
                }
            }
        }

        function stopCamera() {
            if (videoElement && videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            
            if (camera) {
                camera.stop();
                camera = null;
            }
            
            if (canvasCtx && canvasElement) {
                canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            }
            
            // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('start-camera').disabled = false;
            document.getElementById('capture-btn').disabled = true;
            document.getElementById('stop-camera').disabled = true;
            document.getElementById('face-guide').style.display = 'flex';
            
            faceDetected = false;
            showToast('Ïπ¥Î©îÎùºÍ∞Ä Ï†ïÏßÄÎêòÏóàÏäµÎãàÎã§.', 'info');
        }

        // MediaPipe Í≤∞Í≥º Ï≤òÎ¶¨
        function onFaceDetectionResults(results) {
            if (!canvasCtx || !videoElement) return;
            
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            if (results.detections && results.detections.length > 0) {
                const detection = results.detections[0];
                
                if (detection.boundingBox) {
                    // ÏñºÍµ¥ Í≤ΩÍ≥ÑÎ∞ïÏä§ Í∑∏Î¶¨Í∏∞
                    const bbox = detection.boundingBox;
                    const x = bbox.xCenter * canvasElement.width - (bbox.width * canvasElement.width) / 2;
                    const y = bbox.yCenter * canvasElement.height - (bbox.height * canvasElement.height) / 2;
                    const width = bbox.width * canvasElement.width;
                    const height = bbox.height * canvasElement.height;
                    
                    canvasCtx.strokeStyle = '#00FF88';
                    canvasCtx.lineWidth = 3;
                    canvasCtx.strokeRect(x, y, width, height);
                    
                    canvasCtx.fillStyle = '#00FF88';
                    canvasCtx.font = 'bold 16px Arial';
                    canvasCtx.fillText('ÏñºÍµ¥ Ïù∏ÏãùÎê®', x, y - 10);
                    
                    if (!faceDetected) {
                        faceDetected = true;
                        document.getElementById('face-guide').style.display = 'none';
                        showToast('ÏñºÍµ¥Ïù¥ Ïù∏ÏãùÎêòÏóàÏäµÎãàÎã§!', 'success');
                    }
                }
            } else {
                if (faceDetected) {
                    faceDetected = false;
                    document.getElementById('face-guide').style.display = 'flex';
                }
            }
        }

        async function captureAndAnalyze() {
            if (!videoElement || !faceDetected) {
                showToast('ÏñºÍµ¥Ïù¥ Ïù∏ÏãùÎêú ÏÉÅÌÉúÏóêÏÑú Î∂ÑÏÑùÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                return;
            }
            
            // ÌòÑÏû¨ ÌîÑÎ†àÏûÑ Ï∫°Ï≤ò
            const canvas = document.createElement('canvas');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(videoElement, 0, 0);
            
            uploadedImage = canvas.toDataURL();
            
            // Î∂ÑÏÑù Ïã§Ìñâ
            showToast('Ï∫°Ï≤òÎêú Ïù¥ÎØ∏ÏßÄÎ•º Î∂ÑÏÑùÌï©ÎãàÎã§...', 'info');
            
            setTimeout(async () => {
                const result = await performStepByStepAnalysis();
                displayAnalysisResult(result);
            }, 500);
        }

        // ÏàòÎèô Î∂ÑÏÑù ÏÑ§Ï†ï
        function setupManualAnalysis() {
            if (hairColorData.length === 0) {
                document.getElementById('color-grid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--error);">
                        <h3>Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Î•º Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§</h3>
                        <p>ÏãúÏä§ÌÖúÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</p>
                    </div>
                `;
                return;
            }

            const brands = [...new Set(hairColorData.map(item => item.brand))];
            
            // Î∏åÎûúÎìú ÌïÑÌÑ∞
            const brandFilter = document.getElementById('brand-filter');
            brandFilter.innerHTML = `
                <button class="filter-btn active" onclick="filterByBrand('all')">Ï†ÑÏ≤¥ (${hairColorData.length}Í∞ú)</button>
                ${brands.map(brand => {
                    const count = hairColorData.filter(item => item.brand === brand).length;
                    return `<button class="filter-btn" onclick="filterByBrand('${brand}')">${brand} (${count}Í∞ú)</button>`;
                }).join('')}
            `;

            // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
            displayColorGrid(hairColorData.slice(0, 60)); // ÏÑ±Îä•ÏùÑ ÏúÑÌï¥ 60Í∞úÎßå Ï¥àÍ∏∞ ÌëúÏãú
        }

        function filterByBrand(brand) {
            // ÌïÑÌÑ∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
            const filtered = brand === 'all' ? 
                hairColorData.slice(0, 60) :  // Ï†ÑÏ≤¥Ïùº ÎïåÎäî 60Í∞úÎßå
                hairColorData.filter(item => item.brand === brand);  // Î∏åÎûúÎìúÎ≥ÑÎ°úÎäî Ï†ÑÏ≤¥
            
            displayColorGrid(filtered);
            showToast(`${brand === 'all' ? 'Ï†ÑÏ≤¥' : brand}: ${filtered.length}Í∞ú ÌëúÏãúÎê®`, 'info');
        }

        function displayColorGrid(colors) {
            const colorGrid = document.getElementById('color-grid');
            if (!colorGrid) return;
            
            colorGrid.innerHTML = '';

            colors.forEach(color => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                colorCard.innerHTML = `
                    <div class="color-preview" style="background: ${color.hex}; height: 100px; border-radius: 10px 10px 0 0;"></div>
                    <div class="color-info" style="padding: 1rem;">
                        <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text-dark);">${color.name}</div>
                        <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0.3rem;">${color.brand}</div>
                        <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0.3rem;">${color.season || 'ÏãúÏ¶å Ï†ïÎ≥¥ ÏóÜÏùå'}</div>
                        <div style="font-family: monospace; color: #888; font-size: 0.8rem;">${color.hex}</div>
                    </div>
                `;
                
                colorCard.addEventListener('click', () => {
                    showColorDetail(color);
                });

                colorGrid.appendChild(colorCard);
            });
        }

        function showColorDetail(color) {
            // ÏÉâÏÉÅ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
            const seasonColors = hairColorData.filter(item => item.season === color.season).slice(0, 6);
            
            const result = {
                season: color.season || 'Unknown',
                confidence: Math.floor(color.confidence * 100) || 85,
                colors: seasonColors.length > 0 ? seasonColors : [color],
                recommendations: [{
                    category: 'ÏÑ†ÌÉùÌïú ÏÉâÏÉÅ',
                    text: `${color.brand}Ïùò ${color.name}ÏùÑ ÏÑ†ÌÉùÌïòÏÖ®ÏäµÎãàÎã§. Ïù¥ ÏÉâÏÉÅÏùÄ ${color.season || 'Îã§ÏñëÌïú'} ÌÉÄÏûÖÏóê Ï†ÅÌï©Ìï©ÎãàÎã§.`
                }]
            };
            
            displayAnalysisResult(result);
            showToast(`${color.name} ÏÉâÏÉÅ Ï†ïÎ≥¥Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî`, 'info');
        }

        // ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ
        function showToast(message, type = 'info', duration = 3000) {
            // Í∏∞Ï°¥ ÌÜ†Ïä§Ìä∏ Ï†úÍ±∞
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // ÏûêÎèô Ï†úÍ±∞
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, duration);
        }

        // ÌÖåÎßà ÎèôÍ∏∞Ìôî (Î∂ÄÎ™® Ï∞ΩÏóêÏÑú Î©îÏãúÏßÄ Î∞õÍ∏∞)
        window.addEventListener('message', function(event) {
            try {
                if (event.data && event.data.type === 'HAIRGATOR_THEME_SYNC') {
                    console.log('ÌÖåÎßà ÎèôÍ∏∞Ìôî:', event.data.theme);
                    applyTheme(event.data.theme, event.data.colors);
                } else if (event.data && event.data.type === 'HAIRGATOR_DATA_SYNC') {
                    console.log('Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî:', event.data.data.length, 'Í∞ú');
                    hairColorData = event.data.data;
                    updateDataStatus(`${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞ÌôîÎê®`, 'success');
                }
            } catch (error) {
                console.error('Î©îÏãúÏßÄ Ï≤òÎ¶¨ Ïò§Î•ò:', error);
            }
        });

        function applyTheme(theme, colors) {
            const root = document.documentElement;
            
            if (theme === 'dark') {
                root.style.setProperty('--bg-light', '#121212');
                root.style.setProperty('--text-dark', '#ffffff');
                root.style.setProperty('--text-light', '#cccccc');
                root.style.setProperty('--border', '#333333');
            } else {
                root.style.setProperty('--bg-light', '#ffffff');
                root.style.setProperty('--text-dark', '#333333');
                root.style.setProperty('--text-light', '#666666');
                root.style.setProperty('--border', '#e0e0e0');
            }
            
            if (colors && colors.primary) {
                root.style.setProperty('--primary', colors.primary);
                root.style.setProperty('--primary-dark', colors.primaryDark || colors.primary);
            }
        }

        // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case '1':
                        event.preventDefault();
                        if (document.getElementById('mode-selection').classList.contains('active')) {
                            selectMode('photo');
                        }
                        break;
                    case '2':
                        event.preventDefault();
                        if (document.getElementById('mode-selection').classList.contains('active')) {
                            selectMode('camera');
                        }
                        break;
                    case '3':
                        event.preventDefault();
                        if (document.getElementById('mode-selection').classList.contains('active')) {
                            selectMode('manual');
                        }
                        break;
                    case 'Escape':
                        event.preventDefault();
                        goBack();
                        break;
                }
            }
            
            // Ïä§ÌéòÏù¥Ïä§Î∞îÎ°ú Î∂ÑÏÑù ÏãúÏûë
            if (event.code === 'Space' && uploadedImage && !isAnalyzing) {
                event.preventDefault();
                analyzePhoto();
            }
        });

        // Î∂ÄÎ™® Ï∞ΩÏóê ÏãúÏä§ÌÖú Ï§ÄÎπÑ ÏôÑÎ£å ÏïåÎ¶º
        window.addEventListener('load', function() {
            setTimeout(() => {
                try {
                    if (parent && parent.postMessage) {
                        parent.postMessage({
                            type: 'PERSONAL_COLOR_READY',
                            message: 'Personal Color ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§.'
                        }, '*');
                    }
                } catch (error) {
                    console.log('Î∂ÄÎ™® Ï∞Ω ÏïåÎ¶º Ï†ÑÏÜ° Ïã§Ìå®:', error);
                }
            }, 3000);
        });

        // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Ï†ïÎ¶¨
        window.addEventListener('beforeunload', function() {
            if (videoElement && videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }
            if (camera) {
                camera.stop();
            }
        });

        console.log('üé® HAIRGATOR Personal Color ÏãúÏä§ÌÖú Î°úÎìú ÏôÑÎ£å');
