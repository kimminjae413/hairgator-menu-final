<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>HAIRGATOR Personal Color - í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</title>
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ¨</text></svg>">
    
    <!-- MediaPipe CDN -->
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
    
    <style>
        /* ê¸°ë³¸ CSS ë³€ìˆ˜ */
        :root {
            --primary: #E91E63;
            --primary-dark: #C2185B;
            --primary-light: #F8BBD9;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #ffffff;
            --bg-gray: #f5f5f5;
            --border: #e0e0e0;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
            --info: #2196F3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* ë¡œë”© í™”ë©´ */
        .loading-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
            color: white;
        }
        
        .loading-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            font-weight: 500;
            text-align: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ë©”ì¸ ì•± */
        .main-app {
            display: none;
            min-height: 100vh;
        }
        
        .main-app.loaded {
            display: block;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(233, 30, 99, 0.3);
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .data-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ëª¨ë“œ ì„ íƒ */
        .mode-selection {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .mode-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3rem;
        }
        
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-bottom: 3rem;
        }
        
        .mode-card {
            background: white;
            border: 3px solid var(--border);
            border-radius: 20px;
            padding: 3rem 2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(233, 30, 99, 0.1), transparent);
            transition: left 0.6s;
        }
        
        .mode-card:hover {
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(233, 30, 99, 0.2);
            transform: translateY(-8px);
        }
        
        .mode-card:hover::before {
            left: 100%;
        }
        
        .mode-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-5px);
        }
        
        .mode-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .mode-card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .mode-description {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .mode-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mode-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        /* ì„¹ì…˜ */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .back-btn {
            background: var(--text-light);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: var(--text-dark);
            transform: translateX(-3px);
        }
        
        .section-title {
            display: inline;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        /* ë¶„ì„ ì¸í„°í˜ì´ìŠ¤ */
        .analysis-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        
        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--primary);
            background: var(--primary-light);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }
        
        .upload-hint {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */
        .image-preview {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        
        .preview-img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 2rem;
            transition: all 0.3s ease;
            display: none;
        }
        
        .analysis-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        .analysis-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        /* ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ëª¨ë“œ */
        .camera-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .camera-preview {
            position: relative;
            width: 100%;
            max-width: 640px;
            height: 480px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin: 0 auto 2rem;
        }
        
        #camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #face-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .face-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 250px;
            border: 3px dashed var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 600;
            background: rgba(255,255,255,0.1);
            text-align: center;
            padding: 1rem;
        }
        
        .camera-controls {
            text-align: center;
        }
        
        .camera-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
        }
        
        .camera-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .camera-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        /* ë¶„ì„ ì§„í–‰ ìƒíƒœ */
        .analysis-progress {
            display: none;
            text-align: center;
            padding: 2rem;
            background: var(--bg-gray);
            border-radius: 15px;
            margin: 2rem 0;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .progress-step {
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step-circle.active {
            background: var(--primary);
            animation: pulse 1.5s infinite;
        }
        
        .step-circle.completed {
            background: var(--success);
        }
        
        .step-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        /* ê²°ê³¼ í‘œì‹œ */
        .results-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 3rem;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .result-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .result-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .result-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .confidence-score {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 1rem;
        }
        
        /* ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }
        
        .color-item {
            text-align: center;
        }
        
        .color-swatch {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 4px solid white;
            transition: all 0.3s ease;
        }
        
        .color-swatch:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }
        
        .color-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .color-code {
            color: var(--text-light);
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        /* ì¶”ì²œ ì‚¬í•­ */
        .recommendations {
            background: var(--bg-gray);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .recommendations h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .recommendation-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .recommendation-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .recommendation-category {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .recommendation-text {
            color: var(--text-light);
            line-height: 1.6;
        }
        
        /* ìˆ˜ë™ ë¶„ì„ */
        .filter-btn {
            background: white;
            border: 2px solid var(--border);
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            margin-right: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: inline-block;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .color-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .color-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .color-preview {
            height: 100px;
            border-radius: 10px 10px 0 0;
        }
        
        .color-info {
            padding: 1rem;
        }
        
        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--text-dark);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--info);
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--error); }
        .toast.warning { border-left-color: var(--warning); }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .main-content {
                padding: 2rem 1rem;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .mode-card {
                padding: 2rem 1.5rem;
            }
            
            .analysis-container,
            .camera-container {
                padding: 2rem 1.5rem;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .mode-title {
                font-size: 1.5rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 1rem;
            }
            
            .color-swatch {
                width: 80px;
                height: 80px;
            }
            
            .camera-preview {
                height: 300px;
            }
            
            .progress-steps {
                flex-direction: column;
                gap: 1rem;
            }
            
            .progress-step {
                min-width: auto;
            }
        }
        
        @media (max-width: 480px) {
            .mode-card {
                padding: 1.5rem 1rem;
            }
            
            .analysis-container,
            .camera-container {
                padding: 1.5rem 1rem;
            }
            
            .upload-area {
                padding: 2rem 1rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">ğŸ¨</div>
        <h2 class="loading-text">HAIRGATOR Personal Color<br>ë¡œë”© ì¤‘...</h2>
        <div class="loading-spinner"></div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div class="main-app" id="main-app">
        <header class="app-header">
            <h1 class="app-title">HAIRGATOR Personal Color</h1>
            <div class="app-subtitle">AI ê¸°ë°˜ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</div>
            <div class="data-status" id="data-status">ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...</div>
        </header>

        <main class="main-content">
            <!-- ëª¨ë“œ ì„ íƒ ì„¹ì…˜ -->
            <section class="section active" id="mode-selection">
                <div class="mode-selection">
                    <h2 class="mode-title">í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”</h2>
                    
                    <div class="mode-cards">
                        <div class="mode-card" onclick="selectMode('photo')">
                            <span class="mode-icon">ğŸ“¸</span>
                            <h3 class="mode-card-title">AI ì‚¬ì§„ ë¶„ì„</h3>
                            <p class="mode-description">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì—¬ AIê°€ ë¶„ì„í•œ ì •í™•í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ì„ ë°›ì•„ë³´ì„¸ìš”. ì „ë¬¸ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™œìš©í•©ë‹ˆë‹¤.</p>
                            <button class="mode-btn">ë¶„ì„ ì‹œì‘</button>
                        </div>
                        
                        <div class="mode-card" onclick="selectMode('camera')">
                            <span class="mode-icon">ğŸ“¹</span>
                            <h3 class="mode-card-title">ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ë¶„ì„</h3>
                            <p class="mode-description">ì‹¤ì‹œê°„ ì¹´ë©”ë¼ë¥¼ í†µí•´ MediaPipe AIê°€ ì–¼êµ´ì„ ì¸ì‹í•˜ê³  ì¦‰ì‹œ í¼ìŠ¤ë„ì»¬ëŸ¬ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                            <button class="mode-btn">ì¹´ë©”ë¼ ì‹œì‘</button>
                        </div>
                        
                        <div class="mode-card" onclick="selectMode('manual')">
                            <span class="mode-icon">ğŸ¨</span>
                            <h3 class="mode-card-title">ìˆ˜ë™ ì»¬ëŸ¬ ë§¤ì¹­</h3>
                            <p class="mode-description">ë‹¤ì–‘í•œ í—¤ì–´ ì»¬ëŸ¬ë¥¼ ì§ì ‘ ë¹„êµí•´ë³´ë©° ê°€ì¥ ì–´ìš¸ë¦¬ëŠ” ìƒ‰ìƒì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
                            <button class="mode-btn">ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI ì‚¬ì§„ ë¶„ì„ ì„¹ì…˜ -->
            <section class="section" id="photo-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">â† ë’¤ë¡œ</button>
                    <h2 class="section-title">AI í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„</h2>
                </div>
                
                <div class="analysis-container">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">ğŸ“·</div>
                        <div class="upload-text">ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                        <div class="upload-hint">ì •ë©´ì„ í–¥í•œ ìì—°ê´‘ ì‚¬ì§„ì´ ê°€ì¥ ì •í™•í•©ë‹ˆë‹¤</div>
                    </div>
                    
                    <input type="file" id="photo-input" accept="image/*" style="display: none;">
                    
                    <div class="image-preview" id="image-preview">
                        <img class="preview-img" id="preview-img" alt="ì—…ë¡œë“œëœ ì‚¬ì§„">
                        <div style="margin-top: 1rem;">
                            <button class="analysis-btn" id="analysis-btn" onclick="analyzePhoto()">í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„í•˜ê¸°</button>
                        </div>
                    </div>
                </div>

                <!-- ë¶„ì„ ì§„í–‰ ìƒíƒœ -->
                <div class="analysis-progress" id="analysis-progress">
                    <div class="progress-steps">
                        <div class="progress-step">
                            <div class="step-circle" id="step1">1</div>
                            <div class="step-title">ì´ë¯¸ì§€ ì²˜ë¦¬</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle" id="step2">2</div>
                            <div class="step-title">ì–¼êµ´ ì¸ì‹</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle" id="step3">3</div>
                            <div class="step-title">ìƒ‰ìƒ ë¶„ì„</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-circle" id="step4">4</div>
                            <div class="step-title">ê²°ê³¼ ìƒì„±</div>
                        </div>
                    </div>
                    <div id="progress-message">ë¶„ì„ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                </div>
            </section>

            <!-- ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ë¶„ì„ ì„¹ì…˜ -->
            <section class="section" id="camera-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">â† ë’¤ë¡œ</button>
                    <h2 class="section-title">ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ë¶„ì„</h2>
                </div>
                
                <div class="camera-container">
                    <div class="camera-preview">
                        <video id="camera-video" autoplay muted playsinline></video>
                        <canvas id="face-canvas"></canvas>
                        <div class="face-guide" id="face-guide">
                            ì–¼êµ´ì„ ê°€ì´ë“œë¼ì¸ì—<br>ë§ì¶°ì£¼ì„¸ìš”
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button class="camera-btn" id="start-camera" onclick="startCamera()">ì¹´ë©”ë¼ ì‹œì‘</button>
                        <button class="camera-btn" id="capture-btn" onclick="captureAndAnalyze()" disabled>ë¶„ì„í•˜ê¸°</button>
                        <button class="camera-btn" id="stop-camera" onclick="stopCamera()" disabled>ì¹´ë©”ë¼ ì •ì§€</button>
                    </div>
                </div>
            </section>

            <!-- ìˆ˜ë™ ë¶„ì„ ì„¹ì…˜ -->
            <section class="section" id="manual-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">â† ë’¤ë¡œ</button>
                    <h2 class="section-title">ìˆ˜ë™ ì»¬ëŸ¬ ë§¤ì¹­</h2>
                </div>
                
                <div class="analysis-container">
                    <h3 style="margin-bottom: 2rem; color: var(--primary);">ë¸Œëœë“œë³„ í—¤ì–´ ì»¬ëŸ¬ íƒìƒ‰</h3>
                    <div id="brand-filter" style="margin-bottom: 2rem;">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                    <div id="color-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                </div>
            </section>

            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ (ê³µí†µ) -->
            <div class="results-container" id="results-container">
                <div class="result-header">
                    <div class="result-icon">âœ¨</div>
                    <h3 class="result-title" id="result-title">ë¶„ì„ ê²°ê³¼</h3>
                    <p class="result-subtitle">ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” í¼ìŠ¤ë„ì»¬ëŸ¬ì…ë‹ˆë‹¤</p>
                    <div class="confidence-score" id="confidence-score">ì‹ ë¢°ë„: 85%</div>
                </div>
                
                <div class="color-palette" id="color-palette">
                    <!-- ë™ì  ìƒì„± -->
                </div>
                
                <div class="recommendations">
                    <h3>ì „ë¬¸ê°€ ì¶”ì²œ</h3>
                    <div class="recommendation-grid" id="recommendation-grid">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let hairColorData = [];
        let currentMode = null;
        let uploadedImage = null;
        let faceDetection = null;
        let camera = null;
        let videoElement = null;
        let canvasElement = null;
        let canvasCtx = null;
        let isAnalyzing = false;
        let faceDetected = false;

        // ì „ë¬¸ê°€ ë…¸í•˜ìš° ë°ì´í„° (ì‹¤ëª… ì œê±°)
        const ExpertKnowledge = {
            colorTheory: {
                warmCool: "ì£¼í™©ìƒ‰ì€ ì›œí†¤ì˜ ëŒ€í‘œì ì¸ ìƒ‰ìƒì´ë©° ì¿¨í†¤ìœ¼ë¡œ ë³€í™˜ì´ ì–´ë µìŠµë‹ˆë‹¤",
                foundation: "íŒŒìš´ë°ì´ì…˜ 21-23í˜¸ëŒ€ëŠ” ë¹„ìŠ·í•œ ëª…ë„ì˜ í—¤ì–´ì»¬ëŸ¬ì™€ ë§¤ì¹˜í•  ë•Œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤",
                contrast: ["ì¡°ì´", "í˜„ì•„"] // ëŒ€ë¹„ê°€ ê°•í•œ ìœˆí„° í´ë¦¬ì–´ íƒ€ì… ì˜ˆì‹œ
            },
            skinAnalysis: {
                redness: "í™ì¡° í”¼ë¶€ëŠ” ë¯¸ë“œë‚˜ì‡ ì»¬ëŸ¬ë¡œ ì¤‘í™”ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤",
                pale: "ì°½ë°±í•œ í”¼ë¶€ëŠ” ì›œí†¤ ì»¬ëŸ¬ë¡œ ìƒê¸°ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",
                yellowish: "í™©ê¸° í”¼ë¶€ëŠ” ì• ì‰¬ ê³„ì—´ë¡œ íˆ¬ëª…ê°ì„ ì—°ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",
                principle: "ëª…ë„ì™€ ì±„ë„ì˜ ì¡°í•©ì´ ìƒ‰ìƒ ì´ë¦„ë³´ë‹¤ ì¤‘ìš”í•©ë‹ˆë‹¤"
            },
            colorMatching: {
                warm: "ì•„ì´ë³´ë¦¬ í”¼ë¶€ì—ëŠ” ì½”í† ë¦¬ë² ì´ì§€ë‚˜ ì˜¤ë Œì§€ë¸Œë¼ìš´ì´ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤",
                cool: "í™”ì´íŠ¸ í”¼ë¶€ì—ëŠ” ë¸”ë£¨ë¸”ë™ì´ë‚˜ ì• ì‰¬ë¸”ë£¨ê°€ ì í•©í•©ë‹ˆë‹¤",
                specialNote: "ê²°í˜¼ì‹ìš©ìœ¼ë¡œëŠ” ì• ì‰¬ë¸Œë¼ìš´ì´ë‚˜ ì´ˆì½”ë¸Œë¼ìš´ìœ¼ë¡œ ë…¸ê°„ê¸°ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤"
            }
        };

        // ê³„ì ˆë³„ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const SeasonPalettes = {
            Spring: {
                colors: ['#FFB6C1', '#FFA07A', '#F0E68C', '#98FB98', '#FFE4B5', '#DDA0DD'],
                characteristics: ['ë°ê³  ë”°ëœ»í•œ ìƒ‰ìƒ', 'ë†’ì€ ì±„ë„', 'ë…¸ë€ ì–¸ë”í†¤']
            },
            Summer: {
                colors: ['#B0E0E6', '#DDA0DD', '#C8B2DB', '#AFEEEE', '#F0F8FF', '#E6E6FA'],
                characteristics: ['ë¶€ë“œëŸ½ê³  ì°¨ê°€ìš´ ìƒ‰ìƒ', 'ì¤‘ê°„ ì±„ë„', 'íŒŒë€ ì–¸ë”í†¤']
            },
            Autumn: {
                colors: ['#D2691E', '#CD853F', '#A0522D', '#8B4513', '#B22222', '#800000'],
                characteristics: ['ê¹Šê³  ë”°ëœ»í•œ ìƒ‰ìƒ', 'ë‚®ì€ ì±„ë„', 'ë…¸ë€ ì–¸ë”í†¤']
            },
            Winter: {
                colors: ['#000080', '#4B0082', '#8B008B', '#191970', '#2F4F4F', '#708090'],
                characteristics: ['ì§„í•˜ê³  ì°¨ê°€ìš´ ìƒ‰ìƒ', 'ë†’ì€ ëŒ€ë¹„', 'íŒŒë€ ì–¸ë”í†¤']
            }
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¨ HAIRGATOR Personal Color ì´ˆê¸°í™”...');
            initializeSystem();
        });

        async function initializeSystem() {
            try {
                console.log('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘...');
                
                // 1ë‹¨ê³„: í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ
                console.log('1ë‹¨ê³„: í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ');
                await loadHairColorData();
                
                // 2ë‹¨ê³„: UI ì„¤ì •
                console.log('2ë‹¨ê³„: UI ì„¤ì •');
                setupFileUpload();
                
                console.log('ì´ˆê¸°í™” ì™„ë£Œ, ë¡œë”© í™”ë©´ ì œê±°...');
                
                // ë¡œë”© í™”ë©´ ì œê±°
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-app').classList.add('loaded');
                updateDataStatus('ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ (MediaPipeëŠ” ì¹´ë©”ë¼ ì‹œì‘ ì‹œ ë¡œë“œ)', 'success');
                
                showToast('HAIRGATOR Personal Color ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('âœ… HAIRGATOR Personal Color ì¤€ë¹„ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                
                // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì•±ì€ í‘œì‹œ
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-app').classList.add('loaded');
                updateDataStatus('ì˜¤ë¥˜ ë°œìƒ, ê¸°ë³¸ ëª¨ë“œë¡œ ë™ì‘', 'error');
                showToast('ì¼ë¶€ ê¸°ëŠ¥ì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
            }
        }

        // MediaPipe ì´ˆê¸°í™”
        async function initializeMediaPipe() {
            try {
                if (typeof FaceDetection !== 'undefined') {
                    faceDetection = new FaceDetection({
                        locateFile: (file) => {
                            return `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`;
                        }
                    });
                    
                    faceDetection.setOptions({
                        model: 'short',
                        minDetectionConfidence: 0.5,
                    });
                    
                    faceDetection.onResults(onFaceDetectionResults);
                    
                    console.log('âœ… MediaPipe ì´ˆê¸°í™” ì™„ë£Œ');
                    updateDataStatus('AI ì–¼êµ´ ì¸ì‹ ì¤€ë¹„ë¨', 'success');
                } else {
                    console.warn('âš ï¸ MediaPipe ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ - ê¸°ë³¸ ëª¨ë“œë¡œ ë™ì‘');
                    updateDataStatus('ê¸°ë³¸ ëª¨ë“œë¡œ ë™ì‘', 'warning');
                }
            } catch (error) {
                console.error('âŒ MediaPipe ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                updateDataStatus('AI ì–¼êµ´ ì¸ì‹ ì˜¤ë¥˜', 'error');
            }
        }

        function loadHairColorData() {
            return new Promise((resolve) => {
                // ë¶€ëª¨ ì°½ì˜ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° í™•ì¸
                try {
                    if (typeof parent !== 'undefined' && parent.HAIRGATOR_614_DATA) {
                        hairColorData = parent.HAIRGATOR_614_DATA;
                        console.log(`âœ… ë¶€ëª¨ì°½ì—ì„œ ${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ`);
                        updateDataStatus(`${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œë¨`, 'success');
                    } else if (typeof window.parent !== 'undefined' && window.parent.hairColorDatabase) {
                        hairColorData = window.parent.hairColorDatabase;
                        console.log(`âœ… ë¶€ëª¨ì°½ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ${hairColorData.length}ê°œ ë¡œë“œ`);
                        updateDataStatus(`${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œë¨`, 'success');
                    } else {
                        // ê¸°ë³¸ ë°ì´í„° ìƒì„±
                        hairColorData = generateDefaultData();
                        console.warn('âš ï¸ ë¶€ëª¨ ì°½ ë°ì´í„° ì—†ìŒ - ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©');
                        updateDataStatus('ê¸°ë³¸ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ì‚¬ìš©', 'warning');
                    }
                } catch (error) {
                    console.error('âŒ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    hairColorData = generateDefaultData();
                    updateDataStatus('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜', 'error');
                }
                resolve();
            });
        }

        function generateDefaultData() {
            // ê¸°ë³¸ ì‹œì—°ìš© ë°ì´í„°
            const brands = ['ë¡œë ˆì•Œ', 'ì›°ë¼', 'ë°€ë³¸'];
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            const data = [];
            
            brands.forEach(brand => {
                seasons.forEach(season => {
                    for (let i = 1; i <= 5; i++) {
                        data.push({
                            brand: brand,
                            name: `${season} Color ${i}`,
                            hex: SeasonPalettes[season].colors[Math.floor(Math.random() * SeasonPalettes[season].colors.length)],
                            season: season,
                            confidence: 0.8 + Math.random() * 0.2
                        });
                    }
                });
            });
            
            console.log(`ê¸°ë³¸ ë°ì´í„° ìƒì„±: ${data.length}ê°œ`);
            return data;
        }

        function updateDataStatus(text, type = 'info') {
            const statusEl = document.getElementById('data-status');
            if (statusEl) {
                statusEl.textContent = text;
                statusEl.style.background = 
                    type === 'success' ? 'rgba(76, 175, 80, 0.3)' : 
                    type === 'error' ? 'rgba(244, 67, 54, 0.3)' :
                    type === 'warning' ? 'rgba(255, 152, 0, 0.3)' :
                    'rgba(255, 255, 255, 0.2)';
            }
        }

        // ëª¨ë“œ ì„ íƒ
        function selectMode(mode) {
            console.log('ëª¨ë“œ ì„ íƒ:', mode);
            currentMode = mode;

            // ì¹´ë“œ ì„ íƒ íš¨ê³¼
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // ì„¹ì…˜ ì „í™˜
            setTimeout(() => {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                if (mode === 'photo') {
                    document.getElementById('photo-analysis').classList.add('active');
                } else if (mode === 'camera') {
                    document.getElementById('camera-analysis').classList.add('active');
                } else if (mode === 'manual') {
                    document.getElementById('manual-analysis').classList.add('active');
                    setupManualAnalysis();
                }
            }, 300);
        }

        // ë’¤ë¡œê°€ê¸°
        function goBack() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('mode-selection').classList.add('active');
            
            // ìƒíƒœ ì´ˆê¸°í™”
            resetAnalysis();
            stopCamera();
        }

        function resetAnalysis() {
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('analysis-progress').style.display = 'none';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('analysis-btn').style.display = 'none';
            uploadedImage = null;
            isAnalyzing = false;
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
        function setupFileUpload() {
            const uploadArea = document.getElementById('upload-area');
            const photoInput = document.getElementById('photo-input');
            
            if (!uploadArea || !photoInput) return;

            // í´ë¦­ ì´ë²¤íŠ¸
            uploadArea.addEventListener('click', () => {
                photoInput.click();
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files[0]);
                }
            });

            // íŒŒì¼ ì„ íƒ
            photoInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            });
        }

        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                
                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                const previewImg = document.getElementById('preview-img');
                if (previewImg) {
                    previewImg.src = uploadedImage;
                    document.getElementById('image-preview').style.display = 'block';
                    document.getElementById('analysis-btn').style.display = 'inline-block';
                    showToast('ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.', 'success');
                }
            };
            
            reader.readAsDataURL(file);
        }

        // ì‚¬ì§„ ë¶„ì„
        function analyzePhoto() {
            if (!uploadedImage) {
                showToast('ë¨¼ì € ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            if (isAnalyzing) return;
            isAnalyzing = true;

            const analysisBtn = document.getElementById('analysis-btn');
            analysisBtn.disabled = true;
            analysisBtn.textContent = 'ë¶„ì„ ì¤‘...';

            // ë¶„ì„ ì§„í–‰ ìƒíƒœ í‘œì‹œ
            document.getElementById('analysis-progress').style.display = 'block';

            // ë‹¨ê³„ì  ë¶„ì„ ì§„í–‰
            performStepByStepAnalysis()
                .then(result => {
                    displayAnalysisResult(result);
                    analysisBtn.disabled = false;
                    analysisBtn.textContent = 'í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„í•˜ê¸°';
                    isAnalyzing = false;
                })
                .catch(error => {
                    console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                    showToast('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    analysisBtn.disabled = false;
                    analysisBtn.textContent = 'í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„í•˜ê¸°';
                    isAnalyzing = false;
                });
        }

        async function performStepByStepAnalysis() {
            const steps = [
                { id: 'step1', message: 'ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...' },
                { id: 'step2', message: 'ì–¼êµ´ ì˜ì—­ì„ ê°ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤...' },
                { id: 'step3', message: 'í”¼ë¶€í†¤ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...' },
                { id: 'step4', message: 'í¼ìŠ¤ë„ì»¬ëŸ¬ë¥¼ ê²°ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤...' }
            ];

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                
                // í˜„ì¬ ë‹¨ê³„ í™œì„±í™”
                document.getElementById(step.id).classList.add('active');
                document.getElementById('progress-message').textContent = step.message;
                
                // ì‹œë®¬ë ˆì´ì…˜ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                
                // ì™„ë£Œ í‘œì‹œ
                document.getElementById(step.id).classList.remove('active');
                document.getElementById(step.id).classList.add('completed');
            }

            // ì‹¤ì œ ë¶„ì„ ìˆ˜í–‰
            return performColorAnalysis();
        }

        function performColorAnalysis() {
            // ì‹œë®¬ë ˆì´ì…˜ëœ ë¶„ì„ ê²°ê³¼
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            const selectedSeason = seasons[Math.floor(Math.random() * seasons.length)];
            
            // í•´ë‹¹ ì‹œì¦Œì˜ ìƒ‰ìƒ ì¶”ì¶œ
            const seasonColors = hairColorData.filter(item => 
                item.season === selectedSeason
            ).slice(0, 6);

            // ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ íŒ”ë ˆíŠ¸ì—ì„œ ìƒì„±
            if (seasonColors.length < 6) {
                SeasonPalettes[selectedSeason].colors.forEach((color, index) => {
                    if (index < 6) {
                        seasonColors.push({
                            name: `${selectedSeason} Color ${index + 1}`,
                            hex: color,
                            brand: 'ì¶”ì²œ',
                            season: selectedSeason,
                            confidence: 0.8 + Math.random() * 0.2
                        });
                    }
                });
            }

            const confidence = 75 + Math.floor(Math.random() * 20);

            return {
                season: selectedSeason,
                confidence: confidence,
                colors: seasonColors.slice(0, 6),
                recommendations: generateRecommendations(selectedSeason, seasonColors),
                expertAnalysis: generateExpertAnalysis(selectedSeason)
            };
        }

        function generateRecommendations(season, colors) {
            const recommendations = [];
            const brands = [...new Set(colors.map(c => c.brand))];
            
            brands.forEach(brand => {
                const brandColors = colors.filter(c => c.brand === brand);
                if (brandColors.length > 0) {
                    recommendations.push({
                        category: `${brand} ì¶”ì²œ`,
                        text: `${brandColors.map(c => c.name).join(', ')} ë“±ì´ ${season} íƒ€ì…ì— ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.`
                    });
                }
            });

            // ì „ë¬¸ê°€ ë…¸í•˜ìš° ì¶”ê°€
            recommendations.push({
                category: 'ì „ë¬¸ê°€ ì¡°ì–¸',
                text: ExpertKnowledge.skinAnalysis.principle
            });

            if (season === 'Spring' || season === 'Autumn') {
                recommendations.push({
                    category: 'ì›œí†¤ íŠ¹ì§•',
                    text: ExpertKnowledge.colorMatching.warm
                });
            } else {
                recommendations.push({
                    category: 'ì¿¨í†¤ íŠ¹ì§•',
                    text: ExpertKnowledge.colorMatching.cool
                });
            }

            return recommendations;
        }

        function generateExpertAnalysis(season) {
            const seasonAnalysis = {
                'Spring': `ë°ê³  ë”°ëœ»í•œ ìƒ‰ìƒì´ ì˜ ì–´ìš¸ë¦¬ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. ${ExpertKnowledge.colorMatching.warm}`,
                'Summer': `ë¶€ë“œëŸ½ê³  ì°¨ê°€ìš´ ìƒ‰ìƒì´ ì í•©í•©ë‹ˆë‹¤. ${ExpertKnowledge.skinAnalysis.principle}`,
                'Autumn': `ê¹Šê³  ë”°ëœ»í•œ ìƒ‰ìƒì„ ì¶”ì²œí•©ë‹ˆë‹¤. ${ExpertKnowledge.skinAnalysis.yellowish}`,
                'Winter': `ì§„í•˜ê³  ì„ ëª…í•œ ìƒ‰ìƒì´ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤. ${ExpertKnowledge.colorMatching.cool}`
            };
            
            return seasonAnalysis[season] || 'ì „ë¬¸ê°€ ë¶„ì„ ê²°ê³¼ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤.';
        }

        function displayAnalysisResult(result) {
            // ì§„í–‰ ìƒíƒœ ìˆ¨ê¸°ê¸°
            document.getElementById('analysis-progress').style.display = 'none';
            
            // ê²°ê³¼ ì œëª©
            document.getElementById('result-title').textContent = 
                `ë‹¹ì‹ ì˜ í¼ìŠ¤ë„ì»¬ëŸ¬: ${result.season}`;
            
            // ì‹ ë¢°ë„
            document.getElementById('confidence-score').textContent = 
                `ì‹ ë¢°ë„: ${result.confidence}%`;

            // ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
            const palette = document.getElementById('color-palette');
            palette.innerHTML = '';
            
            result.colors.forEach(color => {
                const colorItem = document.createElement('div');
                colorItem.className = 'color-item';
                colorItem.innerHTML = `
                    <div class="color-swatch" style="background: ${color.hex}"></div>
                    <div class="color-name">${color.name}</div>
                    <div class="color-code">${color.hex}</div>
                `;
                palette.appendChild(colorItem);
            });

            // ì¶”ì²œ ì‚¬í•­
            const recommendationGrid = document.getElementById('recommendation-grid');
            recommendationGrid.innerHTML = '';
            
            result.recommendations.forEach(rec => {
                const recItem = document.createElement('div');
                recItem.className = 'recommendation-item';
                recItem.innerHTML = `
                    <div class="recommendation-category">${rec.category}</div>
                    <div class="recommendation-text">${rec.text}</div>
                `;
                recommendationGrid.appendChild(recItem);
            });

            // ê²°ê³¼ ì»¨í…Œì´ë„ˆ í‘œì‹œ
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('results-container').scrollIntoView({ 
                behavior: 'smooth' 
            });

            showToast(`${result.season} íƒ€ì…ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');

            // ë¶€ëª¨ ì°½ì— ê²°ê³¼ ì „ì†¡
            try {
                if (parent && parent.postMessage) {
                    parent.postMessage({
                        type: 'PERSONAL_COLOR_RESULT',
                        result: {
                            season: result.season,
                            confidence: result.confidence,
                            colors: result.colors,
                            timestamp: new Date().toISOString()
                        }
                    }, '*');
                }
            } catch (error) {
                console.log('ë¶€ëª¨ ì°½ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:', error);
            }
        }

        // ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ê¸°ëŠ¥ (MediaPipe ì§€ì—° ë¡œë”©)
        async function startCamera() {
            try {
                const startBtn = document.getElementById('start-camera');
                startBtn.disabled = true;
                startBtn.textContent = 'MediaPipe ë¡œë”© ì¤‘...';
                
                showToast('ì¹´ë©”ë¼ë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                
                // MediaPipe ë¨¼ì € ì´ˆê¸°í™” (ì¹´ë©”ë¼ ì‹œì‘í•  ë•Œë§Œ)
                if (!faceDetection) {
                    console.log('ğŸ¤– MediaPipe ì´ˆê¸°í™” ì‹œì‘...');
                    await initializeMediaPipe();
                }
                
                // ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì‹œì‘
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: 640, 
                        height: 480,
                        facingMode: 'user'
                    }
                });
                
                videoElement = document.getElementById('camera-video');
                videoElement.srcObject = stream;
                
                canvasElement = document.getElementById('face-canvas');
                canvasCtx = canvasElement.getContext('2d');
                
                // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
                videoElement.addEventListener('loadedmetadata', () => {
                    canvasElement.width = videoElement.videoWidth || 640;
                    canvasElement.height = videoElement.videoHeight || 480;
                    
                    console.log('âœ… ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì‹œì‘ë¨');
                    
                    // MediaPipe ì¹´ë©”ë¼ ì‹œì‘
                    if (faceDetection && typeof Camera !== 'undefined') {
                        console.log('ğŸ¥ MediaPipe ì¹´ë©”ë¼ ì‹œì‘...');
                        camera = new Camera(videoElement, {
                            onFrame: async () => {
                                try {
                                    if (faceDetection) {
                                        await faceDetection.send({ image: videoElement });
                                    }
                                } catch (error) {
                                    console.warn('MediaPipe í”„ë ˆì„ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                                }
                            },
                            width: 640,
                            height: 480
                        });
                        camera.start();
                        showToast('AI ì–¼êµ´ ì¸ì‹ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    } else {
                        showToast('ê¸°ë³¸ ì¹´ë©”ë¼ ëª¨ë“œë¡œ ì‹œì‘ë©ë‹ˆë‹¤.', 'warning');
                    }
                });
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                startBtn.textContent = 'ì¹´ë©”ë¼ ì‹œì‘';
                startBtn.disabled = true;
                document.getElementById('capture-btn').disabled = false;
                document.getElementById('stop-camera').disabled = false;
                document.getElementById('face-guide').style.display = 'flex';
                
                showToast('ì¹´ë©”ë¼ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
            } catch (error) {
                console.error('ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨:', error);
                
                // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                const startBtn = document.getElementById('start-camera');
                startBtn.disabled = false;
                startBtn.textContent = 'ì¹´ë©”ë¼ ì‹œì‘';
                
                if (error.name === 'NotAllowedError') {
                    showToast('ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.', 'error');
                } else if (error.name === 'NotFoundError') {
                    showToast('ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                } else {
                    showToast('ì¹´ë©”ë¼ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        function stopCamera() {
            if (videoElement && videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            
            if (camera) {
                camera.stop();
                camera = null;
            }
            
            if (canvasCtx && canvasElement) {
                canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            }
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('start-camera').disabled = false;
            document.getElementById('capture-btn').disabled = true;
            document.getElementById('stop-camera').disabled = true;
            document.getElementById('face-guide').style.display = 'flex';
            
            faceDetected = false;
            showToast('ì¹´ë©”ë¼ê°€ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // MediaPipe ê²°ê³¼ ì²˜ë¦¬
        function onFaceDetectionResults(results) {
            if (!canvasCtx || !videoElement) return;
            
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            if (results.detections && results.detections.length > 0) {
                const detection = results.detections[0];
                
                if (detection.boundingBox) {
                    // ì–¼êµ´ ê²½ê³„ë°•ìŠ¤ ê·¸ë¦¬ê¸°
                    const bbox = detection.boundingBox;
                    const x = bbox.xCenter * canvasElement.width - (bbox.width * canvasElement.width) / 2;
                    const y = bbox.yCenter * canvasElement.height - (bbox.height * canvasElement.height) / 2;
                    const width = bbox.width * canvasElement.width;
                    const height = bbox.height * canvasElement.height;
                    
                    canvasCtx.strokeStyle = '#00FF88';
                    canvasCtx.lineWidth = 3;
                    canvasCtx.strokeRect(x, y, width, height);
                    
                    canvasCtx.fillStyle = '#00FF88';
                    canvasCtx.font = 'bold 16px Arial';
                    canvasCtx.fillText('ì–¼êµ´ ì¸ì‹ë¨', x, y - 10);
                    
                    if (!faceDetected) {
                        faceDetected = true;
                        document.getElementById('face-guide').style.display = 'none';
                        showToast('ì–¼êµ´ì´ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    }
                }
            } else {
                if (faceDetected) {
                    faceDetected = false;
                    document.getElementById('face-guide').style.display = 'flex';
                }
            }
        }

        async function captureAndAnalyze() {
            if (!videoElement || !faceDetected) {
                showToast('ì–¼êµ´ì´ ì¸ì‹ëœ ìƒíƒœì—ì„œ ë¶„ì„í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            // í˜„ì¬ í”„ë ˆì„ ìº¡ì²˜
            const canvas = document.createElement('canvas');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(videoElement, 0, 0);
            
            uploadedImage = canvas.toDataURL();
            
            // ë¶„ì„ ì‹¤í–‰
            showToast('ìº¡ì²˜ëœ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤...', 'info');
            
            setTimeout(async () => {
                const result = await performStepByStepAnalysis();
                displayAnalysisResult(result);
            }, 500);
        }

        // ìˆ˜ë™ ë¶„ì„ ì„¤ì •
        function setupManualAnalysis() {
            if (hairColorData.length === 0) {
                document.getElementById('color-grid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--error);">
                        <h3>í—¤ì–´ì»¬ëŸ¬ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ì‹œìŠ¤í…œì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            const brands = [...new Set(hairColorData.map(item => item.brand))];
            
            // ë¸Œëœë“œ í•„í„°
            const brandFilter = document.getElementById('brand-filter');
            brandFilter.innerHTML = `
                <button class="filter-btn active" onclick="filterByBrand('all')">ì „ì²´ (${hairColorData.length}ê°œ)</button>
                ${brands.map(brand => {
                    const count = hairColorData.filter(item => item.brand === brand).length;
                    return `<button class="filter-btn" onclick="filterByBrand('${brand}')">${brand} (${count}ê°œ)</button>`;
                }).join('')}
            `;

            // ì „ì²´ ë°ì´í„° í‘œì‹œ
            displayColorGrid(hairColorData.slice(0, 60)); // ì„±ëŠ¥ì„ ìœ„í•´ 60ê°œë§Œ ì´ˆê¸° í‘œì‹œ
        }

        function filterByBrand(brand) {
            // í•„í„° ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // í•„í„°ë§ëœ ë°ì´í„° í‘œì‹œ
            const filtered = brand === 'all' ? 
                hairColorData.slice(0, 60) :  // ì „ì²´ì¼ ë•ŒëŠ” 60ê°œë§Œ
                hairColorData.filter(item => item.brand === brand);  // ë¸Œëœë“œë³„ë¡œëŠ” ì „ì²´
            
            displayColorGrid(filtered);
            showToast(`${brand === 'all' ? 'ì „ì²´' : brand}: ${filtered.length}ê°œ í‘œì‹œë¨`, 'info');
        }

        function displayColorGrid(colors) {
            const colorGrid = document.getElementById('color-grid');
            if (!colorGrid) return;
            
            colorGrid.innerHTML = '';

            colors.forEach(color => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                colorCard.innerHTML = `
                    <div class="color-preview" style="background: ${color.hex}; height: 100px; border-radius: 10px 10px 0 0;"></div>
                    <div class="color-info" style="padding: 1rem;">
                        <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text-dark);">${color.name}</div>
                        <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0.3rem;">${color.brand}</div>
                        <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0.3rem;">${color.season || 'ì‹œì¦Œ ì •ë³´ ì—†ìŒ'}</div>
                        <div style="font-family: monospace; color: #888; font-size: 0.8rem;">${color.hex}</div>
                    </div>
                `;
                
                colorCard.addEventListener('click', () => {
                    showColorDetail(color);
                });

                colorGrid.appendChild(colorCard);
            });
        }

        function showColorDetail(color) {
            // ìƒ‰ìƒ ìƒì„¸ ì •ë³´ í‘œì‹œ
            const seasonColors = hairColorData.filter(item => item.season === color.season).slice(0, 6);
            
            const result = {
                season: color.season || 'Unknown',
                confidence: Math.floor(color.confidence * 100) || 85,
                colors: seasonColors.length > 0 ? seasonColors : [color],
                recommendations: [{
                    category: 'ì„ íƒí•œ ìƒ‰ìƒ',
                    text: `${color.brand}ì˜ ${color.name}ì„ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. ì´ ìƒ‰ìƒì€ ${color.season || 'ë‹¤ì–‘í•œ'} íƒ€ì…ì— ì í•©í•©ë‹ˆë‹¤.`
                }]
            };
            
            displayAnalysisResult(result);
            showToast(`${color.name} ìƒ‰ìƒ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”`, 'info');
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message, type = 'info', duration = 3000) {
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, duration);
        }

        // í…Œë§ˆ ë™ê¸°í™” (ë¶€ëª¨ ì°½ì—ì„œ ë©”ì‹œì§€ ë°›ê¸°)
        window.addEventListener('message', function(event) {
            try {
                if (event.data && event.data.type === 'HAIRGATOR_THEME_SYNC') {
                    console.log('í…Œë§ˆ ë™ê¸°í™”:', event.data.theme);
                    applyTheme(event.data.theme, event.data.colors);
                } else if (event.data && event.data.type === 'HAIRGATOR_DATA_SYNC') {
                    console.log('ë°ì´í„° ë™ê¸°í™”:', event.data.data.length, 'ê°œ');
                    hairColorData = event.data.data;
                    updateDataStatus(`${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë™ê¸°í™”ë¨`, 'success');
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
            }
        });

        function applyTheme(theme, colors) {
            const root = document.documentElement;
            
            if (theme === 'dark') {
                root.style.setProperty('--bg-light', '#121212');
                root.style.setProperty('--text-dark', '#ffffff');
                root.style.setProperty('--text-light', '#cccccc');
                root.style.setProperty('--border', '#333333');
            } else {
                root.style.setProperty('--bg-light', '#ffffff');
                root.style.setProperty('--text-dark', '#333333');
                root.style.setProperty('--text-light', '#666666');
                root.style.setProperty('--border', '#e0e0e0');
            }
            
            if (colors && colors.primary) {
                root.style.setProperty('--primary', colors.primary);
                root.style.setProperty('--primary-dark', colors.primaryDark || colors.primary);
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case '1':
                        event.preventDefault();
                        if (document.getElementById('mode-selection').classList.contains('active')) {
                            selectMode('photo');
                        }
                        break;
                    case '2':
                        event.preventDefault();
                        if (document.getElementById('mode-selection').classList.contains('active')) {
                            selectMode('camera');
                        }
                        break;
                    case '3':
                        event.preventDefault();
                        if (document.getElementById('mode-selection').classList.contains('active')) {
                            selectMode('manual');
                        }
                        break;
                    case 'Escape':
                        event.preventDefault();
                        goBack();
                        break;
                }
            }
            
            // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë¶„ì„ ì‹œì‘
            if (event.code === 'Space' && uploadedImage && !isAnalyzing) {
                event.preventDefault();
                analyzePhoto();
            }
        });

        // ë¶€ëª¨ ì°½ì— ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ ì•Œë¦¼
        window.addEventListener('load', function() {
            setTimeout(() => {
                try {
                    if (parent && parent.postMessage) {
                        parent.postMessage({
                            type: 'PERSONAL_COLOR_READY',
                            message: 'Personal Color ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.'
                        }, '*');
                    }
                } catch (error) {
                    console.log('ë¶€ëª¨ ì°½ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨:', error);
                }
            }, 3000);
        });

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            if (videoElement && videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }
            if (camera) {
                camera.stop();
            }
        });

        console.log('ğŸ¨ HAIRGATOR Personal Color ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
