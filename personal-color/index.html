<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>HAIRGATOR Personal Color - í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</title>
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ¨</text></svg>">
    
    <style>
        :root {
            --primary: #E91E63;
            --primary-dark: #C2185B;
            --primary-light: #F8BBD9;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #ffffff;
            --bg-gray: #f5f5f5;
            --border: #e0e0e0;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        /* ë¡œë”© í™”ë©´ */
        .loading-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-light);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
        }
        
        .loading-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--primary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            font-weight: 500;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ë©”ì¸ ì•± */
        .main-app {
            display: none;
            min-height: 100vh;
        }
        
        .main-app.loaded {
            display: block;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(233, 30, 99, 0.3);
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .data-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ëª¨ë“œ ì„ íƒ */
        .mode-selection {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .mode-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3rem;
        }
        
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-bottom: 3rem;
        }
        
        .mode-card {
            background: white;
            border: 3px solid var(--border);
            border-radius: 20px;
            padding: 3rem 2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(233, 30, 99, 0.1), transparent);
            transition: left 0.6s;
        }
        
        .mode-card:hover {
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(233, 30, 99, 0.2);
            transform: translateY(-8px);
        }
        
        .mode-card:hover::before {
            left: 100%;
        }
        
        .mode-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-5px);
        }
        
        .mode-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .mode-card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .mode-description {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .mode-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mode-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        /* ì„¹ì…˜ */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .back-btn {
            background: var(--text-light);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: var(--text-dark);
            transform: translateX(-3px);
        }
        
        .section-title {
            display: inline;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        /* ë¶„ì„ ì¸í„°í˜ì´ìŠ¤ */
        .analysis-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        
        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--primary);
            background: var(--primary-light);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }
        
        .upload-hint {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .image-preview {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        
        .preview-img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 2rem;
            transition: all 0.3s ease;
            display: none;
        }
        
        .analysis-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        .analysis-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        /* ê²°ê³¼ í‘œì‹œ */
        .results-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 3rem;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .result-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .result-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .result-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }
        
        .color-item {
            text-align: center;
        }
        
        .color-swatch {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 4px solid white;
        }
        
        .color-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .color-code {
            color: var(--text-light);
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        .recommendations {
            background: var(--bg-gray);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .recommendations h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .recommendation-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .recommendation-category {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .recommendation-text {
            color: var(--text-light);
            line-height: 1.6;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .main-content {
                padding: 2rem 1rem;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .mode-card {
                padding: 2rem 1.5rem;
            }
            
            .analysis-container {
                padding: 2rem 1.5rem;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .mode-title {
                font-size: 1.5rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 1rem;
            }
            
            .color-swatch {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">ğŸ¨</div>
        <h2 class="loading-text">HAIRGATOR Personal Color ë¡œë”© ì¤‘...</h2>
        <div class="loading-spinner"></div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div class="main-app" id="main-app">
        <header class="app-header">
            <h1 class="app-title">HAIRGATOR Personal Color</h1>
            <div class="app-subtitle">614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ê¸°ë°˜ AI í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨</div>
            <div class="data-status" id="data-status">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </header>

        <main class="main-content">
            <!-- ëª¨ë“œ ì„ íƒ ì„¹ì…˜ -->
            <section class="section active" id="mode-selection">
                <div class="mode-selection">
                    <h2 class="mode-title">í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”</h2>
                    
                    <div class="mode-cards">
                        <div class="mode-card" onclick="selectMode('photo')">
                            <span class="mode-icon">ğŸ“¸</span>
                            <h3 class="mode-card-title">AI ì‚¬ì§„ ë¶„ì„</h3>
                            <p class="mode-description">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì—¬ AIê°€ ë¶„ì„í•œ ì •í™•í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ì„ ë°›ì•„ë³´ì„¸ìš”. 614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™œìš©í•©ë‹ˆë‹¤.</p>
                            <button class="mode-btn">ë¶„ì„ ì‹œì‘</button>
                        </div>
                        
                        <div class="mode-card" onclick="selectMode('manual')">
                            <span class="mode-icon">ğŸ¨</span>
                            <h3 class="mode-card-title">ìˆ˜ë™ ì»¬ëŸ¬ ë§¤ì¹­</h3>
                            <p class="mode-description">ë‹¤ì–‘í•œ í—¤ì–´ ì»¬ëŸ¬ë¥¼ ì§ì ‘ ë¹„êµí•´ë³´ë©° ê°€ì¥ ì–´ìš¸ë¦¬ëŠ” ìƒ‰ìƒì„ ì°¾ì•„ë³´ì„¸ìš”. ë¸Œëœë“œë³„ ì „ë¬¸ ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
                            <button class="mode-btn">ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI ë¶„ì„ ì„¹ì…˜ -->
            <section class="section" id="photo-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">â† ë’¤ë¡œ</button>
                    <h2 class="section-title">AI í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„</h2>
                </div>
                
                <div class="analysis-container">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">ğŸ“·</div>
                        <div class="upload-text">ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                        <div class="upload-hint">ì •ë©´ì„ í–¥í•œ ìì—°ê´‘ ì‚¬ì§„ì´ ê°€ì¥ ì •í™•í•©ë‹ˆë‹¤</div>
                    </div>
                    
                    <input type="file" id="photo-input" accept="image/*" style="display: none;">
                    
                    <div class="image-preview" id="image-preview">
                        <img class="preview-img" id="preview-img" alt="ì—…ë¡œë“œëœ ì‚¬ì§„">
                        <div style="margin-top: 1rem;">
                            <button class="analysis-btn" id="analysis-btn" onclick="analyzePhoto()">í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„í•˜ê¸°</button>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                <div class="results-container" id="results-container">
                    <div class="result-header">
                        <div class="result-icon">âœ¨</div>
                        <h3 class="result-title" id="result-title">ë¶„ì„ ê²°ê³¼</h3>
                        <p class="result-subtitle">ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” í¼ìŠ¤ë„ì»¬ëŸ¬ì…ë‹ˆë‹¤</p>
                    </div>
                    
                    <div class="color-palette" id="color-palette">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                    
                    <div class="recommendations">
                        <h3>í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ</h3>
                        <div class="recommendation-grid" id="recommendation-grid">
                            <!-- ë™ì  ìƒì„± -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ìˆ˜ë™ ë¶„ì„ ì„¹ì…˜ -->
            <section class="section" id="manual-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">â† ë’¤ë¡œ</button>
                    <h2 class="section-title">ìˆ˜ë™ ì»¬ëŸ¬ ë§¤ì¹­</h2>
                </div>
                
                <div class="analysis-container">
                    <h3 style="margin-bottom: 2rem; color: var(--primary);">ë¸Œëœë“œë³„ í—¤ì–´ ì»¬ëŸ¬ íƒìƒ‰</h3>
                    <div id="brand-filter" style="margin-bottom: 2rem;">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                    <div id="color-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let hairColorData = [];
        let currentMode = null;
        let uploadedImage = null;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¨ HAIRGATOR Personal Color ì´ˆê¸°í™”...');
            initializeSystem();
        });

        async function initializeSystem() {
            try {
                // 614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ
                await loadHairColorData();
                
                // ë¡œë”© í™”ë©´ ì œê±°
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('main-app').classList.add('loaded');
                    console.log('âœ… HAIRGATOR Personal Color ì¤€ë¹„ ì™„ë£Œ');
                }, 1500);
                
            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                updateDataStatus('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        function loadHairColorData() {
            return new Promise((resolve) => {
                // ë¶€ëª¨ ì°½ì˜ 614ê°œ ë°ì´í„° í™•ì¸ (ìš°ì„ ìˆœìœ„ë³„ë¡œ ì‹œë„)
                if (typeof HAIR_COLOR_614_DATA !== 'undefined') {
                    hairColorData = HAIR_COLOR_614_DATA;
                    console.log(`âœ… 614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ ì„±ê³µ: ${hairColorData.length}ê°œ`);
                    updateDataStatus(`${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œë¨`, 'success');
                } else if (parent && parent.HAIR_COLOR_614_DATA) {
                    // ë¶€ëª¨ ì°½ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                    hairColorData = parent.HAIR_COLOR_614_DATA;
                    console.log(`âœ… ë¶€ëª¨ì°½ì—ì„œ 614ê°œ ë°ì´í„° ë¡œë“œ: ${hairColorData.length}ê°œ`);
                    updateDataStatus(`${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œë¨`, 'success');
                } else if (window.parent && window.parent.HAIRGATOR_614_DATA) {
                    // HAIRGATOR ì „ì—­ ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                    hairColorData = window.parent.HAIRGATOR_614_DATA;
                    console.log(`âœ… HAIRGATORì—ì„œ 614ê°œ ë°ì´í„° ë¡œë“œ: ${hairColorData.length}ê°œ`);
                    updateDataStatus(`${hairColorData.length}ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œë¨`, 'success');
                } else {
                    // 614ê°œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œë§Œ ì—ëŸ¬
                    console.error('âŒ 614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    hairColorData = [];
                    updateDataStatus('614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'error');
                }
                resolve();
            });
        }

        function updateDataStatus(text, type = 'info') {
            const statusEl = document.getElementById('data-status');
            statusEl.textContent = text;
            statusEl.style.background = type === 'success' ? 'rgba(76, 175, 80, 0.3)' : 
                                      type === 'error' ? 'rgba(244, 67, 54, 0.3)' :
                                      type === 'warning' ? 'rgba(255, 152, 0, 0.3)' :
                                      'rgba(255, 255, 255, 0.2)';
        }

        function generateDefaultData() {
            // 614ê°œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ ì‹œì—ë§Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
            // ì‹¤ì œë¡œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•¨
            console.warn('âš ï¸ generateDefaultData í˜¸ì¶œë¨ - 614ê°œ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤');
            return [];
        }

        // ëª¨ë“œ ì„ íƒ
        function selectMode(mode) {
            console.log('ëª¨ë“œ ì„ íƒ:', mode);
            currentMode = mode;

            // ì¹´ë“œ ì„ íƒ íš¨ê³¼
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // ì„¹ì…˜ ì „í™˜
            setTimeout(() => {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                if (mode === 'photo') {
                    document.getElementById('photo-analysis').classList.add('active');
                    setupPhotoAnalysis();
                } else if (mode === 'manual') {
                    document.getElementById('manual-analysis').classList.add('active');
                    setupManualAnalysis();
                }
            }, 300);
        }

        // ë’¤ë¡œê°€ê¸°
        function goBack() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('mode-selection').classList.add('active');
            
            // ìƒíƒœ ì´ˆê¸°í™”
            resetAnalysis();
        }

        function resetAnalysis() {
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('analysis-btn').style.display = 'none';
            uploadedImage = null;
        }

        // ì‚¬ì§„ ë¶„ì„ ì„¤ì •
        function setupPhotoAnalysis() {
            const uploadArea = document.getElementById('upload-area');
            const photoInput = document.getElementById('photo-input');
            
            // í´ë¦­ ì´ë²¤íŠ¸
            uploadArea.addEventListener('click', () => {
                photoInput.click();
            });

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files[0]);
                }
            });

            // íŒŒì¼ ì„ íƒ
            photoInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            });
        }

        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                
                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                const previewImg = document.getElementById('preview-img');
                previewImg.src = uploadedImage;
                
                document.getElementById('image-preview').style.display = 'block';
                document.getElementById('analysis-btn').style.display = 'inline-block';
            };
            
            reader.readAsDataURL(file);
        }

        // ì‚¬ì§„ ë¶„ì„
        function analyzePhoto() {
            if (!uploadedImage) {
                alert('ë¨¼ì € ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            const analysisBtn = document.getElementById('analysis-btn');
            analysisBtn.disabled = true;
            analysisBtn.textContent = 'ë¶„ì„ ì¤‘...';

            // ì‹œë®¬ë ˆì´ì…˜ëœ ë¶„ì„
            setTimeout(() => {
                const result = performColorAnalysis();
                displayAnalysisResult(result);
                
                analysisBtn.disabled = false;
                analysisBtn.textContent = 'í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„í•˜ê¸°';
            }, 2000);
        }

        function performColorAnalysis() {
            // ì‹œë®¬ë ˆì´ì…˜ëœ ë¶„ì„ ê²°ê³¼
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            const selectedSeason = seasons[Math.floor(Math.random() * seasons.length)];
            
            // í•´ë‹¹ ì‹œì¦Œì˜ ìƒ‰ìƒ ì¶”ì¶œ
            const seasonColors = hairColorData.filter(item => 
                item.season === selectedSeason
            ).slice(0, 8);

            return {
                season: selectedSeason,
                confidence: 85 + Math.floor(Math.random() * 15),
                colors: seasonColors,
                recommendations: generateRecommendations(selectedSeason, seasonColors)
            };
        }

        function generateRecommendations(season, colors) {
            const recommendations = [];
            const brands = [...new Set(colors.map(c => c.brand))];
            
            brands.forEach(brand => {
                const brandColors = colors.filter(c => c.brand === brand);
                if (brandColors.length > 0) {
                    recommendations.push({
                        category: `${brand} ì¶”ì²œ`,
                        text: `${brandColors.map(c => c.name).join(', ')} ë“±ì´ ${season} íƒ€ì…ì— ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.`
                    });
                }
            });

            return recommendations;
        }

        function displayAnalysisResult(result) {
            // ê²°ê³¼ ì œëª©
            document.getElementById('result-title').textContent = 
                `ë‹¹ì‹ ì˜ í¼ìŠ¤ë„ì»¬ëŸ¬: ${result.season} (${result.confidence}% í™•ì‹ )`;

            // ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
            const palette = document.getElementById('color-palette');
            palette.innerHTML = '';
            
            result.colors.forEach(color => {
                const colorItem = document.createElement('div');
                colorItem.className = 'color-item';
                colorItem.innerHTML = `
                    <div class="color-swatch" style="background: ${color.hex}"></div>
                    <div class="color-name">${color.name}</div>
                    <div class="color-code">${color.hex}</div>
                `;
                palette.appendChild(colorItem);
            });

            // ì¶”ì²œ ì‚¬í•­
            const recommendationGrid = document.getElementById('recommendation-grid');
            recommendationGrid.innerHTML = '';
            
            result.recommendations.forEach(rec => {
                const recItem = document.createElement('div');
                recItem.className = 'recommendation-item';
                recItem.innerHTML = `
                    <div class="recommendation-category">${rec.category}</div>
                    <div class="recommendation-text">${rec.text}</div>
                `;
                recommendationGrid.appendChild(recItem);
            });

            // ê²°ê³¼ ì»¨í…Œì´ë„ˆ í‘œì‹œ
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('results-container').scrollIntoView({ 
                behavior: 'smooth' 
            });

            // ë¶€ëª¨ ì°½ì— ê²°ê³¼ ì „ì†¡
            try {
                parent.postMessage({
                    type: 'PERSONAL_COLOR_RESULT',
                    result: {
                        season: result.season,
                        confidence: result.confidence,
                        colors: result.colors,
                        timestamp: new Date().toISOString()
                    }
                }, '*');
            } catch (error) {
                console.log('ë¶€ëª¨ ì°½ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨');
            }
        }

        // ìˆ˜ë™ ë¶„ì„ ì„¤ì •
        function setupManualAnalysis() {
            if (hairColorData.length === 0) {
                document.getElementById('color-grid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--error);">
                        <h3>614ê°œ í—¤ì–´ì»¬ëŸ¬ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>HAIRGATOR ë©”ì¸ ì‹œìŠ¤í…œì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            const brands = [...new Set(hairColorData.map(item => item.brand))];
            
            // ë¸Œëœë“œ í•„í„° (ì‹¤ì œ ê°œìˆ˜ í‘œì‹œ)
            const brandFilter = document.getElementById('brand-filter');
            brandFilter.innerHTML = `
                <button class="filter-btn active" onclick="filterByBrand('all')">ì „ì²´ (${hairColorData.length}ê°œ)</button>
                ${brands.map(brand => {
                    const count = hairColorData.filter(item => item.brand === brand).length;
                    return `<button class="filter-btn" onclick="filterByBrand('${brand}')">${brand} (${count}ê°œ)</button>`;
                }).join('')}
            `;

            // 614ê°œ ë°ì´í„°ì—ì„œ ì²˜ìŒ 120ê°œ í‘œì‹œ (ì„±ëŠ¥ ê³ ë ¤)
            displayColorGrid(hairColorData.slice(0, 120));
        }

        function filterByBrand(brand) {
            // í•„í„° ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // 614ê°œ ì „ì²´ ë°ì´í„°ì—ì„œ í•„í„°ë§ (ì œí•œ ì—†ìŒ)
            const filtered = brand === 'all' ? 
                hairColorData.slice(0, 120) :  // ì „ì²´ì¼ ë•ŒëŠ” ì„±ëŠ¥ìƒ 120ê°œë§Œ
                hairColorData.filter(item => item.brand === brand);  // ë¸Œëœë“œë³„ë¡œëŠ” ì „ì²´ í‘œì‹œ
            
            displayColorGrid(filtered);
            
            // ë¡œë”©ëœ ê°œìˆ˜ í‘œì‹œ
            console.log(`${brand === 'all' ? 'ì „ì²´' : brand}: ${filtered.length}ê°œ í‘œì‹œë¨`);
        }

        function displayColorGrid(colors) {
            const colorGrid = document.getElementById('color-grid');
            colorGrid.innerHTML = '';

            colors.forEach(color => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                colorCard.innerHTML = `
                    <div class="color-preview" style="background: ${color.hex}; height: 100px; border-radius: 10px; margin-bottom: 1rem;"></div>
                    <div style="padding: 1rem;">
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">${color.name}</div>
                        <div style="color: #666; font-size: 0.9rem;">${color.brand}</div>
                        <div style="color: #666; font-size: 0.9rem;">${color.season}</div>
                        <div style="font-family: monospace; color: #888; font-size: 0.8rem; margin-top: 0.5rem;">${color.hex}</div>
                    </div>
                `;
                colorCard.style.cssText = 'background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;';
                
                colorCard.addEventListener('mouseenter', () => {
                    colorCard.style.transform = 'translateY(-5px)';
                    colorCard.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                });
                
                colorCard.addEventListener('mouseleave', () => {
                    colorCard.style.transform = 'translateY(0)';
                    colorCard.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
                });

                colorGrid.appendChild(colorCard);
            });
        }

        // í…Œë§ˆ ë™ê¸°í™” (ë¶€ëª¨ ì°½ì—ì„œ ë©”ì‹œì§€ ë°›ê¸°)
        window.addEventListener('message', function(event) {
            if (event.data.type === 'HAIRGATOR_THEME_SYNC') {
                console.log('í…Œë§ˆ ë™ê¸°í™”:', event.data.theme);
                applyTheme(event.data.theme, event.data.colors);
            }
        });

        function applyTheme(theme, colors) {
            if (theme === 'light') {
                document.documentElement.style.setProperty('--bg-light', '#ffffff');
                document.documentElement.style.setProperty('--text-dark', '#333333');
            } else {
                document.documentElement.style.setProperty('--bg-light', '#121212');
                document.documentElement.style.setProperty('--text-dark', '#ffffff');
            }
            
            if (colors && colors.primary) {
                document.documentElement.style.setProperty('--primary', colors.primary);
            }
        }

        // CSS ì¶”ê°€ (ë¸Œëœë“œ í•„í„° ë²„íŠ¼)
        const style = document.createElement('style');
        style.textContent = `
            .filter-btn {
                background: white;
                border: 2px solid var(--border);
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                margin-right: 1rem;
                margin-bottom: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 500;
            }
            
            .filter-btn:hover,
            .filter-btn.active {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
