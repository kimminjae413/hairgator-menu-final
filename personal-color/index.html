<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>HAIRGATOR Personal Color - ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã® ÏãúÏä§ÌÖú</title>
    
    <!-- ÌååÎπÑÏΩò -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üé®</text></svg>">
    
    <style>
        :root {
            --primary: #E91E63;
            --primary-dark: #C2185B;
            --primary-light: #F8BBD9;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #ffffff;
            --bg-gray: #f5f5f5;
            --border: #e0e0e0;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        /* Î°úÎî© ÌôîÎ©¥ */
        .loading-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-light);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
        }
        
        .loading-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--primary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            font-weight: 500;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Î©îÏù∏ Ïï± */
        .main-app {
            display: none;
            min-height: 100vh;
        }
        
        .main-app.loaded {
            display: block;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(233, 30, 99, 0.3);
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            font-weight: 400;
        }
        
        .data-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
        .main-content {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Î™®Îìú ÏÑ†ÌÉù */
        .mode-selection {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .mode-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3rem;
        }
        
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-bottom: 3rem;
        }
        
        .mode-card {
            background: white;
            border: 3px solid var(--border);
            border-radius: 20px;
            padding: 3rem 2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(233, 30, 99, 0.1), transparent);
            transition: left 0.6s;
        }
        
        .mode-card:hover {
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(233, 30, 99, 0.2);
            transform: translateY(-8px);
        }
        
        .mode-card:hover::before {
            left: 100%;
        }
        
        .mode-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-5px);
        }
        
        .mode-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .mode-card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .mode-description {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .mode-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .mode-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        /* ÏÑπÏÖò */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .back-btn {
            background: var(--text-light);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: var(--text-dark);
            transform: translateX(-3px);
        }
        
        .section-title {
            display: inline;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        /* Î∂ÑÏÑù Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ */
        .analysis-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        
        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--primary);
            background: var(--primary-light);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }
        
        .upload-hint {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .image-preview {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        
        .preview-img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 2rem;
            transition: all 0.3s ease;
            display: none;
        }
        
        .analysis-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }
        
        .analysis-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        /* Í≤∞Í≥º ÌëúÏãú */
        .results-container {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 3rem;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .result-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .result-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .result-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }
        
        .color-item {
            text-align: center;
        }
        
        .color-swatch {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 4px solid white;
        }
        
        .color-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .color-code {
            color: var(--text-light);
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        .recommendations {
            background: var(--bg-gray);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .recommendations h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .recommendation-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .recommendation-category {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .recommendation-text {
            color: var(--text-light);
            line-height: 1.6;
        }
        
        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .main-content {
                padding: 2rem 1rem;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .mode-card {
                padding: 2rem 1.5rem;
            }
            
            .analysis-container {
                padding: 2rem 1.5rem;
            }
            
            .app-title {
                font-size: 1.5rem;
            }
            
            .mode-title {
                font-size: 1.5rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 1rem;
            }
            
            .color-swatch {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Î°úÎî© ÌôîÎ©¥ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">üé®</div>
        <h2 class="loading-text">HAIRGATOR Personal Color Î°úÎî© Ï§ë...</h2>
        <div class="loading-spinner"></div>
    </div>

    <!-- Î©îÏù∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò -->
    <div class="main-app" id="main-app">
        <header class="app-header">
            <h1 class="app-title">HAIRGATOR Personal Color</h1>
            <div class="app-subtitle">614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò AI ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã®</div>
            <div class="data-status" id="data-status">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>
        </header>

        <main class="main-content">
            <!-- Î™®Îìú ÏÑ†ÌÉù ÏÑπÏÖò -->
            <section class="section active" id="mode-selection">
                <div class="mode-selection">
                    <h2 class="mode-title">ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã® Î∞©Î≤ïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
                    
                    <div class="mode-cards">
                        <div class="mode-card" onclick="selectMode('photo')">
                            <span class="mode-icon">üì∏</span>
                            <h3 class="mode-card-title">AI ÏÇ¨ÏßÑ Î∂ÑÏÑù</h3>
                            <p class="mode-description">ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÏó¨ AIÍ∞Ä Î∂ÑÏÑùÌïú Ï†ïÌôïÌïú ÌçºÏä§ÎÑêÏª¨Îü¨ ÏßÑÎã®ÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî. 614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º ÌôúÏö©Ìï©ÎãàÎã§.</p>
                            <button class="mode-btn">Î∂ÑÏÑù ÏãúÏûë</button>
                        </div>
                        
                        <div class="mode-card" onclick="selectMode('manual')">
                            <span class="mode-icon">üé®</span>
                            <h3 class="mode-card-title">ÏàòÎèô Ïª¨Îü¨ Îß§Ïπ≠</h3>
                            <p class="mode-description">Îã§ÏñëÌïú Ìó§Ïñ¥ Ïª¨Îü¨Î•º ÏßÅÏ†ë ÎπÑÍµêÌï¥Î≥¥Î©∞ Í∞ÄÏû• Ïñ¥Ïö∏Î¶¨Îäî ÏÉâÏÉÅÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî. Î∏åÎûúÎìúÎ≥Ñ Ï†ÑÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º Ï†úÍ≥µÌï©ÎãàÎã§.</p>
                            <button class="mode-btn">ÏãúÏûëÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI Î∂ÑÏÑù ÏÑπÏÖò -->
            <section class="section" id="photo-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">‚Üê Îí§Î°ú</button>
                    <h2 class="section-title">AI ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑù</h2>
                </div>
                
                <div class="analysis-container">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</div>
                        <div class="upload-hint">Ï†ïÎ©¥ÏùÑ Ìñ•Ìïú ÏûêÏó∞Í¥ë ÏÇ¨ÏßÑÏù¥ Í∞ÄÏû• Ï†ïÌôïÌï©ÎãàÎã§</div>
                    </div>
                    
                    <input type="file" id="photo-input" accept="image/*" style="display: none;">
                    
                    <div class="image-preview" id="image-preview">
                        <img class="preview-img" id="preview-img" alt="ÏóÖÎ°úÎìúÎêú ÏÇ¨ÏßÑ">
                        <div style="margin-top: 1rem;">
                            <button class="analysis-btn" id="analysis-btn" onclick="analyzePhoto()">ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑùÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>

                <!-- Í≤∞Í≥º ÌëúÏãú ÏòÅÏó≠ -->
                <div class="results-container" id="results-container">
                    <div class="result-header">
                        <div class="result-icon">‚ú®</div>
                        <h3 class="result-title" id="result-title">Î∂ÑÏÑù Í≤∞Í≥º</h3>
                        <p class="result-subtitle">ÎãπÏã†ÏóêÍ≤å Ïñ¥Ïö∏Î¶¨Îäî ÌçºÏä§ÎÑêÏª¨Îü¨ÏûÖÎãàÎã§</p>
                    </div>
                    
                    <div class="color-palette" id="color-palette">
                        <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                    
                    <div class="recommendations">
                        <h3>Ìó§Ïñ¥Ïª¨Îü¨ Ï∂îÏ≤ú</h3>
                        <div class="recommendation-grid" id="recommendation-grid">
                            <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- ÏàòÎèô Î∂ÑÏÑù ÏÑπÏÖò -->
            <section class="section" id="manual-analysis">
                <div class="section-header">
                    <button class="back-btn" onclick="goBack()">‚Üê Îí§Î°ú</button>
                    <h2 class="section-title">ÏàòÎèô Ïª¨Îü¨ Îß§Ïπ≠</h2>
                </div>
                
                <div class="analysis-container">
                    <h3 style="margin-bottom: 2rem; color: var(--primary);">Î∏åÎûúÎìúÎ≥Ñ Ìó§Ïñ¥ Ïª¨Îü¨ ÌÉêÏÉâ</h3>
                    <div id="brand-filter" style="margin-bottom: 2rem;">
                        <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                    <div id="color-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem;">
                        <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let hairColorData = [];
        let currentMode = null;
        let uploadedImage = null;

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé® HAIRGATOR Personal Color Ï¥àÍ∏∞Ìôî...');
            initializeSystem();
        });

        async function initializeSystem() {
            try {
                // 614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                await loadHairColorData();
                
                // Î°úÎî© ÌôîÎ©¥ Ï†úÍ±∞
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('main-app').classList.add('loaded');
                    console.log('‚úÖ HAIRGATOR Personal Color Ï§ÄÎπÑ ÏôÑÎ£å');
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                updateDataStatus('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®', 'error');
            }
        }

        function loadHairColorData() {
            return new Promise((resolve) => {
                // Î∂ÄÎ™® Ï∞ΩÏùò 614Í∞ú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ (Ïö∞ÏÑ†ÏàúÏúÑÎ≥ÑÎ°ú ÏãúÎèÑ)
                if (typeof HAIR_COLOR_614_DATA !== 'undefined') {
                    hairColorData = HAIR_COLOR_614_DATA;
                    console.log(`‚úÖ 614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ: ${hairColorData.length}Í∞ú`);
                    updateDataStatus(`${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`, 'success');
                } else if (parent && parent.HAIR_COLOR_614_DATA) {
                    // Î∂ÄÎ™® Ï∞ΩÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                    hairColorData = parent.HAIR_COLOR_614_DATA;
                    console.log(`‚úÖ Î∂ÄÎ™®Ï∞ΩÏóêÏÑú 614Í∞ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú: ${hairColorData.length}Í∞ú`);
                    updateDataStatus(`${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`, 'success');
                } else if (window.parent && window.parent.HAIRGATOR_614_DATA) {
                    // HAIRGATOR Ï†ÑÏó≠ Î≥ÄÏàòÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                    hairColorData = window.parent.HAIRGATOR_614_DATA;
                    console.log(`‚úÖ HAIRGATORÏóêÏÑú 614Í∞ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú: ${hairColorData.length}Í∞ú`);
                    updateDataStatus(`${hairColorData.length}Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìúÎê®`, 'success');
                } else {
                    // 614Í∞ú Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùÑ ÎïåÎßå ÏóêÎü¨
                    console.error('‚ùå 614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
                    hairColorData = [];
                    updateDataStatus('614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®', 'error');
                }
                resolve();
            });
        }

        function updateDataStatus(text, type = 'info') {
            const statusEl = document.getElementById('data-status');
            statusEl.textContent = text;
            statusEl.style.background = type === 'success' ? 'rgba(76, 175, 80, 0.3)' : 
                                      type === 'error' ? 'rgba(244, 67, 54, 0.3)' :
                                      type === 'warning' ? 'rgba(255, 152, 0, 0.3)' :
                                      'rgba(255, 255, 255, 0.2)';
        }

        function generateDefaultData() {
            // 614Í∞ú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå® ÏãúÏóêÎßå Ìò∏Ï∂úÎêòÎäî Ìï®Ïàò
            // Ïã§Ï†úÎ°úÎäî ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏïÑÏïº Ìï®
            console.warn('‚ö†Ô∏è generateDefaultData Ìò∏Ï∂úÎê® - 614Í∞ú Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§');
            return [];
        }

        // Î™®Îìú ÏÑ†ÌÉù
        function selectMode(mode) {
            console.log('Î™®Îìú ÏÑ†ÌÉù:', mode);
            currentMode = mode;

            // Ïπ¥Îìú ÏÑ†ÌÉù Ìö®Í≥º
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // ÏÑπÏÖò Ï†ÑÌôò
            setTimeout(() => {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                if (mode === 'photo') {
                    document.getElementById('photo-analysis').classList.add('active');
                    setupPhotoAnalysis();
                } else if (mode === 'manual') {
                    document.getElementById('manual-analysis').classList.add('active');
                    setupManualAnalysis();
                }
            }, 300);
        }

        // Îí§Î°úÍ∞ÄÍ∏∞
        function goBack() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('mode-selection').classList.add('active');
            
            // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            resetAnalysis();
        }

        function resetAnalysis() {
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('analysis-btn').style.display = 'none';
            uploadedImage = null;
        }

        // ÏÇ¨ÏßÑ Î∂ÑÏÑù ÏÑ§Ï†ï
        function setupPhotoAnalysis() {
            const uploadArea = document.getElementById('upload-area');
            const photoInput = document.getElementById('photo-input');
            
            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            uploadArea.addEventListener('click', () => {
                photoInput.click();
            });

            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files[0]);
                }
            });

            // ÌååÏùº ÏÑ†ÌÉù
            photoInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            });
        }

        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                
                // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
                const previewImg = document.getElementById('preview-img');
                previewImg.src = uploadedImage;
                
                document.getElementById('image-preview').style.display = 'block';
                document.getElementById('analysis-btn').style.display = 'inline-block';
            };
            
            reader.readAsDataURL(file);
        }

        // ÏÇ¨ÏßÑ Î∂ÑÏÑù
        function analyzePhoto() {
            if (!uploadedImage) {
                alert('Î®ºÏ†Ä ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const analysisBtn = document.getElementById('analysis-btn');
            analysisBtn.disabled = true;
            analysisBtn.textContent = 'Î∂ÑÏÑù Ï§ë...';

            // ÏãúÎÆ¨Î†àÏù¥ÏÖòÎêú Î∂ÑÏÑù
            setTimeout(() => {
                const result = performColorAnalysis();
                displayAnalysisResult(result);
                
                analysisBtn.disabled = false;
                analysisBtn.textContent = 'ÌçºÏä§ÎÑêÏª¨Îü¨ Î∂ÑÏÑùÌïòÍ∏∞';
            }, 2000);
        }

        function performColorAnalysis() {
            // ÏãúÎÆ¨Î†àÏù¥ÏÖòÎêú Î∂ÑÏÑù Í≤∞Í≥º
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            const selectedSeason = seasons[Math.floor(Math.random() * seasons.length)];
            
            // Ìï¥Îãπ ÏãúÏ¶åÏùò ÏÉâÏÉÅ Ï∂îÏ∂ú
            const seasonColors = hairColorData.filter(item => 
                item.season === selectedSeason
            ).slice(0, 8);

            return {
                season: selectedSeason,
                confidence: 85 + Math.floor(Math.random() * 15),
                colors: seasonColors,
                recommendations: generateRecommendations(selectedSeason, seasonColors)
            };
        }

        function generateRecommendations(season, colors) {
            const recommendations = [];
            const brands = [...new Set(colors.map(c => c.brand))];
            
            brands.forEach(brand => {
                const brandColors = colors.filter(c => c.brand === brand);
                if (brandColors.length > 0) {
                    recommendations.push({
                        category: `${brand} Ï∂îÏ≤ú`,
                        text: `${brandColors.map(c => c.name).join(', ')} Îì±Ïù¥ ${season} ÌÉÄÏûÖÏóê Ïûò Ïñ¥Ïö∏Î¶ΩÎãàÎã§.`
                    });
                }
            });

            return recommendations;
        }

        function displayAnalysisResult(result) {
            // Í≤∞Í≥º Ï†úÎ™©
            document.getElementById('result-title').textContent = 
                `ÎãπÏã†Ïùò ÌçºÏä§ÎÑêÏª¨Îü¨: ${result.season} (${result.confidence}% ÌôïÏã†)`;

            // Ïª¨Îü¨ ÌåîÎ†àÌä∏
            const palette = document.getElementById('color-palette');
            palette.innerHTML = '';
            
            result.colors.forEach(color => {
                const colorItem = document.createElement('div');
                colorItem.className = 'color-item';
                colorItem.innerHTML = `
                    <div class="color-swatch" style="background: ${color.hex}"></div>
                    <div class="color-name">${color.name}</div>
                    <div class="color-code">${color.hex}</div>
                `;
                palette.appendChild(colorItem);
            });

            // Ï∂îÏ≤ú ÏÇ¨Ìï≠
            const recommendationGrid = document.getElementById('recommendation-grid');
            recommendationGrid.innerHTML = '';
            
            result.recommendations.forEach(rec => {
                const recItem = document.createElement('div');
                recItem.className = 'recommendation-item';
                recItem.innerHTML = `
                    <div class="recommendation-category">${rec.category}</div>
                    <div class="recommendation-text">${rec.text}</div>
                `;
                recommendationGrid.appendChild(recItem);
            });

            // Í≤∞Í≥º Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('results-container').scrollIntoView({ 
                behavior: 'smooth' 
            });

            // Î∂ÄÎ™® Ï∞ΩÏóê Í≤∞Í≥º Ï†ÑÏÜ°
            try {
                parent.postMessage({
                    type: 'PERSONAL_COLOR_RESULT',
                    result: {
                        season: result.season,
                        confidence: result.confidence,
                        colors: result.colors,
                        timestamp: new Date().toISOString()
                    }
                }, '*');
            } catch (error) {
                console.log('Î∂ÄÎ™® Ï∞Ω Î©îÏãúÏßÄ Ï†ÑÏÜ° Ïã§Ìå®');
            }
        }

        // ÏàòÎèô Î∂ÑÏÑù ÏÑ§Ï†ï
        function setupManualAnalysis() {
            if (hairColorData.length === 0) {
                document.getElementById('color-grid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--error);">
                        <h3>614Í∞ú Ìó§Ïñ¥Ïª¨Îü¨ Îç∞Ïù¥ÌÑ∞Î•º Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§</h3>
                        <p>HAIRGATOR Î©îÏù∏ ÏãúÏä§ÌÖúÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</p>
                    </div>
                `;
                return;
            }

            const brands = [...new Set(hairColorData.map(item => item.brand))];
            
            // Î∏åÎûúÎìú ÌïÑÌÑ∞ (Ïã§Ï†ú Í∞úÏàò ÌëúÏãú)
            const brandFilter = document.getElementById('brand-filter');
            brandFilter.innerHTML = `
                <button class="filter-btn active" onclick="filterByBrand('all')">Ï†ÑÏ≤¥ (${hairColorData.length}Í∞ú)</button>
                ${brands.map(brand => {
                    const count = hairColorData.filter(item => item.brand === brand).length;
                    return `<button class="filter-btn" onclick="filterByBrand('${brand}')">${brand} (${count}Í∞ú)</button>`;
                }).join('')}
            `;

            // 614Í∞ú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ï≤òÏùå 120Í∞ú ÌëúÏãú (ÏÑ±Îä• Í≥†Î†§)
            displayColorGrid(hairColorData.slice(0, 120));
        }

        function filterByBrand(brand) {
            // ÌïÑÌÑ∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // 614Í∞ú Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÌïÑÌÑ∞ÎßÅ (Ï†úÌïú ÏóÜÏùå)
            const filtered = brand === 'all' ? 
                hairColorData.slice(0, 120) :  // Ï†ÑÏ≤¥Ïùº ÎïåÎäî ÏÑ±Îä•ÏÉÅ 120Í∞úÎßå
                hairColorData.filter(item => item.brand === brand);  // Î∏åÎûúÎìúÎ≥ÑÎ°úÎäî Ï†ÑÏ≤¥ ÌëúÏãú
            
            displayColorGrid(filtered);
            
            // Î°úÎî©Îêú Í∞úÏàò ÌëúÏãú
            console.log(`${brand === 'all' ? 'Ï†ÑÏ≤¥' : brand}: ${filtered.length}Í∞ú ÌëúÏãúÎê®`);
        }

        function displayColorGrid(colors) {
            const colorGrid = document.getElementById('color-grid');
            colorGrid.innerHTML = '';

            colors.forEach(color => {
                const colorCard = document.createElement('div');
                colorCard.className = 'color-card';
                colorCard.innerHTML = `
                    <div class="color-preview" style="background: ${color.hex}; height: 100px; border-radius: 10px; margin-bottom: 1rem;"></div>
                    <div style="padding: 1rem;">
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">${color.name}</div>
                        <div style="color: #666; font-size: 0.9rem;">${color.brand}</div>
                        <div style="color: #666; font-size: 0.9rem;">${color.season}</div>
                        <div style="font-family: monospace; color: #888; font-size: 0.8rem; margin-top: 0.5rem;">${color.hex}</div>
                    </div>
                `;
                colorCard.style.cssText = 'background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;';
                
                colorCard.addEventListener('mouseenter', () => {
                    colorCard.style.transform = 'translateY(-5px)';
                    colorCard.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                });
                
                colorCard.addEventListener('mouseleave', () => {
                    colorCard.style.transform = 'translateY(0)';
                    colorCard.style.boxShadow = '0 4px 15px rgba(0,0,0,0.1)';
                });

                colorGrid.appendChild(colorCard);
            });
        }

        // ÌÖåÎßà ÎèôÍ∏∞Ìôî (Î∂ÄÎ™® Ï∞ΩÏóêÏÑú Î©îÏãúÏßÄ Î∞õÍ∏∞)
        window.addEventListener('message', function(event) {
            if (event.data.type === 'HAIRGATOR_THEME_SYNC') {
                console.log('ÌÖåÎßà ÎèôÍ∏∞Ìôî:', event.data.theme);
                applyTheme(event.data.theme, event.data.colors);
            }
        });

        function applyTheme(theme, colors) {
            if (theme === 'light') {
                document.documentElement.style.setProperty('--bg-light', '#ffffff');
                document.documentElement.style.setProperty('--text-dark', '#333333');
            } else {
                document.documentElement.style.setProperty('--bg-light', '#121212');
                document.documentElement.style.setProperty('--text-dark', '#ffffff');
            }
            
            if (colors && colors.primary) {
                document.documentElement.style.setProperty('--primary', colors.primary);
            }
        }

        // CSS Ï∂îÍ∞Ä (Î∏åÎûúÎìú ÌïÑÌÑ∞ Î≤ÑÌäº)
        const style = document.createElement('style');
        style.textContent = `
            .filter-btn {
                background: white;
                border: 2px solid var(--border);
                padding: 0.8rem 1.5rem;
                border-radius: 25px;
                margin-right: 1rem;
                margin-bottom: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 500;
            }
            
            .filter-btn:hover,
            .filter-btn.active {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
