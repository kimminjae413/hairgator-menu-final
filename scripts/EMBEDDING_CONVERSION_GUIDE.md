# ì„ë² ë”© íƒ€ì… ë³€í™˜ ê°€ì´ë“œ

**ëª©ì :** TEXTë¡œ ì €ì¥ëœ ì„ë² ë”©ì„ VECTOR íƒ€ì…ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜

**ì†Œìš” ì‹œê°„:** ì•½ 30ë¶„~1ì‹œê°„ (ë°ì´í„° ì–‘ì— ë”°ë¼)

---

## ğŸ¯ **3ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤**

### **Step 1: ìƒˆ VECTOR ì»¬ëŸ¼ ìƒì„±** (5ì´ˆ)

**íŒŒì¼:** `step1-create-vector-columns.sql`

**ë°©ë²•:**
1. Supabase ëŒ€ì‹œë³´ë“œ ì ‘ì† (https://bhsbwbeisqzgipvzpvym.supabase.co)
2. ì¢Œì¸¡ **SQL Editor** í´ë¦­
3. `step1-create-vector-columns.sql` íŒŒì¼ ì—´ê¸°
4. ì „ì²´ ë³µì‚¬ â†’ SQL Editorì— ë¶™ì—¬ë„£ê¸°
5. **Run** ë²„íŠ¼ í´ë¦­

**ê²°ê³¼:**
```
âœ… image_embedding_vector ì»¬ëŸ¼ ìƒì„± (768)
âœ… recipe_embedding_vector ì»¬ëŸ¼ ìƒì„± (768)
âœ… summary_embedding_vector ì»¬ëŸ¼ ìƒì„± (768)
âœ… embedding_vector ì»¬ëŸ¼ ìƒì„± (768, 1024, 1536)
```

---

### **Step 2: ë°ì´í„° ë°°ì¹˜ ë³€í™˜** (30ë¶„~1ì‹œê°„)

**íŒŒì¼:** `convert-embeddings-batch.js`

**ë°©ë²•:**
```bash
node scripts/convert-embeddings-batch.js
```

**ë™ì‘:**
- 100ê°œì”© ì½ê¸° (íƒ€ì„ì•„ì›ƒ ë°©ì§€)
- TEXT â†’ Array íŒŒì‹±
- ìƒˆ VECTOR ì»¬ëŸ¼ì— ì €ì¥
- ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ í‘œì‹œ

**ì˜ˆìƒ ì¶œë ¥:**
```
ğŸ”„ ì»¬ëŸ¼: recipe_embedding â†’ recipe_embedding_vector (768ì°¨ì›)
   ì§„í–‰: 4719ê°œ ë³€í™˜ë¨...
   âœ… ì™„ë£Œ! ì´ 4719ê°œ ë³€í™˜, 0ê°œ ì˜¤ë¥˜
```

**ì†Œìš” ì‹œê°„:**
- recipe_samples (4,719ê°œ): ~15ë¶„
- theory_chunks (~ìˆ˜ì²œê°œ): ~10ë¶„
- hairstyles (70ê°œ): ~1ë¶„
- **ì´: ì•½ 30ë¶„**

---

### **Step 3: ìµœì¢… ì •ë¦¬** (5ì´ˆ)

**íŒŒì¼:** `step3-finalize-conversion.sql`

**âš ï¸ ì£¼ì˜:** Step 2ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ í›„ì—ë§Œ ì‹¤í–‰!

**ë°©ë²•:**
1. Supabase SQL Editor
2. `step3-finalize-conversion.sql` ì‹¤í–‰

**ë™ì‘:**
1. ê¸°ì¡´ TEXT ì»¬ëŸ¼ ì‚­ì œ
2. ìƒˆ VECTOR ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½ (_vector ì œê±°)
3. ì¸ë±ìŠ¤ ìƒì„± (ì„ íƒì‚¬í•­)

**ê²°ê³¼:**
```
âœ… image_embedding: VECTOR(768)
âœ… recipe_embedding: VECTOR(768)
âœ… summary_embedding: VECTOR(768)
```

---

## âœ… **ê²€ì¦**

ë³€í™˜ ì™„ë£Œ í›„:

```bash
node scripts/verify-embedding-fix.js
```

**ì„±ê³µ ì‹œ:**
```
âœ… recipe_samples.image_embedding: VECTOR íƒ€ì… (768ì°¨ì›)
âœ… recipe_samples.recipe_embedding: VECTOR íƒ€ì… (768ì°¨ì›)
âœ… recipe_samples.summary_embedding: VECTOR íƒ€ì… (768ì°¨ì›)
...
```

---

## ğŸ§ª **ì±—ë´‡ í…ŒìŠ¤íŠ¸**

RPC í•¨ìˆ˜ ì‘ë™ í™•ì¸:

```bash
node scripts/full-diagnosis.js
```

**ì„±ê³µ ì‹œ:**
```
âœ… RPC í•¨ìˆ˜ ì‘ë™! 5ê°œ ê²°ê³¼ ë°˜í™˜
```

---

## ğŸ“Š **ë³€í™˜ ëŒ€ìƒ**

| í…Œì´ë¸” | ì»¬ëŸ¼ | ê°œìˆ˜ | ì°¨ì› |
|--------|------|------|------|
| recipe_samples | image_embedding | 4,719 | 768 |
| recipe_samples | recipe_embedding | 4,719 | 768 |
| recipe_samples | summary_embedding | 4,719 | 768 |
| theory_chunks | embedding | ~ìˆ˜ì²œ | 768 |
| theory_chunks | image_embedding | ~ìˆ˜ì²œ | 1024 |
| hairstyles | embedding | 70 | 1536 |

**ì´: ~15,000ê°œ ì„ë² ë”© ë²¡í„°**

---

## âš ï¸ **ë¬¸ì œ í•´ê²°**

### **Step 2ì—ì„œ ì˜¤ë¥˜ ë°œìƒ ì‹œ**

**ì˜¤ë¥˜: "ì°¨ì› ë¶ˆì¼ì¹˜"**
```
âš ï¸ ID 123: ì°¨ì› ë¶ˆì¼ì¹˜ (512 != 768)
```
â†’ í•´ë‹¹ í–‰ì€ ìë™ìœ¼ë¡œ ê±´ë„ˆë›°ë©° ê³„ì† ì§„í–‰ë©ë‹ˆë‹¤.

**ì˜¤ë¥˜: "JSON íŒŒì‹± ì‹¤íŒ¨"**
```
âŒ ID 456: Unexpected token
```
â†’ ë°ì´í„°ê°€ ì†ìƒëœ í–‰ì…ë‹ˆë‹¤. ê±´ë„ˆë›°ê³  ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.

**ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜**
```
âŒ ë°°ì¹˜ ì¡°íšŒ ì˜¤ë¥˜: ETIMEDOUT
```
â†’ ì¸í„°ë„· ì—°ê²° í™•ì¸ í›„ ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰ (ì´ë¯¸ ë³€í™˜ëœ ê²ƒì€ ìë™ìœ¼ë¡œ ê±´ë„ˆëœ€)

---

## ğŸ¯ **ë¹ ë¥¸ ì‹œì‘**

```bash
# Step 1: SQL ì‹¤í–‰ (Supabase ëŒ€ì‹œë³´ë“œ)
step1-create-vector-columns.sql

# Step 2: ë°°ì¹˜ ë³€í™˜
node scripts/convert-embeddings-batch.js

# Step 3: SQL ì‹¤í–‰ (Supabase ëŒ€ì‹œë³´ë“œ)
step3-finalize-conversion.sql

# ê²€ì¦
node scripts/verify-embedding-fix.js

# í…ŒìŠ¤íŠ¸
node scripts/full-diagnosis.js
```

---

## ğŸ’¡ **ì™œ 3ë‹¨ê³„ì¸ê°€?**

**íƒ€ì„ì•„ì›ƒ ë°©ì§€:**
- SQLë¡œ ëª¨ë“  í–‰ì„ í•œ ë²ˆì— ALTER â†’ âŒ íƒ€ì„ì•„ì›ƒ
- ë°°ì¹˜ë¡œ ë‚˜ëˆ ì„œ ë³€í™˜ â†’ âœ… ì•ˆì „

**ë¡¤ë°± ê°€ëŠ¥:**
- Step 1: ìƒˆ ì»¬ëŸ¼ë§Œ ìƒì„± (ê¸°ì¡´ ë°ì´í„° ì•ˆì „)
- Step 2: ìƒˆ ì»¬ëŸ¼ì—ë§Œ ì €ì¥ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
- Step 3: ë¬¸ì œ ì—†ìœ¼ë©´ ìµœì¢… ì •ë¦¬

**ì•ˆì „ì„±:**
- ì¤‘ê°„ì— ì‹¤íŒ¨í•´ë„ ì¬ì‹¤í–‰ ê°€ëŠ¥
- ê¸°ì¡´ ë°ì´í„° ì†ì‹¤ ì—†ìŒ
- ì ì§„ì  ë³€í™˜

---

## âœ… **ì™„ë£Œ í›„**

ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ í›„:
1. âœ… ì±—ë´‡ ê²€ìƒ‰ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
2. âœ… RPC í•¨ìˆ˜ ê²°ê³¼ ë°˜í™˜
3. âœ… ë²¡í„° ê²€ìƒ‰ ê°€ëŠ¥
4. âœ… ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ (ìš©ëŸ‰ í™•ë³´)

---

**ë¬¸ì˜:** ë¬¸ì œ ë°œìƒ ì‹œ ìŠ¤í¬ë¦°ìƒ·ê³¼ ì˜¤ë¥˜ ë©”ì‹œì§€ ê³µìœ 
