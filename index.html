<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HAIRGATOR - 헤어스타일 메뉴판</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: auto;
            overflow-y: hidden;
            height: 100vh;
            position: relative;
        }

        /* 강제 가로모드 */
        @media screen and (orientation: portrait) {
            body {
                transform: rotate(90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: absolute;
                top: 100%;
                left: 0;
            }
        }

        /* 성별 선택 화면 */
        .gender-selection {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #000;
            gap: 40px;
        }

        .gender-selection.hidden {
            display: none;
        }

        .gender-card {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 40px;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
        }

        .gender-card:hover {
            transform: translateY(-10px);
            border-color: #FF1493;
            box-shadow: 0 10px 40px rgba(255, 20, 147, 0.3);
        }

        .gender-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            border-radius: 50%;
        }

        .gender-card.male .gender-icon {
            background: linear-gradient(135deg, #4169E1, #1E90FF);
        }

        .gender-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .gender-subtitle {
            color: #999;
            font-size: 14px;
        }

        /* 메인 컨테이너 */
        .main-container {
            display: none;
        }

        .main-container.active {
            display: block;
        }

        /* 헤더 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #000;
            z-index: 100;
            border-bottom: 1px solid #333;
        }

        .logo-section {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-img {
            height: 24px;
            width: auto;
            opacity: 0.9;
        }

        /* 뒤로가기 버튼 */
        .back-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .back-btn:hover {
            color: #FF1493;
        }

        /* AI 상담 버튼 */
        .ai-chat-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            padding: 0;
        }

        .ai-chat-btn:hover {
            transform: scale(1.1);
        }

        .ai-chat-btn:hover .face-scan-icon {
            filter: drop-shadow(0 0 10px rgba(255, 20, 147, 0.6));
        }

        .face-scan-icon {
            width: 100%;
            height: 100%;
            transition: all 0.3s ease;
        }

        /* 네비게이션 탭 */
        .nav-tabs {
            display: flex;
            background-color: #000;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 0 20px;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            white-space: nowrap;
            color: #888;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .nav-tab.active {
            color: #fff;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FF1493, #FF69B4);
        }

        .nav-tab:hover {
            color: #FF69B4;
        }

        /* 콘텐츠 영역 */
        .content {
            margin-top: 100px;
            padding: 20px;
            min-height: calc(100vh - 100px);
            overflow-x: auto; /* 가로 스크롤 허용 */
            overflow-y: auto; /* 세로 스크롤도 허용 */
        }

        .category-section {
            display: none;
        }

        .category-section.active {
            display: block;
        }

        .category-description {
            margin-bottom: 20px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            line-height: 1.6;
            color: #ccc;
        }

        /* 앞머리 길이 탭 (가운데 정렬) */
        .length-tabs {
            display: flex;
            justify-content: center; /* 가운데 정렬 */
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .length-tabs::-webkit-scrollbar {
            display: none;
        }

        .length-tab {
            padding: 10px 20px;
            cursor: pointer;
            white-space: nowrap;
            color: #888;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            font-size: 14px;
        }

        .length-tab.active {
            color: #fff;
            background-color: #FF1493;
        }

        .length-tab:hover {
            color: #fff;
            background-color: rgba(255, 20, 147, 0.7);
        }

        /* 헤어스타일 그리드 */
        .hairstyle-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            min-width: 100%;
            overflow-x: auto; /* 가로 스크롤 허용 */
            -webkit-overflow-scrolling: touch; /* iOS 부드러운 스크롤 */
            scrollbar-width: thin; /* Firefox 얇은 스크롤바 */
        }

        /* 스크롤바 스타일링 */
        .hairstyle-grid::-webkit-scrollbar {
            height: 6px;
        }

        .hairstyle-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .hairstyle-grid::-webkit-scrollbar-thumb {
            background: #FF1493;
            border-radius: 3px;
        }

        .hairstyle-grid::-webkit-scrollbar-thumb:hover {
            background: #FF69B4;
        }

        .hairstyle-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-width: 200px; /* 최소 너비 보장 */
            flex-shrink: 0; /* 축소 방지 */
        }

        .hairstyle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.3);
        }

        /* 터치 디바이스 최적화 */
        @media (hover: none) {
            .hairstyle-card:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
        }

        .hairstyle-image {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            background-color: #222;
        }

        .hairstyle-info {
            padding: 15px;
            text-align: center;
        }

        .hairstyle-code {
            font-size: 12px;
            color: #FF69B4;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .hairstyle-name {
            font-size: 14px;
            color: #fff;
            font-weight: 500;
        }

        /* 앞머리 길이 섹션 */
        .length-section {
            display: none;
        }

        .length-section.active {
            display: block;
        }

        /* 이미지 모달 - 터치 최적화 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            animation: fadeIn 0.3s ease;
            -webkit-overflow-scrolling: touch; /* iOS 부드러운 스크롤 */
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 95%; /* 모바일에서 더 넓게 */
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            padding: 10px; /* 터치 영역 확대 */
        }

        .close:hover {
            color: #FF69B4;
        }

        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 10px;
            touch-action: pinch-zoom; /* 핀치 줌 허용 */
        }

        .modal-info {
            margin-top: 20px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 400px;
        }

        .modal-info h3 {
            color: #FF69B4;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .modal-info p {
            font-size: 18px;
            color: #fff;
        }

        /* 모바일 모달 최적화 */
        @media screen and (max-width: 600px) {
            .close {
                font-size: 35px;
                top: 5px;
                right: 15px;
                padding: 15px;
            }
            
            .modal-image {
                max-height: 60vh;
            }
            
            .modal-info {
                padding: 15px;
                margin-top: 15px;
            }
            
            .modal-info h3 {
                font-size: 20px;
            }
            
            .modal-info p {
                font-size: 16px;
            }
        }

        /* 로딩 스피너 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #FF1493;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 동기화 상태 표시 */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 200;
            display: none;
            max-width: 300px;
            text-align: center;
        }

        .sync-status.connected {
            background-color: rgba(40, 167, 69, 0.9);
        }

        .sync-status.disconnected {
            background-color: rgba(220, 53, 69, 0.9);
        }

        .sync-status.updating {
            background-color: rgba(255, 193, 7, 0.9);
            color: #000;
        }

        /* 빈 상태 메시지 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: #999;
        }

        .empty-state-message {
            font-size: 14px;
            line-height: 1.5;
            color: #666;
        }

        /* 반응형 - 태블릿과 모바일 최적화 */
        @media screen and (max-width: 1200px) {
            .hairstyle-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
            }
            
            .hairstyle-card {
                min-width: 180px;
            }
        }

        @media screen and (max-width: 900px) {
            .hairstyle-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .hairstyle-card {
                min-width: 160px;
            }
            
            .content {
                padding: 15px;
            }
        }

        @media screen and (max-width: 600px) {
            .hairstyle-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .hairstyle-card {
                min-width: 140px;
            }
            
            .content {
                padding: 10px;
            }
            
            .nav-tab {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .length-tab {
                padding: 8px 16px;
                font-size: 13px;
            }
        }

        /* 20개 이상 스타일이 있을 때 가로 스크롤 처리 */
        @media screen and (min-width: 1201px) {
            .hairstyle-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- 성별 선택 화면 -->
    <div class="gender-selection" id="genderSelection">
        <div class="gender-card male" onclick="selectGender('male')">
            <div class="gender-icon">♂</div>
            <div class="gender-title">남성</div>
            <div class="gender-subtitle">Men's Hairstyle</div>
        </div>
        
        <div class="gender-card female" onclick="selectGender('female')">
            <div class="gender-icon">♀</div>
            <div class="gender-title">여성</div>
            <div class="gender-subtitle">Women's Hairstyle</div>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="main-container" id="mainContainer">
        <!-- 헤더 -->
        <header class="header">
            <div class="logo-section">
                <button class="back-btn" onclick="backToGenderSelection()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>뒤로</span>
                </button>
                
                <div class="logo">
                    <span style="color: #FF1493; font-size: 18px; font-weight: 700; letter-spacing: -0.5px;">HAIRGATOR</span>
                </div>
                
                <button class="ai-chat-btn" onclick="window.open('https://hairgator-face.web.app', '_blank')" title="AI 얼굴 분석">
                    <svg class="face-scan-icon" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- 얼굴 윤곽 -->
                        <path d="M18 4 C10 4, 6 10, 6 18 C6 26, 10 32, 18 32 C26 32, 30 26, 30 18 C30 10, 26 4, 18 4" 
                              stroke="#FF1493" stroke-width="2" fill="none"/>
                        
                        <!-- 스캔 라인들 -->
                        <path d="M8 12h20M8 18h20M8 24h20" stroke="#FF69B4" stroke-width="1" opacity="0.5"/>
                        
                        <!-- 눈 -->
                        <circle cx="13" cy="15" r="1.5" fill="#FF1493"/>
                        <circle cx="23" cy="15" r="1.5" fill="#FF1493"/>
                        
                        <!-- 코 -->
                        <circle cx="18" cy="20" r="1" fill="#FF69B4"/>
                        
                        <!-- 입 -->
                        <path d="M14 24 Q18 26 22 24" stroke="#FF1493" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                        
                        <!-- 코너 브래킷 -->
                        <path d="M2 2h6v6M28 2h6v6M2 28v6h6M28 28v6h6" stroke="#FF1493" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    </svg>
                </button>
            </div>
            
            <!-- 네비게이션 탭 -->
            <nav class="nav-tabs" id="navTabs">
                <!-- 동적으로 생성됩니다 -->
            </nav>
        </header>

        <!-- 콘텐츠 영역 -->
        <main class="content" id="content">
            <!-- 카테고리별 섹션들이 동적으로 추가됩니다 -->
        </main>
    </div>

    <!-- 이미지 모달 -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img class="modal-image" id="modalImage" src="" alt="">
            <div class="modal-info">
                <h3 id="modalCode"></h3>
                <p id="modalName"></p>
            </div>
        </div>
    </div>

    <!-- 동기화 상태 표시 -->
    <div class="sync-status" id="syncStatus">Firebase 연결 중...</div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        console.log('🚀 HAIRGATOR 실시간 동기화 인덱스 시작');
        
        // Firebase 설정 (어드민과 동일)
        const firebaseConfig = {
            apiKey: "AIzaSyBeTlHZwgx36hR-F35QPtGG2xvE5EY0XmY",
            authDomain: "hairgatormenu-4a43e.firebaseapp.com",
            projectId: "hairgatormenu-4a43e",
            storageBucket: "hairgatormenu-4a43e.firebasestorage.app",
            messagingSenderId: "800038006875",
            appId: "1:800038006875:web:2a4de70e3a306986e0cf7e"
        };

        // Firebase 초기화
        let db;
        let firebaseConnected = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseConnected = true;
            console.log('✅ Firebase 연결 성공');
            updateSyncStatus('connected', '✅ Firebase 연결됨');
        } catch (error) {
            console.error('❌ Firebase 초기화 오류:', error);
            updateSyncStatus('disconnected', '❌ Firebase 연결 실패');
            firebaseConnected = false;
        }

        // 전역 변수
        let currentGender = null;
        let currentCategory = null;
        let hierarchyStructure = {}; // 어드민과 100% 동일한 구조

        // 🔄 동기화 상태 업데이트
        function updateSyncStatus(status, message) {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.className = `sync-status ${status}`;
            syncStatus.textContent = message;
            syncStatus.style.display = 'block';
            
            // 5초 후 자동 숨김 (연결됨 상태가 아닌 경우만)
            if (status !== 'connected') {
                setTimeout(() => {
                    syncStatus.style.display = 'none';
                }, 5000);
            }
        }

        // 🎯 성별 선택 (실시간 동기화)
        function selectGender(gender) {
            console.log(`🎯 성별 선택: ${gender}`);
            currentGender = gender;
            document.getElementById('genderSelection').classList.add('hidden');
            document.getElementById('mainContainer').classList.add('active');
            
            updateSyncStatus('updating', '📊 어드민 실시간 동기화 중...');
            
            // 🔥 무조건 Firebase에서만 데이터 로드 (기본 구조 사용 금지)
            loadHierarchyFromFirebaseOnly(gender);
        }

        // 성별 선택 화면으로 돌아가기
        function backToGenderSelection() {
            document.getElementById('genderSelection').classList.remove('hidden');
            document.getElementById('mainContainer').classList.remove('active');
            currentGender = null;
            currentCategory = null;
            hierarchyStructure = {};
        }

        // 🔥 Firebase에서만 계층 구조 로드 (실시간 동기화 보장)
        async function loadHierarchyFromFirebaseOnly(gender) {
            console.log(`=== 🔥 Firebase 실시간 동기화: ${gender} ===`);
            
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            if (!firebaseConnected) {
                console.log('❌ Firebase 연결 실패');
                showAdminInitializationRequired('Firebase 연결이 필요합니다. 페이지를 새로고침해주세요.');
                updateSyncStatus('disconnected', '❌ Firebase 연결 실패');
                return;
            }

            try {
                // 🔥 어드민과 100% 동일한 실시간 쿼리
                console.log('📊 어드민과 동일한 category_hierarchy 실시간 쿼리...');
                
                const hierarchySnapshot = await db.collection('category_hierarchy')
                    .where('gender', '==', gender)
                    // .orderBy('updatedAt', 'desc')  // 인덱스 오류 방지를 위해 제거
                    .get();
                
                console.log(`📋 실시간 쿼리 결과: ${hierarchySnapshot.size}개 문서`);
                
                if (hierarchySnapshot.empty) {
                    console.log('⚠️ category_hierarchy가 비어있음 - 어드민 초기화 필요');
                    showAdminInitializationRequired('어드민에서 "Excel 데이터로 Firebase 초기화" 버튼을 먼저 클릭해주세요.');
                    updateSyncStatus('disconnected', '⚠️ 어드민 초기화 필요');
                    return;
                }
                
                // 🏗️ 어드민과 100% 동일한 구조 생성
                const mainCategories = {};
                let lastUpdateTime = null;
                let totalDocs = 0;
                
                hierarchySnapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('📄 실시간 동기화된 문서:', data);
                    
                    const mainCat = data.mainCategory;
                    const subCat = data.subCategory;
                    
                    if (!mainCategories[mainCat]) {
                        mainCategories[mainCat] = [];
                    }
                    if (!mainCategories[mainCat].includes(subCat)) {
                        mainCategories[mainCat].push(subCat);
                    }
                    
                    // 최신 업데이트 시간 추적
                    if (data.updatedAt && (!lastUpdateTime || data.updatedAt.toDate() > lastUpdateTime)) {
                        lastUpdateTime = data.updatedAt.toDate();
                    }
                    
                    totalDocs++;
                });
                
                console.log('✅ 어드민과 100% 동일한 실시간 구조 생성:', mainCategories);
                
                // hierarchyStructure 업데이트 (어드민과 동일)
                hierarchyStructure[gender] = mainCategories;
                
                // 대분류 탭 렌더링
                renderMainCategoryTabs(Object.keys(mainCategories));
                
                // 첫 번째 카테고리 자동 로드
                const firstCategory = Object.keys(mainCategories)[0];
                if (firstCategory) {
                    currentCategory = firstCategory;
                    loadStylesFromHierarchyRealtime(firstCategory);
                }
                
                // 실시간 동기화 완료 상태 표시
                const timeStr = lastUpdateTime ? lastUpdateTime.toLocaleString('ko-KR') : '방금전';
                updateSyncStatus('connected', `✅ 실시간 동기화 완료 (${timeStr}) - ${totalDocs}개 문서`);
                
            } catch (error) {
                console.error('❌ 실시간 동기화 오류:', error);
                
                if (error.code === 'failed-precondition') {
                    showAdminInitializationRequired('Firebase 인덱스가 생성 중입니다. 잠시 후 다시 시도해주세요.');
                    updateSyncStatus('updating', '🔄 Firebase 인덱스 생성 중...');
                } else {
                    showAdminInitializationRequired(`실시간 동기화 실패: ${error.message}`);
                    updateSyncStatus('disconnected', '❌ 실시간 동기화 실패');
                }
            }
        }

        // 📋 어드민 초기화 필요 메시지 표시
        function showAdminInitializationRequired(message) {
            const navTabs = document.getElementById('navTabs');
            const content = document.getElementById('content');
            
            navTabs.innerHTML = `
                <div style="color: #FF69B4; padding: 15px 25px; text-align: center; width: 100%;">
                    ⚠️ 어드민 초기화 필요
                </div>
            `;
            
            content.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">🔧</div>
                    <div class="empty-state-title">어드민 초기화가 필요합니다</div>
                    <div class="empty-state-message">
                        ${message}<br><br>
                        <strong>해결 방법:</strong><br>
                        1. 어드민 페이지로 이동<br>
                        2. "🚀 Excel 데이터로 Firebase 초기화" 버튼 클릭<br>
                        3. 이 페이지 새로고침
                    </div>
                </div>
            `;
        }

        // 📋 대분류 탭 렌더링 (어드민 순서 고정)
        function renderMainCategoryTabs(mainCategories) {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '';
            
            if (!mainCategories || mainCategories.length === 0) {
                navTabs.innerHTML = '<div style="color: #666; padding: 20px;">카테고리를 불러올 수 없습니다.</div>';
                return;
            }
            
            // 🎯 고정된 순서 정의 (어드민과 동일)
            const categoryOrder = {
                male: ['SIDE FRINGE', 'SIDE FART', 'FRINDGE UP', 'PUSHED BACK', 'BUZZ', 'CROP', 'MOHICAN'],
                female: ['LONG', 'SEMI LONG', 'MEDIUM', 'BOB', 'SHORT']
            };
            
            // 현재 성별에 맞는 순서대로 정렬
            const orderedCategories = categoryOrder[currentGender] || mainCategories;
            
            orderedCategories.forEach((mainCategory, index) => {
                if (mainCategories.includes(mainCategory)) {
                    const tab = document.createElement('div');
                    tab.className = index === 0 ? 'nav-tab active' : 'nav-tab';
                    tab.dataset.category = mainCategory;
                    tab.textContent = mainCategory;
                    tab.onclick = () => switchCategory(mainCategory);
                    navTabs.appendChild(tab);
                }
            });
        }

        // 🔄 카테고리 전환 (실시간 동기화)
        function switchCategory(categoryId) {
            if (categoryId === currentCategory) return;
            
            console.log(`🔄 카테고리 전환: ${categoryId}`);
            
            // 활성 탭 변경
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.category === categoryId) {
                    tab.classList.add('active');
                }
            });
            
            currentCategory = categoryId;
            loadStylesFromHierarchyRealtime(categoryId);
        }

        // 🎨 헤어스타일 실시간 로드 (어드민 구조 기반)
        async function loadStylesFromHierarchyRealtime(mainCategory) {
            console.log(`=== 🎨 헤어스타일 실시간 로드: ${currentGender}, ${mainCategory} ===`);
            
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            if (!firebaseConnected) {
                console.log('❌ Firebase 연결 없음');
                showEmptyState('Firebase 연결이 필요합니다');
                updateSyncStatus('disconnected', '❌ Firebase 연결 필요');
                return;
            }

            try {
                // 🎯 실시간 어드민 구조 기반 스타일 로드
                const subCategories = hierarchyStructure[currentGender]?.[mainCategory] || [];
                console.log(`📂 실시간 중분류 목록: ${subCategories.join(', ')}`);
                
                if (subCategories.length === 0) {
                    console.log('⚠️ 중분류가 없음');
                    showEmptyState('중분류가 설정되지 않았습니다. 어드민에서 확인해주세요.');
                    updateSyncStatus('disconnected', '⚠️ 중분류 없음');
                    return;
                }

                // 🔍 실시간 다중 쿼리 방식 (어드민과 동일)
                let allStyles = {};
                let foundData = false;
                let totalStyles = 0;
                
                console.log('📊 실시간 스타일 데이터 로드 중...');
                
                // 실시간 쿼리: categoryPath 방식 (어드민과 동일)
                for (const subCategory of subCategories) {
                    const categoryPath = `${currentGender}_${mainCategory}_${subCategory}`;
                    console.log(`🔍 실시간 categoryPath 조회: ${categoryPath}`);
                    
                    try {
                        // 🔥 orderBy 제거하여 인덱스 오류 방지 (어드민과 동일)
                        const pathSnapshot = await db.collection('hairstyles')
                            .where('categoryPath', '==', categoryPath)
                            .get();
                        
                        if (!pathSnapshot.empty) {
                            allStyles[subCategory] = [];
                            pathSnapshot.forEach(doc => {
                                const style = doc.data();
                                allStyles[subCategory].push({
                                    ...style,
                                    id: doc.id
                                });
                                totalStyles++;
                            });
                            foundData = true;
                            console.log(`✅ ${subCategory}: ${pathSnapshot.size}개 스타일 발견`);
                        } else {
                            console.log(`📄 ${subCategory}: 스타일 없음`);
                        }
                    } catch (error) {
                        console.log(`⚠️ categoryPath 쿼리 실패 (${categoryPath}):`, error.message);
                    }
                }
                
                // 결과 렌더링
                if (foundData && Object.keys(allStyles).length > 0) {
                    console.log('🎨 실시간 스타일 데이터 렌더링:', allStyles);
                    renderCategoryRealtime({
                        description: getMainCategoryDescription(mainCategory),
                        styles: allStyles
                    });
                    updateSyncStatus('connected', `✅ ${totalStyles}개 스타일 실시간 로드 완료`);
                } else {
                    console.log('📄 실시간 스타일 데이터 없음');
                    renderEmptyStylesRealtime(mainCategory, subCategories);
                    updateSyncStatus('connected', '📄 등록된 스타일이 없습니다 (실시간 확인 완료)');
                }
                
            } catch (error) {
                console.error('❌ 실시간 헤어스타일 로드 오류:', error);
                showEmptyState('실시간 스타일 데이터를 불러올 수 없습니다');
                updateSyncStatus('disconnected', '❌ 실시간 로드 실패: ' + error.message);
            }
        }

        // 📝 대분류 설명 가져오기 (어드민과 동일)
        function getMainCategoryDescription(mainCategory) {
            const descriptions = {
                'SIDE FRINGE': '사이드프린지는 살짝 볼륨이 있으면서 앞으로 떨어지는 스타일과 앞머리 숱을 줄여 소프트한 시스루 느낌을 다양하게 표현할 수 있습니다. M자 이마와 넓은 이마를 커버하면서 볼륨과 플랫, 웨이브와 스트레이트의 구성 요소를 디테일하게 표현하는 것이 스타일링의 핵심 포인트입니다.',
                'SIDE FART': '사이드 파트는 클래식함과 모던함의 대명사로 스타일링에 따라 원하는 이미지를 자유롭게 표현할 수 있습니다. 가르마를 기준으로 단순히 넘어가는 스타일을 넘어 개인의 특성과 트렌드에 맞춰 고급한 헤어스타일을 표현하는 것이 매우 중요합니다.',
                'FRINDGE UP': '프린지 업은 흔히 아이비리그 컷이라고 하여, 이마를 적극적으로 드러내어 남성적인 이미지를 어필하기 유리한 스타일입니다. 다운펌을 통해 뒷머리와 앞머리를 정리하는 것이 스타일링의 특성상 트렌드에 얽매이지 말고 나름의 포인트와 특색으로 관리하는 것이 중요합니다.',
                'PUSHED BACK': '푸시드 백은 앞머리 부분의 볼륨감을 강조한 스타일로써, 뒷부분으로 넘기면서 뒤로 갈수록 볼륨이 적어지는 것이 특징인 스타일입니다. 모발의 길이가 중간 정도 이상인 분들에게 가장 적합하며, 정교하고 섬세한 길이 조절을 통해 고급스러운 이미지를 유지할 수 있습니다.',
                'BUZZ': '버즈컷은 흔히 반삭이라고 하여 클리퍼의 길이와 헤어 스타일에 따라 다양한 스타일을 연출할 수 있습니다. 정교하고 섬세한 길이 조절이 가장 중요하지만 강함이 아닌 곡선미가 주는 특성인 개성을 강점으로 할 수 있습니다.',
                'CROP': '크롭컷은 매우 짧은 라운드 형태로 깔끔하면서도 세련된 남성미를 강조한 스타일입니다. 앞머리를 짧게 하여 깔끔한 인상을 주며, 양쪽과 뒷머리의 이미지를 단정하게 강조하여 모발의 길이와 절단에 따라 다양한 이미지를 연출할 수 있습니다.',
                'MOHICAN': '모히칸은 옆머리를 짧게 하고 윗머리에 앞머리에서 뒷머리로 이어지는 라인을 표현하여, 둥근 얼굴형을 보완할 수 있는 개성이 남다른 스타일입니다.',
                'LONG': '롱 헤어는 여성스러움과 우아함을 동시에 표현할 수 있는 대표적인 스타일입니다. 다양한 연출이 가능하며 개인의 취향에 따라 웨이브나 스트레이트 등으로 변화를 줄 수 있습니다.',
                'SEMI LONG': '세미 롱 헤어는 롱과 미디엄의 중간 길이로, 여성스러움을 유지하면서도 관리가 용이한 실용적인 스타일입니다.',
                'MEDIUM': '미디엄 헤어는 관리의 편의성과 스타일링의 다양성을 모두 갖춘 실용적인 길이입니다. 직장인부터 학생까지 다양한 연령대에 적합합니다.',
                'BOB': '밥 헤어는 턱선 근처의 깔끔한 라인이 특징으로, 모던하고 세련된 느낌을 연출할 수 있는 클래식한 스타일입니다.',
                'SHORT': '숏 헤어는 세련되고 시크한 분위기를 연출하며, 얼굴형을 또렷하게 부각시키는 스타일입니다. 관리가 쉽고 활동적인 이미지를 표현할 수 있습니다.'
            };
            
            return descriptions[mainCategory] || `${mainCategory} 스타일에 대한 설명입니다.`;
        }

        // 🎨 카테고리 실시간 렌더링 (중분류 탭 항상 표시 + 가운데 정렬)
        function renderCategoryRealtime(categoryData) {
            const content = document.getElementById('content');
            
            if (!categoryData || !categoryData.styles) {
                showEmptyState('실시간 카테고리 데이터를 불러올 수 없습니다');
                return;
            }

            const lengthTypes = Object.keys(categoryData.styles);
            
            if (lengthTypes.length === 0) {
                showEmptyState('등록된 스타일이 없습니다 (실시간 확인 완료)');
                return;
            }
            
            let html = `
                <div class="category-section active">
                    <div class="category-description">${categoryData.description}</div>
                    
                    <!-- 중분류 탭 (항상 표시, 가운데 정렬) -->
                    <div class="length-tabs">
            `;

            // 중분류 탭 생성 (어드민 순서 고정)
            const orderedLengthTypes = hierarchyStructure[currentGender]?.[currentCategory] || lengthTypes;
            orderedLengthTypes.forEach((lengthType, index) => {
                if (lengthTypes.includes(lengthType)) {
                    const isActive = index === 0 ? 'active' : '';
                    html += `<div class="length-tab ${isActive}" data-length="${lengthType}" onclick="switchLengthTab('${lengthType}')">${lengthType}</div>`;
                }
            });

            html += `</div>`;

            // 각 앞머리 길이별 섹션 (어드민 순서대로)
            const orderedLengthList = hierarchyStructure[currentGender]?.[currentCategory] || Object.keys(categoryData.styles);
            const primaryLengthType = orderedLengthList[0];
            
            for (const lengthType of orderedLengthList) {
                if (!categoryData.styles[lengthType]) continue;
                
                const styles = categoryData.styles[lengthType];
                const isActive = lengthType === primaryLengthType ? 'active' : '';
                
                html += `<div class="length-section ${isActive}" data-length="${lengthType}">`;

                if (!styles || styles.length === 0) {
                    html += `
                        <div class="empty-state">
                            <div class="empty-state-icon">✂️</div>
                            <div class="empty-state-title">${lengthType}</div>
                            <div class="empty-state-message">해당 앞머리 길이에 대한 스타일이 없습니다.<br>어드민에서 스타일을 추가해주세요.</div>
                        </div>
                    `;
                } else {
                    html += `<div class="hairstyle-grid">`;
                    
                    // 🎯 스타일을 code 순서대로 정렬
                    const sortedStyles = styles.sort((a, b) => {
                        const codeA = a.code || '';
                        const codeB = b.code || '';
                        return codeA.localeCompare(codeB);
                    });
                    
                    sortedStyles.forEach(style => {
                        const imageUrl = style.imageUrl || generatePlaceholderImage(style.name);
                        
                        html += `
                            <div class="hairstyle-card" onclick="openModal('${style.code || '코드없음'}', '${style.name || '이름없음'}', '${style.imageUrl || ''}')">
                                <img class="hairstyle-image" src="${imageUrl}" alt="${style.name || '이름없음'}" 
                                     onerror="this.src='${generatePlaceholderImage(style.name || '이름없음')}'">
                                <div class="hairstyle-info">
                                    <div class="hairstyle-code">${style.code || '코드없음'}</div>
                                    <div class="hairstyle-name">${style.name || '이름없음'}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }

                html += `</div>`;
            }

            html += '</div>';
            content.innerHTML = html;
        }

        // 🎨 빈 스타일 실시간 렌더링 (중분류 탭 항상 표시)
        function renderEmptyStylesRealtime(mainCategory, subCategories) {
            const content = document.getElementById('content');
            
            let html = `
                <div class="category-section active">
                    <div class="category-description">${getMainCategoryDescription(mainCategory)}</div>
                    
                    <!-- 중분류 탭 (항상 표시, 가운데 정렬) -->
                    <div class="length-tabs">
            `;

            // 중분류 탭 생성 (어드민 순서 고정)
            const orderedSubCategories = hierarchyStructure[currentGender]?.[mainCategory] || subCategories;
            orderedSubCategories.forEach((subCategory, index) => {
                const isActive = index === 0 ? 'active' : '';
                html += `<div class="length-tab ${isActive}" data-length="${subCategory}" onclick="switchLengthTab('${subCategory}')">${subCategory}</div>`;
            });
            
            html += `</div>`;

            // 중분류별 빈 상태 섹션 (어드민 순서대로)
            const orderedEmptyCategories = hierarchyStructure[currentGender]?.[mainCategory] || subCategories;
            orderedEmptyCategories.forEach((subCategory, index) => {
                const isActive = index === 0 ? 'active' : '';
                html += `
                    <div class="length-section ${isActive}" data-length="${subCategory}">
                        <div class="empty-state">
                            <div class="empty-state-icon">✂️</div>
                            <div class="empty-state-title">${subCategory}</div>
                            <div class="empty-state-message">등록된 스타일이 없습니다.<br>어드민에서 스타일을 추가해주세요.</div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            content.innerHTML = html;
        }

        // 📄 빈 상태 표시
        function showEmptyState(message) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">⚠️</div>
                    <div class="empty-state-title">데이터가 없습니다</div>
                    <div class="empty-state-message">${message}</div>
                </div>
            `;
        }

        // 🖼️ 플레이스홀더 이미지 생성
        function generatePlaceholderImage(text) {
            const encodedText = encodeURIComponent(text || '이미지 준비중');
            return `data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="267" viewBox="0 0 200 267"%3E%3Crect width="200" height="267" fill="%23222"%3E%3C/rect%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%23666" font-family="Arial" font-size="12"%3E${encodedText}%3C/text%3E%3C/svg%3E`;
        }

        // 앞머리 길이 탭 전환
        function switchLengthTab(lengthType) {
            // 활성 탭 변경
            document.querySelectorAll('.length-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.length === lengthType) {
                    tab.classList.add('active');
                }
            });

            // 활성 섹션 변경
            document.querySelectorAll('.length-section').forEach(section => {
                section.classList.remove('active');
                if (section.dataset.length === lengthType) {
                    section.classList.add('active');
                }
            });
        }

        // 모달 초기화
        function initializeModal() {
            const modal = document.getElementById('imageModal');
            const span = document.getElementsByClassName('close')[0];

            span.onclick = function() {
                modal.style.display = 'none';
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }

        // 모달 열기
        function openModal(code, name, imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCode = document.getElementById('modalCode');
            const modalName = document.getElementById('modalName');

            const finalImageUrl = imageUrl || generatePlaceholderImage(name);
            
            modalImage.src = finalImageUrl;
            modalCode.textContent = code;
            modalName.textContent = name;
            modal.style.display = 'block';
        }

        // 🚀 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeModal();
            console.log('🎉 HAIRGATOR 실시간 동기화 인덱스 로드 완료!');
            
            // 개발자를 위한 디버그 함수들
            window.debugHairGator = {
                hierarchyStructure,
                currentGender,
                currentCategory,
                firebaseConnected,
                loadHierarchyFromFirebaseOnly,
                loadStylesFromHierarchyRealtime,
                testConnection: () => {
                    if (firebaseConnected) {
                        console.log('✅ Firebase 연결 상태 양호');
                        return true;
                    } else {
                        console.log('❌ Firebase 연결 실패');
                        return false;
                    }
                }
            };
        });
    </script>
</body>
</html>
