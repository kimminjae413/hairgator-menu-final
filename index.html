<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HAIRGATOR - 헤어스타일 메뉴판</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: auto;
            overflow-y: hidden;
            height: 100vh;
            position: relative;
        }

        /* 강제 가로모드 */
        @media screen and (orientation: portrait) {
            body {
                transform: rotate(90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: absolute;
                top: 100%;
                left: 0;
            }
        }

        /* 성별 선택 화면 */
        .gender-selection {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #000;
            gap: 40px;
        }

        .gender-selection.hidden {
            display: none;
        }

        .gender-card {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 40px;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
        }

        .gender-card:hover {
            transform: translateY(-10px);
            border-color: #FF1493;
            box-shadow: 0 10px 40px rgba(255, 20, 147, 0.3);
        }

        .gender-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            border-radius: 50%;
        }

        .gender-card.male .gender-icon {
            background: linear-gradient(135deg, #4169E1, #1E90FF);
        }

        .gender-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .gender-subtitle {
            color: #999;
            font-size: 14px;
        }

        /* 메인 컨테이너 */
        .main-container {
            display: none;
        }

        .main-container.active {
            display: block;
        }

        /* 헤더 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #000;
            z-index: 100;
            border-bottom: 1px solid #333;
        }

        .logo-section {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-img {
            height: 24px;
            width: auto;
            opacity: 0.9;
        }

        /* 뒤로가기 버튼 */
        .back-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .back-btn:hover {
            color: #FF1493;
        }

        /* AI 상담 버튼 */
        .ai-chat-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            padding: 0;
        }

        .ai-chat-btn:hover {
            transform: scale(1.1);
        }

        .ai-chat-btn:hover .face-scan-icon {
            filter: drop-shadow(0 0 10px rgba(255, 20, 147, 0.6));
        }

        .face-scan-icon {
            width: 100%;
            height: 100%;
            transition: all 0.3s ease;
        }

        /* 네비게이션 탭 */
        .nav-tabs {
            display: flex;
            background-color: #000;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 0 20px;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            white-space: nowrap;
            color: #888;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .nav-tab.active {
            color: #fff;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FF1493, #FF69B4);
        }

        .nav-tab:hover {
            color: #FF69B4;
        }

        /* 콘텐츠 영역 */
        .content {
            margin-top: 100px;
            padding: 20px;
            min-height: calc(100vh - 100px);
        }

        .category-section {
            display: none;
        }

        .category-section.active {
            display: block;
        }

        .category-description {
            margin-bottom: 20px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            line-height: 1.6;
            color: #ccc;
        }

        /* 앞머리 길이 탭 */
        .length-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 10px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .length-tabs::-webkit-scrollbar {
            display: none;
        }

        .length-tab {
            padding: 10px 20px;
            cursor: pointer;
            white-space: nowrap;
            color: #888;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            font-size: 14px;
        }

        .length-tab.active {
            color: #fff;
            background-color: #FF1493;
        }

        .length-tab:hover {
            color: #fff;
            background-color: rgba(255, 20, 147, 0.7);
        }

        /* 헤어스타일 그리드 */
        .hairstyle-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .hairstyle-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .hairstyle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.3);
        }

        .hairstyle-image {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            background-color: #222;
        }

        .hairstyle-info {
            padding: 15px;
            text-align: center;
        }

        .hairstyle-code {
            font-size: 12px;
            color: #FF69B4;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .hairstyle-name {
            font-size: 14px;
            color: #fff;
            font-weight: 500;
        }

        /* 앞머리 길이 섹션 */
        .length-section {
            display: none;
        }

        .length-section.active {
            display: block;
        }

        /* 이미지 모달 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
        }

        .close:hover {
            color: #FF69B4;
        }

        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 10px;
        }

        .modal-info {
            margin-top: 20px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .modal-info h3 {
            color: #FF69B4;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .modal-info p {
            font-size: 18px;
            color: #fff;
        }

        /* 로딩 스피너 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #FF1493;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 동기화 상태 표시 */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 200;
            display: none;
        }

        .sync-status.connected {
            background-color: rgba(40, 167, 69, 0.8);
        }

        .sync-status.disconnected {
            background-color: rgba(220, 53, 69, 0.8);
        }

        .sync-status.updating {
            background-color: rgba(255, 193, 7, 0.8);
            color: #000;
        }

        /* 반응형 */
        @media screen and (max-width: 1200px) {
            .hairstyle-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media screen and (max-width: 900px) {
            .hairstyle-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- 성별 선택 화면 -->
    <div class="gender-selection" id="genderSelection">
        <div class="gender-card male" onclick="selectGender('male')">
            <div class="gender-icon">♂</div>
            <div class="gender-title">남성</div>
            <div class="gender-subtitle">Men's Hairstyle</div>
        </div>
        
        <div class="gender-card female" onclick="selectGender('female')">
            <div class="gender-icon">♀</div>
            <div class="gender-title">여성</div>
            <div class="gender-subtitle">Women's Hairstyle</div>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="main-container" id="mainContainer">
        <!-- 헤더 -->
        <header class="header">
            <div class="logo-section">
                <button class="back-btn" onclick="backToGenderSelection()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>뒤로</span>
                </button>
                
                <div class="logo">
                    <span style="color: #FF1493; font-size: 18px; font-weight: 700; letter-spacing: -0.5px;">HAIRGATOR</span>
                </div>
                
                <button class="ai-chat-btn" onclick="window.open('https://hairgator-face.web.app', '_blank')" title="AI 얼굴 분석">
                    <svg class="face-scan-icon" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- 얼굴 윤곽 -->
                        <path d="M18 4 C10 4, 6 10, 6 18 C6 26, 10 32, 18 32 C26 32, 30 26, 30 18 C30 10, 26 4, 18 4" 
                              stroke="#FF1493" stroke-width="2" fill="none"/>
                        
                        <!-- 스캔 라인들 -->
                        <path d="M8 12h20M8 18h20M8 24h20" stroke="#FF69B4" stroke-width="1" opacity="0.5"/>
                        
                        <!-- 눈 -->
                        <circle cx="13" cy="15" r="1.5" fill="#FF1493"/>
                        <circle cx="23" cy="15" r="1.5" fill="#FF1493"/>
                        
                        <!-- 코 -->
                        <circle cx="18" cy="20" r="1" fill="#FF69B4"/>
                        
                        <!-- 입 -->
                        <path d="M14 24 Q18 26 22 24" stroke="#FF1493" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                        
                        <!-- 코너 브래킷 -->
                        <path d="M2 2h6v6M28 2h6v6M2 28v6h6M28 28v6h6" stroke="#FF1493" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    </svg>
                </button>
            </div>
            
            <!-- 네비게이션 탭 -->
            <nav class="nav-tabs" id="navTabs">
                <!-- 동적으로 생성됩니다 -->
            </nav>
        </header>

        <!-- 콘텐츠 영역 -->
        <main class="content" id="content">
            <!-- 카테고리별 섹션들이 동적으로 추가됩니다 -->
        </main>
    </div>

    <!-- 이미지 모달 -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img class="modal-image" id="modalImage" src="" alt="">
            <div class="modal-info">
                <h3 id="modalCode"></h3>
                <p id="modalName"></p>
            </div>
        </div>
    </div>

    <!-- 동기화 상태 표시 -->
    <div class="sync-status" id="syncStatus">Firebase 연결 중...</div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        console.log('🚀 어드민 동기화된 HAIRGATOR 시작');
        
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyBeTlHZwgx36hR-F35QPtGG2xvE5EY0XmY",
            authDomain: "hairgatormenu-4a43e.firebaseapp.com",
            projectId: "hairgatormenu-4a43e",
            storageBucket: "hairgatormenu-4a43e.firebasestorage.app",
            messagingSenderId: "800038006875",
            appId: "1:800038006875:web:2a4de70e3a306986e0cf7e"
        };

        // Firebase 초기화
        let db;
        let firebaseConnected = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseConnected = true;
            console.log('✅ Firebase 연결 성공');
            updateSyncStatus('connected', 'Firebase 연결됨');
        } catch (error) {
            console.error('❌ Firebase 초기화 오류:', error);
            updateSyncStatus('disconnected', 'Firebase 연결 실패');
            firebaseConnected = false;
        }

        // 전역 변수
        let currentGender = null;
        let currentCategory = null;
        let hierarchyStructure = {}; // 동적으로 로드됨

        // 🔄 동기화 상태 업데이트
        function updateSyncStatus(status, message) {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.className = `sync-status ${status}`;
            syncStatus.textContent = message;
            syncStatus.style.display = 'block';
            
            // 3초 후 자동 숨김
            setTimeout(() => {
                syncStatus.style.display = 'none';
            }, 3000);
        }

        // 🎯 성별 선택 (어드민과 동일한 구조)
        function selectGender(gender) {
            console.log(`🎯 성별 선택: ${gender}`);
            currentGender = gender;
            document.getElementById('genderSelection').classList.add('hidden');
            document.getElementById('mainContainer').classList.add('active');
            
            updateSyncStatus('updating', '카테고리 로드 중...');
            
            // 성별에 따른 카테고리 로드
            loadMainCategoriesFromAdmin(gender);
        }

        // 성별 선택 화면으로 돌아가기
        function backToGenderSelection() {
            document.getElementById('genderSelection').classList.remove('hidden');
            document.getElementById('mainContainer').classList.remove('active');
            currentGender = null;
            currentCategory = null;
            hierarchyStructure = {};
        }

        // 🔧 어드민과 동일한 방식으로 대분류 로드 (실시간 동기화)
        async function loadMainCategoriesFromAdmin(gender) {
            console.log(`=== 어드민 동기화 대분류 로드: ${gender} ===`);
            
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                if (firebaseConnected) {
                    // 🔥 어드민과 100% 동일한 쿼리 (캐시 무효화)
                    console.log('어드민 동기화된 계층 구조 로드...');
                    
                    // 캐시 무효화를 위한 타임스탬프 추가
                    const hierarchySnapshot = await db.collection('category_hierarchy')
                        .where('gender', '==', gender)
                        .orderBy('updatedAt', 'desc')  // 최신 순으로 정렬
                        .get();
                    
                    console.log(`📊 실시간 쿼리 결과: ${hierarchySnapshot.size}개 문서`);
                    
                    if (hierarchySnapshot.empty) {
                        console.log('⚠️ 어드민에서 아직 동기화되지 않음, 기본 구조 사용');
                        updateSyncStatus('disconnected', '어드민 동기화 대기 중');
                        useDefaultStructure(gender);
                        return;
                    }
                    
                    // 대분류별로 그룹화 (어드민과 동일한 로직)
                    const mainCategories = {};
                    let lastUpdateTime = null;
                    
                    hierarchySnapshot.forEach(doc => {
                        const data = doc.data();
                        console.log('📄 동기화된 문서:', data);
                        
                        if (!mainCategories[data.mainCategory]) {
                            mainCategories[data.mainCategory] = [];
                        }
                        if (!mainCategories[data.mainCategory].includes(data.subCategory)) {
                            mainCategories[data.mainCategory].push(data.subCategory);
                        }
                        
                        // 최신 업데이트 시간 추적
                        if (data.updatedAt && (!lastUpdateTime || data.updatedAt.toDate() > lastUpdateTime)) {
                            lastUpdateTime = data.updatedAt.toDate();
                        }
                    });
                    
                    console.log('📁 동기화된 대분류 구조:', mainCategories);
                    
                    // hierarchyStructure 업데이트 (어드민과 동일)
                    hierarchyStructure[gender] = mainCategories;
                    
                    renderMainCategoryTabs(mainCategories);
                    
                    // 동기화 상태 표시
                    const timeStr = lastUpdateTime ? lastUpdateTime.toLocaleString('ko-KR') : '방금전';
                    updateSyncStatus('connected', `어드민 동기화 완료 (${timeStr})`);
                    
                } else {
                    console.log('❌ Firebase 연결 없음, 기본 구조 사용');
                    useDefaultStructure(gender);
                }
                
            } catch (error) {
                console.error('❌ 동기화 로드 오류:', error);
                updateSyncStatus('disconnected', '동기화 실패, 기본 구조 사용');
                useDefaultStructure(gender);
            }
        }

        // 📋 대분류 탭 렌더링
        function renderMainCategoryTabs(mainCategories) {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '';
            
            let firstCategory = null;
            Object.keys(mainCategories).forEach((mainCategory, index) => {
                const tab = document.createElement('div');
                tab.className = index === 0 ? 'nav-tab active' : 'nav-tab';
                tab.dataset.category = mainCategory;
                tab.textContent = mainCategory;
                tab.onclick = () => switchCategory(mainCategory);
                navTabs.appendChild(tab);
                
                if (index === 0) firstCategory = mainCategory;
            });
            
            // 첫 번째 카테고리 자동 로드
            if (firstCategory) {
                currentCategory = firstCategory;
                loadHairstylesFromHierarchy(firstCategory);
            }
        }

        // 🔄 기본 구조 사용 (fallback)
        function useDefaultStructure(gender) {
            const defaultStructure = {
                male: {
                    'SIDE_FRINGE': ['Fore Head', 'Eye Brow'],
                    'SIDE_PART': ['None', 'Fore Head', 'Eye Brow', 'Eye', 'Cheekbone'], 
                    'FRINGE_UP': ['None', 'Fore Head'],
                    'PUSHED_BACK': ['None'],
                    'BUZZ': ['None'],
                    'CROP': ['None'],
                    'MOHICAN': ['None']
                },
                female: {
                    'LONG': ['A Length', 'Fore Head', 'Eye Brow'],
                    'MEDIUM': ['None', 'Fore Head', 'Eye Brow'],
                    'SHORT': ['None', 'Fore Head']
                }
            };
            
            hierarchyStructure = defaultStructure;
            
            if (defaultStructure[gender]) {
                renderMainCategoryTabs(defaultStructure[gender]);
                updateSyncStatus('disconnected', '기본 구조 사용 중');
            } else {
                document.getElementById('navTabs').innerHTML = 
                    '<div style="color: #999; padding: 20px;">카테고리를 불러올 수 없습니다.</div>';
            }
        }

        // 🔄 카테고리 전환
        function switchCategory(categoryId) {
            if (categoryId === currentCategory) return;
            
            console.log(`🔄 카테고리 전환: ${categoryId}`);
            
            // 활성 탭 변경
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.category === categoryId) {
                    tab.classList.add('active');
                }
            });
            
            currentCategory = categoryId;
            loadHairstylesFromHierarchy(categoryId);
        }

        // 🎨 헤어스타일 로드 (다중 쿼리 방식)
        async function loadHairstylesFromHierarchy(mainCategory) {
            console.log(`=== 헤어스타일 로드: ${currentGender}, ${mainCategory} ===`);
            
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                if (!firebaseConnected) {
                    console.log('❌ Firebase 연결 없음, 테스트 데이터 사용');
                    renderTestData(mainCategory);
                    return;
                }

                // 🔍 다중 쿼리 시도 (어드민과 동일한 방식)
                let allStyles = {};
                let foundData = false;
                
                // 방법 1: mainCategory 필드로 직접 조회
                console.log('📊 방법 1: mainCategory 필드로 조회');
                try {
                    const stylesSnapshot = await db.collection('hairstyles')
                        .where('gender', '==', currentGender)
                        .where('mainCategory', '==', mainCategory)
                        .get();
                    
                    console.log(`📄 mainCategory 쿼리 결과: ${stylesSnapshot.size}개`);
                    
                    if (!stylesSnapshot.empty) {
                        // 중분류별로 그룹화
                        stylesSnapshot.forEach(doc => {
                            const style = doc.data();
                            const subCategory = style.subCategory || style.foreheadLength || 'None';
                            
                            if (!allStyles[subCategory]) {
                                allStyles[subCategory] = [];
                            }
                            allStyles[subCategory].push({
                                ...style,
                                id: doc.id
                            });
                        });
                        foundData = true;
                        console.log('✅ mainCategory 방식으로 데이터 로드 성공');
                    }
                } catch (error) {
                    console.log('⚠️ mainCategory 쿼리 실패:', error.message);
                }
                
                // 방법 2: categoryPath로 조회 (기존 방식)
                if (!foundData && hierarchyStructure[currentGender] && hierarchyStructure[currentGender][mainCategory]) {
                    console.log('📊 방법 2: categoryPath로 조회');
                    
                    const subCategories = hierarchyStructure[currentGender][mainCategory];
                    
                    for (const subCategory of subCategories) {
                        const categoryPath = `${currentGender}_${mainCategory}_${subCategory}`;
                        console.log(`🔍 categoryPath 조회: ${categoryPath}`);
                        
                        try {
                            const pathSnapshot = await db.collection('hairstyles')
                                .where('categoryPath', '==', categoryPath)
                                .get();
                            
                            if (!pathSnapshot.empty) {
                                allStyles[subCategory] = [];
                                pathSnapshot.forEach(doc => {
                                    const style = doc.data();
                                    allStyles[subCategory].push({
                                        ...style,
                                        id: doc.id
                                    });
                                });
                                foundData = true;
                            }
                        } catch (error) {
                            console.log(`⚠️ categoryPath 쿼리 실패 (${categoryPath}):`, error.message);
                        }
                    }
                    
                    if (foundData) {
                        console.log('✅ categoryPath 방식으로 데이터 로드 성공');
                    }
                }
                
                // 방법 3: 기존 방식 (foreheadLength 필드)
                if (!foundData) {
                    console.log('📊 방법 3: 기존 방식으로 조회');
                    
                    try {
                        const legacySnapshot = await db.collection('hairstyles')
                            .where('gender', '==', currentGender)
                            .get();
                        
                        console.log(`📄 기존 방식 쿼리 결과: ${legacySnapshot.size}개`);
                        
                        legacySnapshot.forEach(doc => {
                            const style = doc.data();
                            // 카테고리 매칭 로직 (기존 방식)
                            if (style.categoryId || style.foreheadLength) {
                                const subCategory = style.foreheadLength || 'None';
                                
                                if (!allStyles[subCategory]) {
                                    allStyles[subCategory] = [];
                                }
                                allStyles[subCategory].push({
                                    ...style,
                                    id: doc.id
                                });
                                foundData = true;
                            }
                        });
                        
                        if (foundData) {
                            console.log('✅ 기존 방식으로 데이터 로드 성공');
                        }
                    } catch (error) {
                        console.log('⚠️ 기존 방식 쿼리 실패:', error.message);
                    }
                }
                
                // 결과 렌더링
                if (foundData && Object.keys(allStyles).length > 0) {
                    console.log('🎨 스타일 데이터 렌더링:', allStyles);
                    renderCategory({
                        description: getMainCategoryDescription(mainCategory),
                        styles: allStyles
                    });
                    updateSyncStatus('connected', '스타일 로드 완료');
                } else {
                    console.log('❌ 모든 방법 실패, 테스트 데이터 사용');
                    renderTestData(mainCategory);
                    updateSyncStatus('disconnected', '테스트 데이터 사용');
                }
                
            } catch (error) {
                console.error('❌ 헤어스타일 로드 전체 오류:', error);
                renderTestData(mainCategory);
                updateSyncStatus('disconnected', '데이터 로드 실패');
            }
        }

        // 📝 대분류 설명 가져오기 (어드민과 동일)
        function getMainCategoryDescription(mainCategory) {
            const descriptions = {
                'SIDE_FRINGE': '사이드프린지는 살짝 볼륨이 있으면서 앞으로 떨어지는 스타일과 앞머리 숱을 줄여 소프트한 시스루 느낌을 다양하게 표현할 수 있습니다. M자 이마와 넓은 이마를 커버하면서 볼륨과 플랫, 웨이브와 스트레이트의 구성 요소를 디테일하게 표현하는 것이 스타일링의 핵심 포인트 입니다. 스타일을 강조하고 유지하기 위해서는 옆머리와 뒷머리를 다운펌을 통해 단정하게 정리하여 관리를 쉽도록 만드는 것을 추천 드립니다.',
                'SIDE_PART': '사이드 파트는 클래식함과 모던함의 대명사로 스타일링에 따라 원하는 이미지를 자유롭게 표현할 수 있습니다. 가르마를 기준으로 단순히 넘어 가는 스타일을 넘어 개인의 특성과 트렌드에 맞춰 고급한 헤드스스를 표현하는 것이 매우 중요합니다. 특히, 이마와 두상의 특징에 따라 포마드, 젤, 또는 왁스와 같은 제품을 사용하여 강조하고 보완하는 것이 스타일링 포인트입니다.',
                'FRINGE_UP': '프린지 업은 흔히 아이비리그 컷이라고 하여, 이마를 적극적으로 드러내어 남성적인 이미지를 어필하기 유리한 스타일입니다. 다운펌을 통해 뒷머리와 앞머리를 정리하는 것이 스타일링의 특성상 트렌드에 얽매이지 말고 나름의 포인트와 특색으로 관리를 주안점으로 받아진 스타일입니다. 헤어 스프레이와 왁스를 활용하여 간조하며 볼륨감을 강조하여 포인트를 유지 및 관리할 수 있습니다.',
                'PUSHED_BACK': '푸시드 백은 앞머리 부분의 볼륨감을 강조한 스타일로써, 뒷부분으로 넘기면서 뒤로 갈수록 볼륨이 적어지는 것이 특징인 스타일입니다. 모발의 길이가 중간 정도 이상인 분들에게 가장 적합하며, 진도작이고 성세한 길이 조절을 통해 본인의 헤어스타일를 분위기에서 인기가 늘으며, 스타일링이 쉽도록 가능하면 고급머리드라고 칭찬한 이미지를 유지하기 위해서는 선발과 이이와 참조하여 보편하는 것이 매우 중요합니다.',
                'BUZZ': '버즈컷은 흔히 반삭이라고하여 클리퍼의 길이와 헤어 스타일에 따라 다양한 스타일을 연출할 수 있습니다. 정교하고 섬세한 길이 조절이 가장 중요하지만 강함이 아닌 곡적이 주이 특성인 개성원 강점원 수 있습니다. 스타일링이라고 할게 없서 먼나기도 간단하고 포마드를 활용하여 색차하면 얹나와 장조정을 강점훨 수 있습니다.',
                'CROP': '크롭컷은 매우 짧은 라운드 형태로 깔끔하면서도 세련된 남성미를 강조한 스타일입니다. 영머리를 짧머리로 하여이스터간 다투어, 양쪽과 두상의 이미지를 두정하게 강조하여 모발의 길이와 절대에 따라 컬머의 이미지를 유지하기 위해서는 자숙적인 커트가 필요한 스타일힙니다. 점고 깔끔한 헤어스타일은 개인의 탸지잡 같은 역할으로 관리를 쉽도록 만느는 것을 추천합니다.',
                'MOHICAN': '모히칸은 옆머리를 짧게 하고 윗머리에 앞머리에서 뒷머리로 이어지는 라인을 표현하여, 둥근 얼굴형을 보완할 수 있는 개성이 남다른 스타일입니다.',
                'LONG': '롱 헤어는 여성스러움과 우아함을 동시에 표현할 수 있는 대표적인 스타일입니다.',
                'MEDIUM': '미디엄 헤어는 관리의 편의성과 스타일링의 다양성을 모두 갖춘 실용적인 길이입니다.',
                'SHORT': '숏 헤어는 세련되고 시크한 분위기를 연출하며, 얼굴형을 또렷하게 부각시키는 스타일입니다.'
            };
            
            return descriptions[mainCategory] || `${mainCategory} 스타일에 대한 설명입니다.`;
        }

        // 🧪 테스트 데이터 렌더링
        function renderTestData(mainCategory) {
            const subCategories = hierarchyStructure[currentGender]?.[mainCategory] || ['None'];
            
            const testStyles = {};
            subCategories.forEach(subCategory => {
                testStyles[subCategory] = [
                    { 
                        code: `${mainCategory.substring(0, 3)}${subCategory.substring(0, 1)}001`, 
                        name: `테스트 ${mainCategory} ${subCategory}`, 
                        imageUrl: "" 
                    }
                ];
            });
            
            renderCategory({
                description: getMainCategoryDescription(mainCategory),
                styles: testStyles
            });
        }

        // 🎨 카테고리 렌더링 (기존과 동일)
        function renderCategory(categoryData) {
            const content = document.getElementById('content');
            
            if (!categoryData || !categoryData.styles) {
                content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
                return;
            }

            // 중분류(앞머리 길이) 종류 추출
            const lengthTypes = Object.keys(categoryData.styles);
            const firstLengthType = lengthTypes[0] || 'None';

            let html = `
                <div class="category-section active">
                    <div class="category-description">${categoryData.description}</div>
                    
                    <!-- 앞머리 길이 탭 -->
                    <div class="length-tabs">
            `;

            // 앞머리 길이 탭 생성
            lengthTypes.forEach((lengthType, index) => {
                const isActive = index === 0 ? 'active' : '';
                html += `<div class="length-tab ${isActive}" data-length="${lengthType}" onclick="switchLengthTab('${lengthType}')">${lengthType}</div>`;
            });

            html += `</div>`;

            // 각 앞머리 길이별 섹션
            for (const [lengthType, styles] of Object.entries(categoryData.styles)) {
                const isActive = lengthType === firstLengthType ? 'active' : '';
                
                html += `
                    <div class="length-section ${isActive}" data-length="${lengthType}">
                `;

                if (!styles || styles.length === 0) {
                    html += `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <p>해당 앞머리 길이에 대한 스타일이 없습니다.</p>
                        </div>
                    `;
                } else {
                    html += `<div class="hairstyle-grid">`;
                    
                    styles.forEach(style => {
                        const imageUrl = style.imageUrl || `data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="267" viewBox="0 0 200 267"%3E%3Crect width="200" height="267" fill="%23222"%3E%3C/rect%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%23666" font-family="Arial" font-size="14"%3E이미지 준비중%3C/text%3E%3C/svg%3E`;
                        
                        html += `
                            <div class="hairstyle-card" onclick="openModal('${style.code}', '${style.name}', '${style.imageUrl || ''}')">
                                <img class="hairstyle-image" src="${imageUrl}" alt="${style.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"267\" viewBox=\"0 0 200 267\"%3E%3Crect width=\"200\" height=\"267\" fill=\"%23222\"%3E%3C/rect%3E%3Ctext x=\"50%25\" y=\"50%25\" dominant-baseline=\"middle\" text-anchor=\"middle\" fill=\"%23666\" font-family=\"Arial\" font-size=\"14\"%3E이미지 준비중%3C/text%3E%3C/svg%3E'">
                                <div class="hairstyle-info">
                                    <div class="hairstyle-code">${style.code}</div>
                                    <div class="hairstyle-name">${style.name}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }

                html += `</div>`;
            }

            html += '</div>';
            content.innerHTML = html;
        }

        // 앞머리 길이 탭 전환
        function switchLengthTab(lengthType) {
            // 활성 탭 변경
            document.querySelectorAll('.length-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.length === lengthType) {
                    tab.classList.add('active');
                }
            });

            // 활성 섹션 변경
            document.querySelectorAll('.length-section').forEach(section => {
                section.classList.remove('active');
                if (section.dataset.length === lengthType) {
                    section.classList.add('active');
                }
            });
        }

        // 모달 초기화
        function initializeModal() {
            const modal = document.getElementById('imageModal');
            const span = document.getElementsByClassName('close')[0];

            span.onclick = function() {
                modal.style.display = 'none';
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }

        // 모달 열기
        function openModal(code, name, imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCode = document.getElementById('modalCode');
            const modalName = document.getElementById('modalName');

            modalImage.src = imageUrl || `data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="267" viewBox="0 0 200 267"%3E%3Crect width="200" height="267" fill="%23222"%3E%3C/rect%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%23666" font-family="Arial" font-size="14"%3E이미지 준비중%3C/text%3E%3C/svg%3E`;
            modalCode.textContent = code;
            modalName.textContent = name;
            modal.style.display = 'block';
        }

        // 🚀 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeModal();
            console.log('🎉 어드민 동기화된 HAIRGATOR 메뉴판 로드 완료!');
            
            // 개발 도구에서 테스트할 수 있는 함수들 노출
            window.testFunctions = {
                loadMainCategoriesFromAdmin,
                loadHairstylesFromHierarchy,
                hierarchyStructure,
                currentGender,
                currentCategory
            };
        });
    </script>
</body>
</html>
