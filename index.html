<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>HAIRGATOR - Professional Hair Style Menu</title>

  <!-- ìºì‹œ íŒíŠ¸ (í—¤ë”ê°€ ë” ê°•ë ¥í•˜ì§€ë§Œ, HTML ë©”íƒ€ë„ ë³´ì¡°ì ìœ¼ë¡œ ë‘ ) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- ğŸ†• ì„±ëŠ¥ ìµœì í™” CSS (ë²„ì „ ë²„ìŠ¤íŠ¸) -->
  <link rel="stylesheet" href="/css/performance-optimization.css?v=20250815" />

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="HAIRGATOR" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="/manifest.json?v=20250815" />

  <!-- iOS Icons -->
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192.png" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />

  <!-- Google Fonts (preconnect ê¶Œì¥) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- ğŸ¯ GitHub-Netlify ì—…ë°ì´íŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ (ì›ë³¸ ìœ ì§€) -->
  <!-- (ë‹¹ì‹ ì´ ë³´ë‚¸ ìŠ¤í¬ë¦½íŠ¸ ê·¸ëŒ€ë¡œ ë‘ë˜, í•˜ë‹¨ SW ë¡œì§ê³¼ í•¨ê»˜ ë™ì‘í•©ë‹ˆë‹¤) -->
  <!-- ==== ìƒëµ: ê¸°ì¡´ ê¸´ UpdateChecker ìŠ¤í¬ë¦½íŠ¸ ê·¸ëŒ€ë¡œ ìœ ì§€ ==== -->

  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ + AI ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    :root {
      --primary-dark: #000000;
      --primary-light: #ffffff;
      --male-color: #4a90e2;
      --female-color: #e91e63;
      --text-primary: #ffffff;
      --text-secondary: #999999;
      --border-color: #222222;
    }
    body {
      font-family: "Noto Sans KR", -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, sans-serif;
      background: var(--primary-dark);
      color: var(--text-primary);
      overflow-x: hidden;
      user-select: none;
      -webkit-user-select: none;
    }
    .btn-ai-pink {
      background: transparent !important;
      color: #ff1493 !important;
      border: 2px solid #ff1493 !important;
      border-radius: 25px !important;
      padding: 12px 20px !important;
      flex: 1 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 8px !important;
      transition: all 0.3s ease !important;
      cursor: pointer !important;
      font-weight: 600 !important;
      font-size: 14px !important;
      min-width: 100px !important;
    }
    .btn-ai-pink:hover {
      background: rgba(255, 20, 147, 0.1) !important;
      transform: translateY(-2px) scale(1.02) !important;
      box-shadow: 0 4px 15px rgba(255, 20, 147, 0.3) !important;
    }
    .btn-ai-pink:active {
      transform: translateY(0) scale(0.98) !important;
    }
  </style>
</head>

<body>
  <!-- Loading -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <button class="back-btn" id="backBtn">â†</button>
    <div class="logo">HAIRGATOR</div>
    <button class="menu-btn" id="menuBtn">
      <span></span><span></span><span></span>
    </button>
  </header>

  <!-- ğŸ¨ ì—…ê·¸ë ˆì´ë“œëœ í…Œë§ˆ í† ê¸€ ë²„íŠ¼ -->
  <button class="theme-toggle-bottom" id="themeToggleBottom" title="ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ">
    <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
      <path
        d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
      />
    </svg>
    <svg
      class="sun-icon"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <circle cx="12" cy="12" r="5" />
      <line x1="12" y1="1" x2="12" y2="3" />
      <line x1="12" y1="21" x2="12" y2="23" />
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
      <line x1="1" y1="12" x2="3" y2="12" />
      <line x1="21" y1="12" x2="23" y2="12" />
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
    </svg>
  </button>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button class="sidebar-close" id="sidebarClose">Ã—</button>
      <h3>ì„¤ì •</h3>
    </div>
    <div class="sidebar-content">
      <div class="theme-toggle-wrapper">
        <button class="theme-toggle" id="themeToggle">
          <span>ë‹¤í¬ ëª¨ë“œ</span>
          <span id="themeStatus">ON</span>
        </button>
      </div>

      <!-- ì–¼êµ´ë¶„ì„ ë²„íŠ¼ -->
      <div
        style="
          margin: 20px 0;
          padding: 20px 0;
          border-top: 1px solid #333;
          border-bottom: 1px solid #333;
        "
      >
        <button
          onclick="window.open('https://hairgator-face.web.app/', '_blank')"
          style="
            width: 100%;
            padding: 15px;
            background: #2a2a2a;
            color: white;
            border: 1px solid #444;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          "
          onmouseover="this.style.background='#3a3a3a'; this.style.borderColor='#666'"
          onmouseout="this.style.background='#2a2a2a'; this.style.borderColor='#444'"
        >
          <span style="font-size: 20px">ğŸ‘¤</span>
          <span>ì–¼êµ´ë¶„ì„</span>
        </button>
        <p style="color: #666; font-size: 12px; margin-top: 10px; text-align: center">
          AIê°€ ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤
        </p>
      </div>

      <div id="designerInfo" style="display: none">
        <p style="color: #666; margin-bottom: 10px">
          ë¡œê·¸ì¸: <span id="designerName">Designer</span>
        </p>
        <button class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Gender Selection -->
    <div class="gender-selection" id="genderSelection">
      <button class="gender-btn male" data-gender="male">
        <div class="gender-icon">â™‚</div>
        <div class="gender-label">ë‚¨ì„±</div>
      </button>
      <button class="gender-btn female" data-gender="female">
        <div class="gender-icon">â™€</div>
        <div class="gender-label">ì—¬ì„±</div>
      </button>
    </div>

    <!-- Menu Container -->
    <div class="menu-container" id="menuContainer">
      <div class="category-tabs-wrapper">
        <div class="category-tabs" id="categoryTabs"></div>
      </div>
      <div class="category-description" id="categoryDescription"></div>
      <div class="subcategory-wrapper">
        <div class="subcategory-tabs" id="subcategoryTabs"></div>
      </div>
      <div class="menu-grid" id="menuGrid"></div>
    </div>
  </main>

  <!-- Style Modal -->
  <div class="style-modal" id="styleModal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose">Ã—</button>
      <img id="modalImage" src="" alt="" class="modal-image" />
      <div class="modal-info">
        <div class="modal-code" id="modalCode">CODE</div>
        <div class="modal-name" id="modalName">ìŠ¤íƒ€ì¼ëª…</div>
        <div class="modal-actions" id="modalActions">
          <button class="modal-btn btn-register" id="btnRegister">ê³ ê°ë“±ë¡</button>
          <button class="modal-btn btn-like" id="btnLike">
            <span>â™¡</span><span>ì¢‹ì•„ìš”</span>
          </button>
          <!-- âœ… AKOOL AI ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Scripts ë¡œë”© ìˆœì„œ -->
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- Firebase Config -->
  <script src="/js/firebase-config.js?v=20250815"></script>

  <!-- ğŸ”¥ AKOOL ë¨¼ì € ë¡œë“œ (ë²„ì „ ë²„ìŠ¤íŠ¸) -->
  <script src="/akool/js/akool-integration.js?v=20250815"></script>

  <!-- ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ -->
  <script src="/js/performance-optimization.js?v=20250815"></script>

  <!-- ì•± ë©”ì¸(ë‹¹ì‹ ì´ ë„£ì€ ìŠ¤í¬ë¦½íŠ¸ë“¤ í¬í•¨) -->
  <script>
    console.log("ğŸš€ HAIRGATOR ìµœì¢… ì™„ì„± ë²„ì „ ë¡œë”©...");

    // ... (ë‹¹ì‹ ì´ ì˜¬ë ¤ì¤€ ì•± ì´ˆê¸°í™”/ëª¨ë‹¬/ë©”ë‰´ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
    // showStyleDetail / addAKOOLButtonToModal ë“± ê¸°ì¡´ ì½”ë“œ ìœ ì§€
  </script>

  <!-- ğŸ§  ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ + ì¦‰ì‹œ ì—…ë°ì´íŠ¸/í† í°ì •ë¦¬ ì—°ë™ -->
  <script>
    (function () {
      const SW_URL = "/service-worker.js?v=20250815";
      let hasRefreshed = false;

      function sendSkipWaiting(reg) {
        if (reg && reg.waiting) {
          reg.waiting.postMessage({ type: "SKIP_WAITING" });
        }
      }

      function onNewServiceWorker(reg) {
        reg.addEventListener("updatefound", () => {
          const newWorker = reg.installing;
          if (!newWorker) return;
          newWorker.addEventListener("statechange", () => {
            if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
              // ìƒˆ ì›Œì»¤ê°€ ëŒ€ê¸°ì¤‘ â†’ ì¦‰ì‹œ í™œì„±í™” ìš”ì²­
              sendSkipWaiting(reg);
            }
          });
        });
      }

      // ìƒˆ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì¡íˆë©´(=ìƒˆ SW í™œì„±í™”) 1íšŒ ìë™ ìƒˆë¡œê³ ì¹¨
      navigator.serviceWorker && navigator.serviceWorker.addEventListener("controllerchange", () => {
        if (hasRefreshed) return;
        hasRefreshed = true;
        location.reload();
      });

      // SW ë©”ì‹œì§€ ìˆ˜ì‹ : APP_UPDATED â†’ ë¡œì»¬ í† í° ë“± ì •ë¦¬
      navigator.serviceWorker &&
        navigator.serviceWorker.addEventListener("message", (e) => {
          const msg = e.data || {};
          if (msg.type === "APP_UPDATED") {
            // ì œì•ˆëœ í‚¤ë“¤ ì •ë¦¬ (ì˜ˆ: akool_token)
            (msg.suggestClearKeys || []).forEach((k) => localStorage.removeItem(k));
            // í•„ìš” ì‹œ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ì„ ì›í•˜ë©´ ì•„ë˜ë¥¼ ì£¼ì„ í•´ì œ
            // location.reload();
          }
        });

      // ë“±ë¡
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register(SW_URL)
            .then((reg) => {
              console.log("[SW] registered:", reg.scope);
              onNewServiceWorker(reg);

              // ì´ë¯¸ waiting ì¤‘ì¸ SWê°€ ìˆë‹¤ë©´ ë°”ë¡œ skipWaiting
              if (reg.waiting) sendSkipWaiting(reg);

              // ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ì²´í¬
              setInterval(() => reg.update(), 5 * 60 * 1000);
            })
            .catch((err) => {
              console.warn("[SW] registration failed:", err);
            });
        });
      }
    })();
  </script>

  <!-- ğŸ”§ AKOOL ë¡œë”© í™•ì¸ ë° ì¬ì‹œë„ (ì›ë³¸ ìœ ì§€, ë²„ì „ ë²„ìŠ¤íŠ¸ë§Œ ë°˜ì˜) -->
  <script>
    setTimeout(() => {
      console.log("ğŸ” AKOOL ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸...");
      const akoolStatus = {
        integration: typeof window.addAIButtonToHairgator,
        modal: typeof window.openAkoolModal,
        token: typeof window.getAkoolToken,
        faceSwap: typeof window.akoolFaceSwap,
        config: window.akoolConfig ? "ë¡œë“œë¨" : "ì—†ìŒ",
      };
      console.log("ğŸ¤– AKOOL ìƒíƒœ:", akoolStatus);

      if (typeof window.openAkoolModal === "undefined") {
        console.log("âš ï¸ AKOOL ë©”ì¸ í•¨ìˆ˜ ë¯¸ë¡œë“œ, ì¬ë¡œë“œ ì‹œë„...");
        const script = document.createElement("script");
        script.src = "/akool/js/akool-integration.js?v=" + Date.now();
        script.onload = () => console.log("âœ… AKOOL ìŠ¤í¬ë¦½íŠ¸ ì¬ë¡œë“œ ì™„ë£Œ");
        script.onerror = () => console.error("âŒ AKOOL ìŠ¤í¬ë¦½íŠ¸ ì¬ë¡œë“œ ì‹¤íŒ¨");
        document.head.appendChild(script);
      } else {
        console.log("âœ… AKOOL ì™„ì „ ì‹œìŠ¤í…œ ì •ìƒ ë¡œë“œë¨!");
      }
    }, 3000);
  </script>

  <!-- íƒœë¸”ë¦¿/ì›¹ë·°/ê°€ì´ë“œ (ë²„ì „ ë²„ìŠ¤íŠ¸) -->
  <script src="/js/tablet-native-mode.js?v=20250815"></script>
  <script src="/js/webview-optimization.js?v=20250815"></script>
  <script src="/js/mobile-tablet-guide.js?v=20250815"></script>

  <script>
    window.addEventListener("load", function () {
      console.log("ğŸ‰ HAIRGATOR ì™„ì „ ì—…ê·¸ë ˆì´ë“œ ë²„ì „ ë¡œë“œ ì™„ë£Œ! ğŸš€");
    });
  </script>
</body>
</html>
