<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <title>HAIRGATOR - 헤어스타일 메뉴판</title>
    
    <!-- PWA 메타 태그 - 네이티브앱처럼 보이게 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HAIRGATOR">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    
    <!-- iOS 상태바 숨기기 + 전체화면 -->
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <!-- 주소창 숨기기 -->
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        /* 전체 요소 확대/축소 방지 */
        *, *::before, *::after {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation; /* 더블탭 줌 방지 */
        }
        
        /* 네이티브앱 느낌의 전체화면 */
        html {
            height: 100vh;
            overflow: hidden;
            -webkit-text-size-adjust: none; /* iOS 텍스트 크기 자동 조정 방지 */
            -ms-text-size-adjust: none;
            text-size-adjust: none;
        }

        /* iOS 상태바 영역 고려 */
        @supports (padding-top: env(safe-area-inset-top)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: auto;
            overflow-y: hidden;
            height: 100vh;
            position: relative;
            
            /* 네이티브앱처럼 보이게 하는 CSS */
            -webkit-touch-callout: none; /* iOS 링크 길게 누르기 방지 */
            -webkit-user-select: none; /* 텍스트 선택 방지 */
            -webkit-tap-highlight-color: transparent; /* 탭 하이라이트 제거 */
            -webkit-overflow-scrolling: touch; /* iOS 부드러운 스크롤 */
            
            /* 확대/축소 완전 방지 */
            touch-action: pan-x pan-y; /* 확대/축소 방지, 스크롤만 허용 */
            
            /* 새로고침 방지 */
            overscroll-behavior: none; /* 스크롤 바운스 방지 */
            -webkit-overscroll-behavior: none;
        }

        /* 강제 가로모드 - 개선된 버전 */
        @media screen and (orientation: portrait) {
            body {
                transform: rotate(90deg);
                transform-origin: left top;
                width: 100vh;
                height: 100vw;
                position: fixed;
                top: 100%;
                left: 0;
                overflow: hidden;
            }
            
            /* 세로 모드에서도 가로 모드 콘텐츠 보이게 */
            .gender-selection,
            .main-container {
                width: 100vh;
                height: 100vw;
            }
        }

        /* 가로 모드에서는 정상 표시 */
        @media screen and (orientation: landscape) {
            body {
                transform: none;
                width: 100vw;
                height: 100vh;
                position: relative;
                top: 0;
                left: 0;
            }
        }

        /* 성별 선택 화면 - 태블릿 최적화 */
        .gender-selection {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #000;
            gap: 40px;
        }

        .gender-selection.hidden {
            display: none;
        }

        .gender-card {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 40px;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
        }

        /* 태블릿에서 배경 투명하게 */
        @media screen and (min-width: 768px) {
            .gender-card {
                background-color: transparent;
                border: 2px solid rgba(255, 255, 255, 0.1);
            }
            
            .gender-card:hover {
                background-color: rgba(255, 255, 255, 0.05);
                border-color: #FF1493;
                box-shadow: 0 10px 40px rgba(255, 20, 147, 0.3);
            }
        }

        .gender-card:hover {
            transform: translateY(-10px);
            border-color: #FF1493;
            box-shadow: 0 10px 40px rgba(255, 20, 147, 0.3);
        }

        .gender-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            border-radius: 50%;
        }

        .gender-card.male .gender-icon {
            background: linear-gradient(135deg, #4169E1, #1E90FF);
        }

        .gender-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .gender-subtitle {
            color: #999;
            font-size: 14px;
        }

        /* 메인 컨테이너 */
        .main-container {
            display: none;
        }

        .main-container.active {
            display: block;
        }

        /* 헤더 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #000;
            z-index: 100;
            border-bottom: 1px solid #333;
        }

        .logo-section {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-img {
            height: 24px;
            width: auto;
            opacity: 0.9;
        }

        /* 뒤로가기 버튼 */
        .back-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .back-btn:hover {
            color: #FF1493;
        }

        /* AI 상담 버튼 */
        .ai-chat-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            padding: 0;
        }

        .ai-chat-btn:hover {
            transform: scale(1.1);
        }

        .ai-chat-btn:hover .face-scan-icon {
            filter: drop-shadow(0 0 10px rgba(255, 20, 147, 0.6));
        }

        .face-scan-icon {
            width: 100%;
            height: 100%;
            transition: all 0.3s ease;
        }

        /* 네비게이션 탭 */
        .nav-tabs {
            display: flex;
            background-color: #000;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 0 20px;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            white-space: nowrap;
            color: #888;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .nav-tab.active {
            color: #fff;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FF1493, #FF69B4);
        }

        .nav-tab:hover {
            color: #FF69B4;
        }

        /* 콘텐츠 영역 - 스와이프 새로고침 방지 */
        .content {
            margin-top: 100px;
            padding: 20px;
            min-height: calc(100vh - 100px);
            overflow-x: auto;
            overflow-y: auto;
            
            /* 스와이프 새로고침 완전 방지 */
            overscroll-behavior-y: none;
            -webkit-overscroll-behavior-y: none;
            touch-action: pan-x pan-y; /* 확대/축소 방지, 스크롤만 허용 */
        }

        .category-section {
            display: none;
        }

        .category-section.active {
            display: block;
        }

        .category-description {
            margin-bottom: 20px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            line-height: 1.6;
            color: #ccc;
        }

        /* 앞머리 길이 탭 (가운데 정렬) */
        .length-tabs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .length-tabs::-webkit-scrollbar {
            display: none;
        }

        .length-tab {
            padding: 10px 20px;
            cursor: pointer;
            white-space: nowrap;
            color: #888;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            font-size: 14px;
        }

        .length-tab.active {
            color: #fff;
            background-color: #FF1493;
        }

        .length-tab:hover {
            color: #fff;
            background-color: rgba(255, 20, 147, 0.7);
        }

        /* 헤어스타일 그리드 - 고정 크기 카드 + 확대방지 */
        .hairstyle-grid {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            padding-bottom: 10px;
            
            /* 확대/축소 방지 */
            touch-action: pan-x; /* 가로 스크롤만 허용 */
        }

        /* 스크롤바 스타일링 */
        .hairstyle-grid::-webkit-scrollbar {
            height: 6px;
        }

        .hairstyle-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .hairstyle-grid::-webkit-scrollbar-thumb {
            background: #FF1493;
            border-radius: 3px;
        }

        .hairstyle-grid::-webkit-scrollbar-thumb:hover {
            background: #FF69B4;
        }

        .hairstyle-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            width: 200px;
            flex-shrink: 0;
        }

        .hairstyle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.3);
        }

        /* 터치 디바이스 최적화 */
        @media (hover: none) {
            .hairstyle-card:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
        }

        .hairstyle-image {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            background-color: #222;
        }

        .hairstyle-info {
            padding: 15px;
            text-align: center;
        }

        .hairstyle-code {
            font-size: 12px;
            color: #FF69B4;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .hairstyle-name {
            font-size: 14px;
            color: #fff;
            font-weight: 500;
        }

        /* 앞머리 길이 섹션 */
        .length-section {
            display: none;
        }

        .length-section.active {
            display: block;
        }

        /* 이미지 모달 - 터치 최적화 + 핀치 줌 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            animation: fadeIn 0.3s ease;
            -webkit-overflow-scrolling: touch;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 95%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            padding: 10px;
        }

        .close:hover {
            color: #FF69B4;
        }

        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 10px;
            touch-action: pinch-zoom; /* 핀치 줌 허용 */
            user-select: none;
        }

        .modal-info {
            margin-top: 20px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 400px;
        }

        .modal-info h3 {
            color: #FF69B4;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .modal-info p {
            font-size: 18px;
            color: #fff;
        }

        /* 모바일 모달 최적화 */
        @media screen and (max-width: 600px) {
            .close {
                font-size: 35px;
                top: 5px;
                right: 15px;
                padding: 15px;
            }
            
            .modal-image {
                max-height: 60vh;
            }
            
            .modal-info {
                padding: 15px;
                margin-top: 15px;
            }
            
            .modal-info h3 {
                font-size: 20px;
            }
            
            .modal-info p {
                font-size: 16px;
            }
        }

        /* 로딩 스피너 */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #FF1493;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 동기화 상태 표시 */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 200;
            display: none;
            max-width: 300px;
            text-align: center;
        }

        .sync-status.connected {
            background-color: rgba(40, 167, 69, 0.9);
        }

        .sync-status.disconnected {
            background-color: rgba(220, 53, 69, 0.9);
        }

        .sync-status.updating {
            background-color: rgba(255, 193, 7, 0.9);
            color: #000;
        }

        /* 빈 상태 메시지 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: #999;
        }

        .empty-state-message {
            font-size: 14px;
            line-height: 1.5;
            color: #666;
        }

        /* 반응형 - 태블릿과 모바일 최적화 */
        @media screen and (max-width: 1200px) {
            .hairstyle-card {
                width: 180px;
            }
        }

        @media screen and (max-width: 900px) {
            .hairstyle-card {
                width: 160px;
            }
            
            .content {
                padding: 15px;
            }
        }

        @media screen and (max-width: 600px) {
            .hairstyle-card {
                width: 140px;
            }
            
            .content {
                padding: 10px;
            }
            
            .nav-tab {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .length-tab {
                padding: 8px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- 성별 선택 화면 -->
    <div class="gender-selection" id="genderSelection">
        <div class="gender-card male" onclick="selectGender('male')">
            <div class="gender-icon">♂</div>
            <div class="gender-title">남성</div>
            <div class="gender-subtitle">Men's Hairstyle</div>
        </div>
        
        <div class="gender-card female" onclick="selectGender('female')">
            <div class="gender-icon">♀</div>
            <div class="gender-title">여성</div>
            <div class="gender-subtitle">Women's Hairstyle</div>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="main-container" id="mainContainer">
        <!-- 헤더 -->
        <header class="header">
            <div class="logo-section">
                <button class="back-btn" onclick="backToGenderSelection()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>뒤로</span>
                </button>
                
                <div class="logo">
                    <span style="color: #FF1493; font-size: 18px; font-weight: 700; letter-spacing: -0.5px;">HAIRGATOR</span>
                </div>
                
                <button class="ai-chat-btn" onclick="window.open('https://hairgator-face.web.app', '_blank')" title="AI 얼굴 분석">
                    <svg class="face-scan-icon" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- 얼굴 윤곽 -->
                        <path d="M18 4 C10 4, 6 10, 6 18 C6 26, 10 32, 18 32 C26 32, 30 26, 30 18 C30 10, 26 4, 18 4" 
                              stroke="#FF1493" stroke-width="2" fill="none"/>
                        
                        <!-- 스캔 라인들 -->
                        <path d="M8 12h20M8 18h20M8 24h20" stroke="#FF69B4" stroke-width="1" opacity="0.5"/>
                        
                        <!-- 눈 -->
                        <circle cx="13" cy="15" r="1.5" fill="#FF1493"/>
                        <circle cx="23" cy="15" r="1.5" fill="#FF1493"/>
                        
                        <!-- 코 -->
                        <circle cx="18" cy="20" r="1" fill="#FF69B4"/>
                        
                        <!-- 입 -->
                        <path d="M14 24 Q18 26 22 24" stroke="#FF1493" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                        
                        <!-- 코너 브래킷 -->
                        <path d="M2 2h6v6M28 2h6v6M2 28v6h6M28 28v6h6" stroke="#FF1493" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
                    </svg>
                </button>
            </div>
            
            <!-- 네비게이션 탭 -->
            <nav class="nav-tabs" id="navTabs">
                <!-- 동적으로 생성됩니다 -->
            </nav>
        </header>

        <!-- 콘텐츠 영역 -->
        <main class="content" id="content">
            <!-- 카테고리별 섹션들이 동적으로 추가됩니다 -->
        </main>
    </div>

    <!-- 이미지 모달 -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img class="modal-image" id="modalImage" src="" alt="">
            <div class="modal-info">
                <h3 id="modalCode"></h3>
                <p id="modalName"></p>
            </div>
        </div>
    </div>

    <!-- 동기화 상태 표시 -->
    <div class="sync-status" id="syncStatus">Firebase 연결 중...</div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // 네이티브앱처럼 보이게 하는 JavaScript 추가
        
        // 화면 회전 감지 및 최적화
        function handleOrientationChange() {
            // 세로 모드에서 가로 모드로 콘텐츠 회전 시 최적화
            setTimeout(function() {
                window.scrollTo(0, 0);
                hideAddressBar();
            }, 100);
        }
        
        window.addEventListener('orientationchange', handleOrientationChange);
        window.addEventListener('resize', handleOrientationChange);
        
        // 확대/축소 완전 방지
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('gesturechange', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('gestureend', function(e) {
            e.preventDefault();
        });
        
        // 더블탭 줌 방지
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // 스와이프 새로고침 방지 (iOS Safari)
        let startY = 0;
        document.addEventListener('touchstart', function(e) {
            startY = e.touches[0].pageY;
        });
        
        document.addEventListener('touchmove', function(e) {
            const y = e.touches[0].pageY;
            // 페이지 최상단에서 아래로 스와이프할 때 새로고침 방지
            if (startY <= 10 && y > startY) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // iOS에서 주소창 숨기기
        function hideAddressBar() {
            if (window.innerHeight < screen.height) {
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 0);
            }
        }
        
        // 페이지 로드 시 주소창 숨기기
        window.addEventListener('load', hideAddressBar);
        window.addEventListener('orientationchange', hideAddressBar);
        
        console.log('🚀 HAIRGATOR 실시간 동기화 인덱스 시작');
        
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyBeTlHZwgx36hR-F35QPtGG2xvE5EY0XmY",
            authDomain: "hairgatormenu-4a43e.firebaseapp.com",
            projectId: "hairgatormenu-4a43e",
            storageBucket: "hairgatormenu-4a43e.firebasestorage.app",
            messagingSenderId: "800038006875",
            appId: "1:800038006875:web:2a4de70e3a306986e0cf7e"
        };

        // Firebase 초기화
        let db;
        let firebaseConnected = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseConnected = true;
            console.log('✅ Firebase 연결 성공');
            updateSyncStatus('connected', '✅ Firebase 연결됨');
        } catch (error) {
            console.error('❌ Firebase 초기화 오류:', error);
            updateSyncStatus('disconnected', '❌ Firebase 연결 실패');
            firebaseConnected = false;
        }

        // 전역 변수
        let currentGender = null;
        let currentCategory = null;
        let hierarchyStructure = {};

        // 동기화 상태 업데이트
        function updateSyncStatus(status, message) {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.className = `sync-status ${status}`;
            syncStatus.textContent = message;
            syncStatus.style.display = 'block';
            
            if (status !== 'connected') {
                setTimeout(() => {
                    syncStatus.style.display = 'none';
                }, 5000);
            }
        }

        // 성별 선택
        function selectGender(gender) {
            console.log(`🎯 성별 선택: ${gender}`);
            currentGender = gender;
            document.getElementById('genderSelection').classList.add('hidden');
            document.getElementById('mainContainer').classList.add('active');
            
            updateSyncStatus('updating', '📊 어드민 실시간 동기화 중...');
            loadHierarchyFromFirebaseOnly(gender);
        }

        // 성별 선택 화면으로 돌아가기
        function backToGenderSelection() {
            document.getElementById('genderSelection').classList.remove('hidden');
            document.getElementById('mainContainer').classList.remove('active');
            currentGender = null;
            currentCategory = null;
            hierarchyStructure = {};
        }

        // Firebase에서만 계층 구조 로드
        async function loadHierarchyFromFirebaseOnly(gender) {
            console.log(`=== 🔥 Firebase 실시간 동기화: ${gender} ===`);
            
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            if (!firebaseConnected) {
                console.log('❌ Firebase 연결 실패');
                showAdminInitializationRequired('Firebase 연결이 필요합니다. 페이지를 새로고침해주세요.');
                updateSyncStatus('disconnected', '❌ Firebase 연결 실패');
                return;
            }

            try {
                console.log('📊 어드민과 동일한 category_hierarchy 실시간 쿼리...');
                
                const hierarchySnapshot = await db.collection('category_hierarchy')
                    .where('gender', '==', gender)
                    .get();
                
                console.log(`📋 실시간 쿼리 결과: ${hierarchySnapshot.size}개 문서`);
                
                if (hierarchySnapshot.empty) {
                    console.log('⚠️ category_hierarchy가 비어있음 - 어드민 초기화 필요');
                    showAdminInitializationRequired('어드민에서 "Excel 데이터로 Firebase 초기화" 버튼을 먼저 클릭해주세요.');
                    updateSyncStatus('disconnected', '⚠️ 어드민 초기화 필요');
                    return;
                }
                
                // 어드민과 동일한 구조 생성
                const mainCategories = {};
                let lastUpdateTime = null;
                let totalDocs = 0;
                
                hierarchySnapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('📄 실시간 동기화된 문서:', data);
                    
                    const mainCat = data.mainCategory;
                    const subCat = data.subCategory;
                    
                    if (!mainCategories[mainCat]) {
                        mainCategories[mainCat] = [];
                    }
                    if (!mainCategories[mainCat].includes(subCat)) {
                        mainCategories[mainCat].push(subCat);
                    }
                    
                    if (data.updatedAt && (!lastUpdateTime || data.updatedAt.toDate() > lastUpdateTime)) {
                        lastUpdateTime = data.updatedAt.toDate();
                    }
                    
                    totalDocs++;
                });
                
                console.log('✅ 어드민과 100% 동일한 실시간 구조 생성:', mainCategories);
                
                hierarchyStructure[gender] = mainCategories;
                
                // 대분류 탭 렌더링
                renderMainCategoryTabs(Object.keys(mainCategories));
                
                // 첫 번째 카테고리 자동 로드
                const firstCategory = Object.keys(mainCategories)[0];
                if (firstCategory) {
                    currentCategory = firstCategory;
                    loadStylesFromHierarchyRealtime(firstCategory);
                }
                
                const timeStr = lastUpdateTime ? lastUpdateTime.toLocaleString('ko-KR') : '방금전';
                updateSyncStatus('connected', `✅ 실시간 동기화 완료 (${timeStr}) - ${totalDocs}개 문서`);
                
            } catch (error) {
                console.error('❌ 실시간 동기화 오류:', error);
                
                if (error.code === 'failed-precondition') {
                    showAdminInitializationRequired('Firebase 인덱스가 생성 중입니다. 잠시 후 다시 시도해주세요.');
                    updateSyncStatus('updating', '🔄 Firebase 인덱스 생성 중...');
                } else {
                    showAdminInitializationRequired(`실시간 동기화 실패: ${error.message}`);
                    updateSyncStatus('disconnected', '❌ 실시간 동기화 실패');
                }
            }
        }

        // 어드민 초기화 필요 메시지 표시
        function showAdminInitializationRequired(message) {
            const navTabs = document.getElementById('navTabs');
            const content = document.getElementById('content');
            
            navTabs.innerHTML = `
                <div style="color: #FF69B4; padding: 15px 25px; text-align: center; width: 100%;">
                    ⚠️ 어드민 초기화 필요
                </div>
            `;
            
            content.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">🔧</div>
                    <div class="empty-state-title">어드민 초기화가 필요합니다</div>
                    <div class="empty-state-message">
                        ${message}<br><br>
                        <strong>해결 방법:</strong><br>
                        1. 어드민 페이지로 이동<br>
                        2. "🚀 Excel 데이터로 Firebase 초기화" 버튼 클릭<br>
                        3. 이 페이지 새로고침
                    </div>
                </div>
            `;
        }

        // 대분류 탭 렌더링 (어드민 순서 고정)
        function renderMainCategoryTabs(mainCategories) {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '';
            
            if (!mainCategories || mainCategories.length === 0) {
                navTabs.innerHTML = '<div style="color: #666; padding: 20px;">카테고리를 불러올 수 없습니다.</div>';
                return;
            }
            
            // 고정된 순서 정의 (어드민과 동일)
            const categoryOrder = {
                male: ['SIDE FRINGE', 'SIDE PART', 'FRINGE UP', 'PUSHED BACK', 'BUZZ', 'CROP', 'MOHICAN'],
                female: ['LONG', 'SEMI LONG', 'MEDIUM', 'BOB', 'SHORT']
            };
            
            const orderedCategories = categoryOrder[currentGender] || mainCategories;
            
            orderedCategories.forEach((mainCategory, index) => {
                if (mainCategories.includes(mainCategory)) {
                    const tab = document.createElement('div');
                    tab.className = index === 0 ? 'nav-tab active' : 'nav-tab';
                    tab.dataset.category = mainCategory;
                    tab.textContent = mainCategory;
                    tab.onclick = () => switchCategory(mainCategory);
                    navTabs.appendChild(tab);
                }
            });
        }

        // 카테고리 전환
        function switchCategory(categoryId) {
            if (categoryId === currentCategory) return;
            
            console.log(`🔄 카테고리 전환: ${categoryId}`);
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.category === categoryId) {
                    tab.classList.add('active');
                }
            });
            
            currentCategory = categoryId;
            loadStylesFromHierarchyRealtime(categoryId);
        }

        // 헤어스타일 실시간 로드
        async function loadStylesFromHierarchyRealtime(mainCategory) {
            console.log(`=== 🎨 헤어스타일 실시간 로드: ${currentGender}, ${mainCategory} ===`);
            
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            if (!firebaseConnected) {
                console.log('❌ Firebase 연결 없음');
                showEmptyState('Firebase 연결이 필요합니다');
                updateSyncStatus('disconnected', '❌ Firebase 연결 필요');
                return;
            }

            try {
                const subCategories = hierarchyStructure[currentGender]?.[mainCategory] || [];
                console.log(`📂 실시간 중분류 목록: ${subCategories.join(', ')}`);
                
                if (subCategories.length === 0) {
                    console.log('⚠️ 중분류가 없음');
                    showEmptyState('중분류가 설정되지 않았습니다. 어드민에서 확인해주세요.');
                    updateSyncStatus('disconnected', '⚠️ 중분류 없음');
                    return;
                }

                let allStyles = {};
                let foundData = false;
                let totalStyles = 0;
                
                console.log('📊 실시간 스타일 데이터 로드 중...');
                
                for (const subCategory of subCategories) {
                    const categoryPath = `${currentGender}_${mainCategory}_${subCategory}`;
                    console.log(`🔍 실시간 categoryPath 조회: ${categoryPath}`);
                    
                    try {
                        const pathSnapshot = await db.collection('hairstyles')
                            .where('categoryPath', '==', categoryPath)
                            .get();
                        
                        if (!pathSnapshot.empty) {
                            allStyles[subCategory] = [];
                            pathSnapshot.forEach(doc => {
                                const style = doc.data();
                                allStyles[subCategory].push({
                                    ...style,
                                    id: doc.id
                                });
                                totalStyles++;
                            });
                            foundData = true;
                            console.log(`✅ ${subCategory}: ${pathSnapshot.size}개 스타일 발견`);
                        } else {
                            console.log(`📄 ${subCategory}: 스타일 없음`);
                        }
                    } catch (error) {
                        console.log(`⚠️ categoryPath 쿼리 실패 (${categoryPath}):`, error.message);
                    }
                }
                
                if (foundData && Object.keys(allStyles).length > 0) {
                    console.log('🎨 실시간 스타일 데이터 렌더링:', allStyles);
                    renderCategoryRealtime({
                        description: getMainCategoryDescription(mainCategory),
                        styles: allStyles
                    });
                    updateSyncStatus('connected', `✅ ${totalStyles}개 스타일 실시간 로드 완료`);
                } else {
                    console.log('📄 실시간 스타일 데이터 없음');
                    renderEmptyStylesRealtime(mainCategory, subCategories);
                    updateSyncStatus('connected', '📄 등록된 스타일이 없습니다 (실시간 확인 완료)');
                }
                
            } catch (error) {
                console.error('❌ 실시간 헤어스타일 로드 오류:', error);
                showEmptyState('실시간 스타일 데이터를 불러올 수 없습니다');
                updateSyncStatus('disconnected', '❌ 실시간 로드 실패: ' + error.message);
            }
        }

        // 대분류 설명 가져오기
        function getMainCategoryDescription(mainCategory) {
            const descriptions = {
                'SIDE FRINGE': '사이드프린지는 살짝 볼륨이 있으면서 앞으로 떨어지는 스타일과 앞머리 숱을 줄여 소프트한 시스루 느낌을 다양하게 표현할 수 있습니다. M자 이마와 넓은 이마를 커버하면서 볼륨과 플랫, 웨이브와 스트레이트의 구성 요소를 디테일하게 표현하는 것이 스타일링의 핵심 포인트입니다.',
                'SIDE PART': '사이드 파트는 클래식함과 모던함의 대명사로 스타일링에 따라 원하는 이미지를 자유롭게 표현할 수 있습니다. 가르마를 기준으로 단순히 넘어가는 스타일을 넘어 개인의 특성과 트렌드에 맞춰 고급한 헤어스타일을 표현하는 것이 매우 중요합니다.',
                'FRINGE UP': '프린지 업은 흔히 아이비리그 컷이라고 하여, 이마를 적극적으로 드러내어 남성적인 이미지를 어필하기 유리한 스타일입니다. 다운펌을 통해 뒷머리와 앞머리를 정리하는 것이 스타일링의 특성상 트렌드에 얽매이지 말고 나름의 포인트와 특색으로 관리하는 것이 중요합니다.',
                'PUSHED BACK': '푸시드 백은 앞머리 부분의 볼륨감을 강조한 스타일로써, 뒷부분으로 넘기면서 뒤로 갈수록 볼륨이 적어지는 것이 특징인 스타일입니다. 모발의 길이가 중간 정도 이상인 분들에게 가장 적합하며, 정교하고 섬세한 길이 조절을 통해 고급스러운 이미지를 유지할 수 있습니다.',
                'BUZZ': '버즈컷은 흔히 반삭이라고 하여 클리퍼의 길이와 헤어 스타일에 따라 다양한 스타일을 연출할 수 있습니다. 정교하고 섬세한 길이 조절이 가장 중요하지만 강함이 아닌 곡선미가 주는 특성인 개성을 강점으로 할 수 있습니다.',
                'CROP': '크롭컷은 매우 짧은 라운드 형태로 깔끔하면서도 세련된 남성미를 강조한 스타일입니다. 앞머리를 짧게 하여 깔끔한 인상을 주며, 양쪽과 뒷머리의 이미지를 단정하게 강조하여 모발의 길이와 절단에 따라 다양한 이미지를 연출할 수 있습니다.',
                'MOHICAN': '모히칸은 옆머리를 짧게 하고 윗머리에 앞머리에서 뒷머리로 이어지는 라인을 표현하여, 둥근 얼굴형을 보완할 수 있는 개성이 남다른 스타일입니다.',
                'LONG': '롱 헤어는 여성스러움과 우아함을 동시에 표현할 수 있는 대표적인 스타일입니다. 다양한 연출이 가능하며 개인의 취향에 따라 웨이브나 스트레이트 등으로 변화를 줄 수 있습니다.',
                'SEMI LONG': '세미 롱 헤어는 롱과 미디엄의 중간 길이로, 여성스러움을 유지하면서도 관리가 용이한 실용적인 스타일입니다.',
                'MEDIUM': '미디엄 헤어는 관리의 편의성과 스타일링의 다양성을 모두 갖춘 실용적인 길이입니다. 직장인부터 학생까지 다양한 연령대에 적합합니다.',
                'BOB': '밥 헤어는 턱선 근처의 깔끔한 라인이 특징으로, 모던하고 세련된 느낌을 연출할 수 있는 클래식한 스타일입니다.',
                'SHORT': '숏 헤어는 세련되고 시크한 분위기를 연출하며, 얼굴형을 또렷하게 부각시키는 스타일입니다. 관리가 쉽고 활동적인 이미지를 표현할 수 있습니다.'
            };
            
            return descriptions[mainCategory] || `${mainCategory} 스타일에 대한 설명입니다.`;
        }

        // 카테고리 실시간 렌더링
        function renderCategoryRealtime(categoryData) {
            const content = document.getElementById('content');
            
            if (!categoryData || !categoryData.styles) {
                showEmptyState('실시간 카테고리 데이터를 불러올 수 없습니다');
                return;
            }

            const lengthTypes = Object.keys(categoryData.styles);
            
            if (lengthTypes.length === 0) {
                showEmptyState('등록된 스타일이 없습니다 (실시간 확인 완료)');
                return;
            }
            
            let html = `
                <div class="category-section active">
                    <div class="category-description">${categoryData.description}</div>
                    
                    <div class="length-tabs">
            `;

            const orderedLengthTypes = hierarchyStructure[currentGender]?.[currentCategory] || lengthTypes;
            orderedLengthTypes.forEach((lengthType, index) => {
                if (lengthTypes.includes(lengthType)) {
                    const isActive = index === 0 ? 'active' : '';
                    html += `<div class="length-tab ${isActive}" data-length="${lengthType}" onclick="switchLengthTab('${lengthType}')">${lengthType}</div>`;
                }
            });

            html += `</div>`;

            const orderedLengthList = hierarchyStructure[currentGender]?.[currentCategory] || Object.keys(categoryData.styles);
            const primaryLengthType = orderedLengthList[0];
            
            for (const lengthType of orderedLengthList) {
                if (!categoryData.styles[lengthType]) continue;
                
                const styles = categoryData.styles[lengthType];
                const isActive = lengthType === primaryLengthType ? 'active' : '';
                
                html += `<div class="length-section ${isActive}" data-length="${lengthType}">`;

                if (!styles || styles.length === 0) {
                    html += `
                        <div class="empty-state">
                            <div class="empty-state-icon">✂️</div>
                            <div class="empty-state-title">${lengthType}</div>
                            <div class="empty-state-message">해당 앞머리 길이에 대한 스타일이 없습니다.<br>어드민에서 스타일을 추가해주세요.</div>
                        </div>
                    `;
                } else {
                    html += `<div class="hairstyle-grid">`;
                    
                    const sortedStyles = styles.sort((a, b) => {
                        const codeA = a.code || '';
                        const codeB = b.code || '';
                        return codeA.localeCompare(codeB);
                    });
                    
                    sortedStyles.forEach(style => {
                        const imageUrl = style.imageUrl || generatePlaceholderImage(style.name);
                        
                        html += `
                            <div class="hairstyle-card" onclick="openModal('${style.code || '코드없음'}', '${style.name || '이름없음'}', '${style.imageUrl || ''}')">
                                <img class="hairstyle-image" src="${imageUrl}" alt="${style.name || '이름없음'}" 
                                     onerror="this.src='${generatePlaceholderImage(style.name || '이름없음')}'">
                                <div class="hairstyle-info">
                                    <div class="hairstyle-code">${style.code || '코드없음'}</div>
                                    <div class="hairstyle-name">${style.name || '이름없음'}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }

                html += `</div>`;
            }

            html += '</div>';
            content.innerHTML = html;
        }

        // 빈 스타일 실시간 렌더링
        function renderEmptyStylesRealtime(mainCategory, subCategories) {
            const content = document.getElementById('content');
            
            let html = `
                <div class="category-section active">
                    <div class="category-description">${getMainCategoryDescription(mainCategory)}</div>
                    
                    <div class="length-tabs">
            `;

            const orderedSubCategories = hierarchyStructure[currentGender]?.[mainCategory] || subCategories;
            orderedSubCategories.forEach((subCategory, index) => {
                const isActive = index === 0 ? 'active' : '';
                html += `<div class="length-tab ${isActive}" data-length="${subCategory}" onclick="switchLengthTab('${subCategory}')">${subCategory}</div>`;
            });
            
            html += `</div>`;

            const orderedEmptyCategories = hierarchyStructure[currentGender]?.[mainCategory] || subCategories;
            orderedEmptyCategories.forEach((subCategory, index) => {
                const isActive = index === 0 ? 'active' : '';
                html += `
                    <div class="length-section ${isActive}" data-length="${subCategory}">
                        <div class="empty-state">
                            <div class="empty-state-icon">✂️</div>
                            <div class="empty-state-title">${subCategory}</div>
                            <div class="empty-state-message">등록된 스타일이 없습니다.<br>어드민에서 스타일을 추가해주세요.</div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            content.innerHTML = html;
        }

        // 빈 상태 표시
        function showEmptyState(message) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">⚠️</div>
                    <div class="empty-state-title">데이터가 없습니다</div>
                    <div class="empty-state-message">${message}</div>
                </div>
            `;
        }

        // 플레이스홀더 이미지 생성
        function generatePlaceholderImage(text) {
            const encodedText = encodeURIComponent(text || '이미지 준비중');
            return `data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="267" viewBox="0 0 200 267"%3E%3Crect width="200" height="267" fill="%23222"%3E%3C/rect%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%23666" font-family="Arial" font-size="12"%3E${encodedText}%3C/text%3E%3C/svg%3E`;
        }

        // 앞머리 길이 탭 전환
        function switchLengthTab(lengthType) {
            document.querySelectorAll('.length-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.length === lengthType) {
                    tab.classList.add('active');
                }
            });

            document.querySelectorAll('.length-section').forEach(section => {
                section.classList.remove('active');
                if (section.dataset.length === lengthType) {
                    section.classList.add('active');
                }
            });
        }

        // 모달 초기화
        function initializeModal() {
            const modal = document.getElementById('imageModal');
            const span = document.getElementsByClassName('close')[0];

            span.onclick = function() {
                modal.style.display = 'none';
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }

        // 모달 열기
        function openModal(code, name, imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCode = document.getElementById('modalCode');
            const modalName = document.getElementById('modalName');

            const finalImageUrl = imageUrl || generatePlaceholderImage(name);
            
            modalImage.src = finalImageUrl;
            modalCode.textContent = code;
            modalName.textContent = name;
            modal.style.display = 'block';
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeModal();
            console.log('🎉 HAIRGATOR 실시간 동기화 인덱스 로드 완료!');
            
            window.debugHairGator = {
                hierarchyStructure,
                currentGender,
                currentCategory,
                firebaseConnected,
                loadHierarchyFromFirebaseOnly,
                loadStylesFromHierarchyRealtime,
                testConnection: () => {
                    if (firebaseConnected) {
                        console.log('✅ Firebase 연결 상태 양호');
                        return true;
                    } else {
                        console.log('❌ Firebase 연결 실패');
                        return false;
                    }
                }
            };
        });
    </script>
</body>
</html>
