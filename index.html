<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>HAIRGATOR - Professional Hair Style Menu</title>

  <!-- ìºì‹œ ì–µì œ(í—¤ë”ê°€ ìš°ì„ ì´ì§€ë§Œ ë©”íƒ€ë„ ë³´ì¡°ì ìœ¼ë¡œ ë‘ ) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="/css/performance-optimization.css?v=20250815" />

  <!-- PWA -->
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="HAIRGATOR" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="/manifest.json?v=20250815" />

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    /* ê¸°ë³¸ í…Œë§ˆ (í•„ìš” ìµœì†Œí•œ ìœ ì§€) */
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    :root {
      --primary-dark:#000; --primary-light:#fff; --text-primary:#fff; --text-secondary:#999; --border-color:#222;
      --male-color:#4A90E2; --female-color:#E91E63;
    }
    body {
      font-family:'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background:var(--primary-dark); color:var(--text-primary); overflow-x:hidden; user-select:none; -webkit-user-select:none;
    }
    .btn-ai-pink{
      background:transparent!important;color:#FF1493!important;border:2px solid #FF1493!important;border-radius:25px!important;
      padding:12px 20px!important;flex:1!important;display:flex!important;align-items:center!important;justify-content:center!important;
      gap:8px!important;transition:all .3s ease!important;cursor:pointer!important;font-weight:600!important;font-size:14px!important;min-width:100px!important
    }
    .btn-ai-pink:hover{background:rgba(255,20,147,.1)!important;transform:translateY(-2px) scale(1.02)!important;box-shadow:0 4px 15px rgba(255,20,147,.3)!important}
    .header{background:#000;padding:15px 20px;display:flex;align-items:center;justify-content:center;position:relative;border-bottom:1px solid #333}
    .back-btn{position:absolute;left:20px;background:none;border:none;color:#fff;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:24px}
    .logo{color:#fff!important;font-size:24px;font-weight:bold;letter-spacing:3px;text-align:center}
    .menu-btn{background:none;border:none;width:40px;height:40px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px}
    .menu-btn span{width:24px;height:2px;background:#fff;border-radius:2px}
    .style-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);align-items:center;justify-content:center;z-index:1000}
    .style-modal.active{display:flex}
    .modal-content{background:#1a1a1a;border:1px solid #333;border-radius:16px;max-width:900px;width:92%;max-height:90vh;overflow:auto}
    .modal-image{width:100%;max-height:60vh;object-fit:cover;background:#222}
    .modal-info{padding:16px}
    .modal-actions{display:flex;gap:10px;margin-top:12px}
    .loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:2000}
    .loading-overlay.active{display:flex}
    .loading-spinner{width:40px;height:40px;border:4px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <!-- Loading -->
  <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div></div>

  <!-- Header -->
  <header class="header">
    <button class="back-btn" id="backBtn">â†</button>
    <div class="logo">HAIRGATOR</div>
    <button class="menu-btn" id="menuBtn"><span></span><span></span><span></span></button>
  </header>

  <!-- í•˜ë‹¨ í…Œë§ˆ í† ê¸€(ì•„ì´ì½˜ë§Œ ìœ ì§€) -->
  <button class="theme-toggle-bottom" id="themeToggleBottom" title="ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ" style="position:fixed;right:16px;bottom:16px;background:#111;border:1px solid #333;border-radius:999px;width:48px;height:48px;color:#fff;display:flex;align-items:center;justify-content:center;z-index:1000">â˜¾</button>

  <!-- Sidebar (ê°„ëµíˆ) -->
  <aside class="sidebar" id="sidebar" style="position:fixed;top:0;right:-100%;width:100%;height:100%;z-index:1000;transition:right .4s">
    <div class="sidebar-header" style="padding:16px;background:#000;border-bottom:1px solid #333;display:flex;align-items:center;justify-content:space-between">
      <h3 style="color:#fff;margin:0">ì„¤ì •</h3>
      <button class="sidebar-close" id="sidebarClose" style="background:none;border:none;color:#fff;font-size:28px;cursor:pointer">Ã—</button>
    </div>
    <div class="sidebar-content" style="padding:16px">
      <div class="theme-toggle-wrapper" style="margin-bottom:20px">
        <button class="theme-toggle" id="themeToggle" style="width:100%;padding:14px;background:#2a2a2a;color:#fff;border:1px solid #444;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:space-between">
          <span>ë‹¤í¬ ëª¨ë“œ</span><span id="themeStatus">ON</span>
        </button>
      </div>
      <div style="margin:20px 0;padding:20px 0;border-top:1px solid #333;border-bottom:1px solid #333;">
        <button onclick="window.open('https://hairgator-face.web.app/','_blank')"
          style="width:100%;padding:15px;background:#2a2a2a;color:#fff;border:1px solid #444;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;transition:.3s;display:flex;align-items:center;justify-content:center;gap:10px"
          onmouseover="this.style.background='#3a3a3a';this.style.borderColor='#666'"
          onmouseout="this.style.background='#2a2a2a';this.style.borderColor='#444'">
          <span style="font-size:20px">ğŸ‘¤</span><span>ì–¼êµ´ë¶„ì„</span>
        </button>
        <p style="color:#666;font-size:12px;margin-top:10px;text-align:center">AIê°€ ë‹¹ì‹ ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤</p>
      </div>
      <div id="designerInfo" style="display:none">
        <p style="color:#666;margin-bottom:10px">ë¡œê·¸ì¸: <span id="designerName">Designer</span></p>
        <button class="logout-btn" id="logoutBtn" style="width:100%;padding:12px;background:#FF1493;border:none;border-radius:10px;color:#fff;font-weight:700;cursor:pointer">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main-content" style="padding:16px">
    <div class="gender-selection" id="genderSelection" style="display:flex;gap:10px;justify-content:center;margin:24px 0">
      <button class="gender-btn male" data-gender="male" style="padding:16px 24px;border-radius:30px;border:2px solid #4A90E2;background:transparent;color:#4A90E2;font-weight:700;cursor:pointer">ë‚¨ì„±</button>
      <button class="gender-btn female" data-gender="female" style="padding:16px 24px;border-radius:30px;border:2px solid #FF1493;background:transparent;color:#FF1493;font-weight:700;cursor:pointer">ì—¬ì„±</button>
    </div>

    <div class="menu-container" id="menuContainer" style="max-width:1100px;margin:0 auto">
      <div class="category-tabs-wrapper" style="overflow:auto;white-space:nowrap;padding-bottom:8px;margin-bottom:12px;border-bottom:1px solid #222">
        <div class="category-tabs" id="categoryTabs" style="display:inline-flex;gap:8px"></div>
      </div>
      <div class="category-description" id="categoryDescription" style="color:#aaa;margin:8px 0 16px"></div>
      <div class="subcategory-wrapper" style="margin-bottom:12px">
        <div class="subcategory-tabs" id="subcategoryTabs" style="display:flex;gap:8px;flex-wrap:wrap"></div>
      </div>
      <div class="menu-grid" id="menuGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px"></div>
    </div>
  </main>

  <!-- Style Modal -->
  <div class="style-modal" id="styleModal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose" style="position:absolute;top:8px;right:10px;background:none;border:none;color:#fff;font-size:28px;cursor:pointer">Ã—</button>
      <img id="modalImage" src="" alt="" class="modal-image" />
      <div class="modal-info">
        <div class="modal-code" id="modalCode" style="font-size:12px;color:#999">CODE</div>
        <div class="modal-name" id="modalName" style="font-size:18px;font-weight:700;margin-top:4px">ìŠ¤íƒ€ì¼ëª…</div>
        <div class="modal-actions" id="modalActions" style="margin-top:10px">
          <button class="modal-btn btn-register" id="btnRegister" style="background:#444;color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer">ê³ ê°ë“±ë¡</button>
          <button class="modal-btn btn-like" id="btnLike" style="background:#222;color:#fff;border:1px solid #444;padding:10px 16px;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:6px"><span>â™¡</span><span>ì¢‹ì•„ìš”</span></button>
          <!-- âœ… AKOOL AI ë²„íŠ¼ì€ JSë¡œ ì£¼ì… -->
        </div>
      </div>
    </div>
  </div>

  <!-- ================= Scripts ìˆœì„œ ================= -->

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- Firebase Config -->
  <script src="/js/firebase-config.js?v=20250815"></script>

  <!-- ğŸ”¥ AKOOL (ì‹¤ì œ í”Œë¡œìš°) -->
  <script src="/akool/js/akool-integration.js?v=20250815"></script>
  <!-- (ì£¼ì˜) ë ˆê±°ì‹œ/ì‹œë®¬ íŒŒì¼ì€ ì‚¬ìš© ê¸ˆì§€: ì•„ë˜ëŠ” ë‚¨ê²¨ë‘ë”ë¼ë„ ì£¼ì„ ìœ ì§€
  <script src="/akool/js/akool-api.js?v=20250815"></script>
  <script src="/akool/js/akool-token.js?v=20250815"></script>
  <script src="/akool/js/akool-status.js?v=20250815"></script>
  <script src="/akool/js/akool-faceswap.js?v=20250815"></script>
  -->

  <!-- ğŸ§¯ ë³´ê°•ìš©: í˜¹ì‹œ ì´í›„ ë¡œë“œëœ ë ˆê±°ì‹œê°€ ë²„íŠ¼ì„ ì£¼ì…í•´ë„ ì¦‰ì‹œ ì°¨ë‹¨ -->
  <script>
    (function(){
      try{
        const desc = Object.getOwnPropertyDescriptor(window, 'addAIButtonToHairgator');
        if (!desc || desc.configurable) {
          Object.defineProperty(window, 'addAIButtonToHairgator', {
            configurable: false,
            writable: false,
            value: function(){ console.info('â„¹ï¸ ë ˆê±°ì‹œ addAIButtonToHairgator ì°¨ë‹¨'); return false; }
          });
        }
        const KILL_SELECTORS = ['#akoolSimBtn', '.akool-sim-btn', '[data-sim-akool]', '#hairgator-ai-sim'];
        const kill = () => KILL_SELECTORS.forEach(s => document.querySelectorAll(s).forEach(n => n.remove()));
        kill();
        new MutationObserver(kill).observe(document.documentElement, { childList:true, subtree:true });
      }catch(e){ console.warn('ë ˆê±°ì‹œ ì°¨ë‹¨ ë³´ê°• ì‹¤íŒ¨(ë¬´ì‹œ ê°€ëŠ¥):', e); }
    })();
  </script>

  <!-- ì„±ëŠ¥ ìµœì í™”/ê°€ì´ë“œ -->
  <script src="/js/performance-optimization.js?v=20250815"></script>
  <script src="/js/tablet-native-mode.js?v=20250815"></script>
  <script src="/js/webview-optimization.js?v=20250815"></script>
  <script src="/js/mobile-tablet-guide.js?v=20250815"></script>

  <!-- ì•± ë©”ì¸ ë¡œì§ (ë©”ë‰´/ëª¨ë‹¬/ì´ë²¤íŠ¸ ë“± ê¸°ì¡´ ì½”ë“œê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì—) -->
  <script>
    console.log('ğŸš€ HAIRGATOR ì•± ì´ˆê¸°í™”');

    // ì „ì—­ ìƒíƒœ
    window.currentGender = null;
    window.currentCategory = null;
    window.currentSubcategory = 'None';
    window.menuData = {};

    const backBtn = document.getElementById('backBtn');
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarClose = document.getElementById('sidebarClose');
    const themeToggle = document.getElementById('themeToggle');
    const themeToggleBottom = document.getElementById('themeToggleBottom');
    const themeStatus = document.getElementById('themeStatus');
    const logoutBtn = document.getElementById('logoutBtn');
    const genderSelection = document.getElementById('genderSelection');
    const categoryTabs = document.getElementById('categoryTabs');
    const categoryDescription = document.getElementById('categoryDescription');
    const subcategoryTabs = document.getElementById('subcategoryTabs');
    const menuGrid = document.getElementById('menuGrid');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const styleModal = document.getElementById('styleModal');
    const modalClose = document.getElementById('modalClose');
    const modalImage = document.getElementById('modalImage');
    const modalCode = document.getElementById('modalCode');
    const modalName = document.getElementById('modalName');

    document.addEventListener('DOMContentLoaded', () => {
      init();
    });

    function init() {
      setupEventListeners();
      loadTheme();
      if (backBtn) backBtn.style.display = 'none';
      console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
    }

    function setupEventListeners() {
      backBtn?.addEventListener('click', () => history.back());
      menuBtn?.addEventListener('click', () => sidebar.style.right = '0');
      sidebarClose?.addEventListener('click', () => sidebar.style.right = '-100%');
      themeToggle?.addEventListener('click', toggleTheme);
      themeToggleBottom?.addEventListener('click', toggleTheme);
      logoutBtn?.addEventListener('click', () => { /* TODO: ë¡œê·¸ì•„ì›ƒ ë¡œì§ */ });

      // ì„±ë³„ ì„ íƒ(ìœ„ì„)
      document.addEventListener('click', (e) => {
        const btn = e.target.closest('.gender-btn');
        if (!btn) return;
        const gender = btn.dataset.gender;
        selectGender(gender);
      });

      // ëª¨ë‹¬ ë‹«ê¸°
      modalClose?.addEventListener('click', closeModal);
      styleModal?.addEventListener('click', (e) => { if (e.target === styleModal) closeModal(); });

      // ESCë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && styleModal.classList.contains('active')) closeModal();
      });

      // ì‚¬ì´ë“œë°” ë°”ê¹¥ í´ë¦­ì‹œ ë‹«ê¸°
      document.addEventListener('click', (e) => {
        if (sidebar.style.right === '0' && !sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
          sidebar.style.right = '-100%';
        }
      });
    }

    function toggleTheme(){
      const isLight = document.body.classList.toggle('light-theme');
      themeStatus && (themeStatus.textContent = isLight ? 'OFF' : 'ON');
    }
    function loadTheme(){ /* í•„ìš” ì‹œ í…Œë§ˆ ì´ˆê¸°í™” */ }
    function selectGender(g){ window.currentGender = g; /* TODO: ë©”ë‰´ ë Œë”ë§ */ }
    function closeModal(){
      styleModal?.classList.remove('active');
      // AKOOL ëª¨ë‹¬ë„ ì—´ë ¤ìˆë‹¤ë©´ ë‹«ê¸°
      if (typeof window.closeAkoolModal === 'function') window.closeAkoolModal();
      // ë‚¨ì•„ìˆëŠ” AI ë²„íŠ¼ ì²­ì†Œ
      const ak = document.getElementById('akoolAIBtn'); if (ak) ak.remove();
    }

    // ğŸ” ìŠ¤íƒ€ì¼ ìƒì„¸ ì—´ê¸° (AIë²„íŠ¼ ì£¼ì… ìœ„ì¹˜)
    window.showStyleDetail = function(code, name, gender, imageSrc, docId){
      console.log('ğŸ¨ ìŠ¤íƒ€ì¼ ëª¨ë‹¬:', {code, name, gender, imageSrc, docId});
      modalImage.src = imageSrc || '';
      modalCode.textContent = code || 'NO CODE';
      modalName.textContent = name || 'ì´ë¦„ ì—†ìŒ';
      styleModal.classList.add('active');

      // âœ… AI ì²´í—˜ ë²„íŠ¼ì€ í•­ìƒ ì‹¤ì œ AKOOL í”Œë¡œìš°ë§Œ í˜¸ì¶œí•˜ê²Œ ê°•ì œ
      addAKOOLButtonToModal(code, name, imageSrc, gender);
    };

    function addAKOOLButtonToModal(code, name, imageSrc, gender){
      const actions = document.getElementById('modalActions');
      if (!actions) return;
      const old = actions.querySelector('#akoolAIBtn'); if (old) old.remove();

      const btn = document.createElement('button');
      btn.id = 'akoolAIBtn';
      btn.className = 'modal-btn btn-ai-pink';
      btn.innerHTML = `
        <svg viewBox="0 0 60 60" width="18" height="18" style="margin-right:6px">
          <path d="M30 5 C40 5, 50 15, 50 25 C50 35, 45 45, 40 50 C35 55, 25 55, 20 50 C15 45, 10 35, 10 25 C10 15, 20 5, 30 5 Z"
                fill="none" stroke="#FF1493" stroke-width="2"></path>
          <circle cx="22" cy="22" r="2" fill="#FF1493"></circle>
          <circle cx="38" cy="22" r="2" fill="#FF1493"></circle>
        </svg>
        <span>AI ì²´í—˜</span>
      `;
      btn.onclick = () => {
        if (typeof window.openAkoolFaceSwapModal === 'function') {
          window.openAkoolFaceSwapModal({
            imageUrl: imageSrc,
            styleName: name,
            styleCode: code,
            gender
          });
        } else {
          // ì•„ì§ ë¡œë“œ ì „ì´ë©´ ì¬ë¡œë”© í›„ ì¦‰ì‹œ ì¬ì‹œë„
          const s = document.createElement('script');
          s.src = '/akool/js/akool-integration.js?v=' + Date.now();
          s.onload = () => (typeof window.openAkoolFaceSwapModal === 'function') && btn.click();
          document.head.appendChild(s);
        }
      };
      actions.appendChild(btn);
    }

    // ğŸ§¯ êµ¬ë²„ì „ ê²½ë¡œ(ì‹œë®¬ë ˆì´ì…˜)ë¡œ ë¹ ì§€ì§€ ì•Šê²Œ ë°©ì§€ìš© ë¦¬ë‹¤ì´ë ‰íŠ¸
    window.openAkoolModal = function(){
      const code = document.querySelector('#modalCode')?.textContent || '';
      const name = document.querySelector('#modalName')?.textContent || '';
      const imageUrl = document.querySelector('#modalImage')?.src || '';
      if (typeof window.openAkoolFaceSwapModal === 'function') {
        return window.openAkoolFaceSwapModal({ imageUrl, styleName:name, styleCode:code });
      }
      const s = document.createElement('script');
      s.src = '/akool/js/akool-integration.js?v=' + Date.now();
      s.onload = () => (typeof window.openAkoolFaceSwapModal === 'function') && window.openAkoolModal();
      document.head.appendChild(s);
    };

    // ë¡œë”© í‘œì‹œ
    function showLoading(show){ loadingOverlay?.classList.toggle('active', !!show); }
  </script>

  <!-- ğŸ§  ì„œë¹„ìŠ¤ì›Œì»¤: ì¦‰ì‹œ ì—…ë°ì´íŠ¸ + í† í° ì •ë¦¬ ì—°ë™ -->
  <script>
    (function(){
      const SW_URL = '/service-worker.js?v=20250815';
      let hasRefreshed = false;

      function sendSkipWaiting(reg){ reg?.waiting?.postMessage({ type:'SKIP_WAITING' }); }
      function onNewServiceWorker(reg){
        reg.addEventListener('updatefound', () => {
          const nw = reg.installing;
          nw && nw.addEventListener('statechange', () => {
            if (nw.state === 'installed' && navigator.serviceWorker.controller) sendSkipWaiting(reg);
          });
        });
      }
      navigator.serviceWorker && navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (hasRefreshed) return; hasRefreshed = true; location.reload();
      });
      navigator.serviceWorker && navigator.serviceWorker.addEventListener('message', (e) => {
        const msg = e.data || {};
        if (msg.type === 'APP_UPDATED') {
          (msg.suggestClearKeys || ['akool_token','akool_token_issued']).forEach(k => localStorage.removeItem(k));
          // í•„ìš” ì‹œ ì¦‰ì‹œ ë¦¬ë¡œë“œ: location.reload();
        }
      });
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register(SW_URL).then(reg => {
            console.log('[SW] registered:', reg.scope);
            onNewServiceWorker(reg);
            if (reg.waiting) sendSkipWaiting(reg);
            setInterval(() => reg.update(), 5*60*1000);
          }).catch(err => console.warn('[SW] registration failed:', err));
        });
      }
    })();
  </script>

  <script>
    window.addEventListener('load', () => {
      console.log('ğŸ‰ HAIRGATOR ìµœì¢… ë²„ì „ ë¡œë“œ ì™„ë£Œ! ğŸš€');
    });
  </script>
</body>
</html>
