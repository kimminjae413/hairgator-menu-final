<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAIRGATOR - ì–´ë“œë¯¼ (ì™„ì „ ìˆ˜ì • ë²„ì „)</title>
    
    <!-- Service Worker ë“±ë¡ ë°©ì§€ -->
    <script>
        // Service Worker ê´€ë ¨ ì˜¤ë¥˜ ë°©ì§€
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        
        console.log('ğŸ”§ Service Worker ì˜¤ë¥˜ ë°©ì§€ ì½”ë“œ ì‹¤í–‰ë¨');
    </script>
    
    <!-- Firebase ì„¤ì •ì„ ì „ì—­ìœ¼ë¡œ ì„ ì–¸ -->
    <script>
        // Firebase ì„¤ì •ì„ ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
        window.firebaseConfig = {
            apiKey: "AIzaSyBeTlHZwgx36hR-F35QPtGG2xvE5EY0XmY",
            authDomain: "hairgatormenu-4a43e.firebaseapp.com",
            projectId: "hairgatormenu-4a43e",
            storageBucket: "hairgatormenu-4a43e.firebasestorage.app",
            messagingSenderId: "800038006875",
            appId: "1:800038006875:web:2a4de70e3a306986e0cf7e"
        };
    </script>
    
    <!-- ì™¸ë¶€ CSS íŒŒì¼ -->
    <link rel="stylesheet" href="css/admin-styles.css">
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="logo">HAIRGATOR ì–´ë“œë¯¼ (ì™„ì „ ìˆ˜ì • ë²„ì „)</div>
        </div>

        <!-- ì•Œë¦¼ -->
        <div id="alert" class="alert"></div>

        <!-- ë™ê¸°í™” ìƒíƒœ -->
        <div id="syncIndicator" class="sync-indicator disconnected">Firebase ì—°ê²° ì¤‘...</div>

        <!-- ì´ˆê¸°í™” ì¹´ë“œ -->
        <div class="card">
            <h2 class="card-title">ğŸš€ ì‹œìŠ¤í…œ ì´ˆê¸°í™”</h2>
            <p style="margin-bottom: 20px; color: #666;">
                Excel ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Firebaseì— ì¹´í…Œê³ ë¦¬ êµ¬ì¡°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.<br>
                <strong>ì£¼ì˜:</strong> ê¸°ì¡´ category_hierarchy ë°ì´í„°ëŠ” ì‚­ì œë˜ì§€ë§Œ, hairstyles(ìŠ¤íƒ€ì¼) ë°ì´í„°ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤.
            </p>
            
            <div style="text-align: center;">
                <button class="btn btn-warning" onclick="initializeFirebaseWithExcelData()">
                    ğŸš€ ì´ˆê¸°í™” ì‹¤í–‰
                </button>
                <button class="btn btn-secondary" onclick="checkCurrentStructure()">
                    ğŸ“Š í˜„ì¬ êµ¬ì¡° í™•ì¸
                </button>
                <button class="btn btn-info" onclick="testConnection()">
                    ğŸŒ ì—°ê²° í…ŒìŠ¤íŠ¸
                </button>
            </div>

            <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
            <div id="initProgress" class="progress-container" style="display: none;">
                <div style="font-weight: bold; margin-bottom: 10px;">ğŸ“‹ ì´ˆê¸°í™” ì§„í–‰ ìƒí™©:</div>
                <div id="progressLog"></div>
            </div>
        </div>

        <!-- ê³ ê° ë°ì´í„° ê´€ë¦¬ ì¹´ë“œ -->
        <div class="card">
            <h2 class="card-title">ğŸ‘¥ ê³ ê° ë°ì´í„° ê´€ë¦¬</h2>
            <p style="margin-bottom: 20px; color: #666;">
                ì¸ë±ìŠ¤ì—ì„œ ì…ë ¥ëœ ë””ìì´ë„ˆë³„ ê³ ê° ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadCustomerData()">
                    ğŸ‘¥ ê³ ê° ë°ì´í„° ì¡°íšŒ
                </button>
                <button class="btn btn-secondary" onclick="loadDesignerData()">
                    ğŸ¨ ë””ìì´ë„ˆ ëª©ë¡ ì¡°íšŒ
                </button>
                <button class="btn btn-warning" onclick="exportCustomerData()">
                    ğŸ“¤ ê³ ê° ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                </button>
                <button class="btn btn-danger" onclick="clearAllCustomerData()">
                    ğŸ—‘ï¸ ëª¨ë“  ê³ ê° ë°ì´í„° ì‚­ì œ
                </button>
            </div>

            <!-- ê³ ê° ë°ì´í„° í‘œì‹œ ì˜ì—­ -->
            <div id="customerDataContainer" style="display: none;">
                <div class="customer-stats" id="customerStats"></div>
                <div class="customer-list" id="customerList"></div>
            </div>
        </div>

        <!-- ê³„ì¸µí˜• ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì¹´ë“œ -->
        <div class="card">
            <h2 class="card-title">ğŸ—ï¸ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
            
            <!-- í˜„ì¬ ê²½ë¡œ -->
            <div class="breadcrumb" id="breadcrumb">
                <span class="breadcrumb-item">ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”</span>
            </div>

            <!-- ê³„ì¸µ êµ¬ì¡° ê·¸ë¦¬ë“œ -->
            <div class="hierarchy-grid">
                <!-- 1ë‹¨ê³„: ì„±ë³„ -->
                <div class="hierarchy-column">
                    <div class="hierarchy-title">1. ì„±ë³„</div>
                    <div id="genderList">
                        <div class="selectable-item" onclick="selectGender('male')">
                            <span class="item-text">ğŸ‘¨ ë‚¨ì„±</span>
                        </div>
                        <div class="selectable-item" onclick="selectGender('female')">
                            <span class="item-text">ğŸ‘© ì—¬ì„±</span>
                        </div>
                    </div>
                </div>

                <!-- 2ë‹¨ê³„: ëŒ€ë¶„ë¥˜ -->
                <div class="hierarchy-column">
                    <div class="hierarchy-title">2. ëŒ€ë¶„ë¥˜</div>
                    <div id="mainCategoryList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“</div>
                            <div>ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary btn-sm" onclick="showAddCategoryModal('main')" disabled id="addMainCategoryBtn">
                            â• ëŒ€ë¶„ë¥˜ ì¶”ê°€
                        </button>
                    </div>
                </div>

                <!-- 3ë‹¨ê³„: ì¤‘ë¶„ë¥˜ -->
                <div class="hierarchy-column">
                    <div class="hierarchy-title">3. ì¤‘ë¶„ë¥˜</div>
                    <div id="subCategoryList">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“‚</div>
                            <div>ëŒ€ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary btn-sm" onclick="showAddCategoryModal('sub')" disabled id="addSubCategoryBtn">
                            â• ì¤‘ë¶„ë¥˜ ì¶”ê°€
                        </button>
                    </div>
                </div>

                <!-- 4ë‹¨ê³„: ìŠ¤íƒ€ì¼ -->
                <div class="hierarchy-column">
                    <div class="hierarchy-title">4. ìŠ¤íƒ€ì¼</div>
                    <div id="stylesList">
                        <div class="empty-state">
                            <div class="empty-state-icon">âœ‚ï¸</div>
                            <div>ì¤‘ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary btn-sm" onclick="showAddStyleModal()" disabled id="addStyleBtn">
                            â• ìŠ¤íƒ€ì¼ ì¶”ê°€
                        </button>
                    </div>
                </div>
            </div>

            <!-- ê´€ë¦¬ ë²„íŠ¼ë“¤ -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="refreshUI()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                <button class="btn btn-success" onclick="syncToIndex()">ğŸ“¤ ì¸ë±ìŠ¤ì— ë°˜ì˜</button>
            </div>
        </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="categoryModalTitle">ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
                <button class="close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <form id="categoryForm">
                <div class="form-group">
                    <label class="form-label">ì¹´í…Œê³ ë¦¬ëª… *</label>
                    <input type="text" id="categoryName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ì„¤ëª…</label>
                    <textarea id="categoryDescription" class="form-control" rows="3"></textarea>
                </div>
                <div style="text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ìŠ¤íƒ€ì¼ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="styleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="styleModalTitle">ìŠ¤íƒ€ì¼ ì¶”ê°€</h3>
                <button class="close" onclick="closeStyleModal()">&times;</button>
            </div>
            <form id="styleForm">
                <div class="form-group">
                    <label class="form-label">ìŠ¤íƒ€ì¼ ì½”ë“œ *</label>
                    <input type="text" id="styleCode" class="form-control" placeholder="ì˜ˆ: MSF1001" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ìŠ¤íƒ€ì¼ëª… *</label>
                    <input type="text" id="styleName" class="form-control" placeholder="ì˜ˆ: ìŠ¬ë¦­ ë‹¤ìš´íŒ" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ìŠ¤íƒ€ì¼ ì„¤ëª…</label>
                    <textarea id="styleDescription" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ì´ë¯¸ì§€ ì—…ë¡œë“œ *</label>
                    <input type="file" id="styleImage" class="form-control" accept="image/*" onchange="previewImage()" required>
                    <div id="imagePreview" class="image-preview"></div>
                </div>
                <div style="text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeStyleModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary" id="styleSubmitBtn">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- JavaScript íŒŒì¼ -->
    <script src="js/admin-main.js"></script>
    
    <!-- Firebase ì´ˆê¸°í™” ë°±ì—… -->
    <script>
        // admin-main.jsê°€ ë¡œë“œëœ í›„ Firebase ì´ˆê¸°í™” í™•ì¸
        window.addEventListener('load', () => {
            console.log('ğŸ”§ Admin í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìˆ˜ë™ ì´ˆê¸°í™”
            setTimeout(() => {
                if (!window.db || !firebase.apps.length) {
                    console.warn('âš ï¸ Firebase ì´ˆê¸°í™” ì‹œë„...');
                    try {
                        if (!firebase.apps.length) {
                            firebase.initializeApp(firebaseConfig);
                        }
                        window.db = firebase.firestore();
                        window.storage = firebase.storage();
                        
                        // ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
                        const syncIndicator = document.getElementById('syncIndicator');
                        if (syncIndicator) {
                            syncIndicator.textContent = 'âœ… Firebase ì—°ê²°ë¨';
                            syncIndicator.className = 'sync-indicator connected';
                        }
                        
                        console.log('âœ… Firebase ìˆ˜ë™ ì´ˆê¸°í™” ì™„ë£Œ');
                    } catch (error) {
                        console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    }
                }
            }, 2000);
        });
    </script>
</body>
</html>
